<!DOCTYPE html><html><head><meta charset="utf-8"><style>@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

* {
    box-sizing: border-box;
}

body {
    width: 980px;
    margin-right: auto;
    margin-left: auto;
}

body .markdown-body {
    padding: 45px;
    border: 1px solid #ddd;
    border-radius: 3px;
    word-wrap: break-word;
}

pre {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  color: #333;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background-color: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body input {
  font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4078c0;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .select::-ms-expand {
  opacity: 0;
}

.markdown-body .octicon {
  font: normal normal normal 16px/1 octicons-anchor;
  display: inline-block;
  text-decoration: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body:before {
  display: table;
  content: "";
}

.markdown-body:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body .anchor {
  display: inline-block;
  padding-right: 2px;
  margin-left: -18px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #000;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h1 .anchor {
  line-height: 1;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 .anchor {
  line-height: 1;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h3 .anchor {
  line-height: 1.2;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h4 .anchor {
  line-height: 1.2;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h5 .anchor {
  line-height: 1.1;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body h6 .anchor {
  line-height: 1.1;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  box-sizing: content-box;
  background-color: #fff;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .pl-c {
  color: #969896;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #0086b3;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #795da3;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #333;
}

.markdown-body .pl-ent {
  color: #63a35c;
}

.markdown-body .pl-k {
  color: #a71d5d;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #183691;
}

.markdown-body .pl-v {
  color: #ed6a43;
}

.markdown-body .pl-id {
  color: #b52a1d;
}

.markdown-body .pl-ii {
  background-color: #b52a1d;
  color: #f8f8f8;
}

.markdown-body .pl-sr .pl-cce {
  color: #63a35c;
  font-weight: bold;
}

.markdown-body .pl-ml {
  color: #693a17;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  color: #1d3e81;
  font-weight: bold;
}

.markdown-body .pl-mq {
  color: #008080;
}

.markdown-body .pl-mi {
  color: #333;
  font-style: italic;
}

.markdown-body .pl-mb {
  color: #333;
  font-weight: bold;
}

.markdown-body .pl-md {
  background-color: #ffecec;
  color: #bd2c00;
}

.markdown-body .pl-mi1 {
  background-color: #eaffea;
  color: #55a532;
}

.markdown-body .pl-mdr {
  color: #795da3;
  font-weight: bold;
}

.markdown-body .pl-mo {
  color: #1d3e81;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}

.markdown-body .plan-price-unit {
  color: #767676;
  font-weight: normal;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 0.35em 0.25em -1.6em;
  vertical-align: middle;
}

.markdown-body .plan-choice {
  padding: 15px;
  padding-left: 40px;
  display: block;
  border: 1px solid #e0e0e0;
  position: relative;
  font-weight: normal;
  background-color: #fafafa;
}

.markdown-body .plan-choice.open {
  background-color: #fff;
}

.markdown-body .plan-choice.open .plan-choice-seat-breakdown {
  display: block;
}

.markdown-body .plan-choice-free {
  border-radius: 3px 3px 0 0;
}

.markdown-body .plan-choice-paid {
  border-radius: 0 0 3px 3px;
  border-top: 0;
  margin-bottom: 20px;
}

.markdown-body .plan-choice-radio {
  position: absolute;
  left: 15px;
  top: 18px;
}

.markdown-body .plan-choice-exp {
  color: #999;
  font-size: 12px;
  margin-top: 5px;
}

.markdown-body .plan-choice-seat-breakdown {
  margin-top: 10px;
  display: none;
}

.markdown-body :checked+.radio-label {
  z-index: 1;
  position: relative;
  border-color: #4078c0;
}
</style><title>ionic2-exp</title></head><body><article class="markdown-body">
<ul>
  <li>
    <a href="#1">Angular 基础</a>
    <ul>
      <li>
        <a href="#2">子模块与共享模块</a>
      </li>
      <li>
        <a href="#3">服务与单例</a>
      </li>
      <li>
        <a href="#4">依赖注入</a>
        <ul>
          <li>
            <a href="#5">@Inject 装饰器</a>
          </li>
          <li>
            <a href="#6">循环依赖</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#7">指令</a>
        <ul>
          <li>
            <a href="#8">利用指令传递数据</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#9">管道与参数</a>
      </li>
      <li>
        <a href="#10">表单</a>
      </li>
      <li>
        <a href="#11">安全过滤与 DomSanitizer</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#12">Ionic</a>
    <ul>
      <li>
        <a href="#13">保证 Ionic 控件的层级关系</a>
      </li>
      <li>
        <a href="#14">二级页面不显示  Tabbar</a>
      </li>
      <li>
        <a href="#15">页面 footer 在导航后退时的问题</a>
      </li>
      <li>
        <a href="#16">NavPush 、 NavParams 与 NavPop</a>
      </li>
      <li>
        <a href="#17">ion-slides</a>
        <ul>
          <li>
            <a href="#18">幻灯联动</a>
          </li>
          <li>
            <a href="#19">向前切换时的越界问题</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#20">水平方向的 ion-scroll</a>
      </li>
      <li>
        <a href="#21">Storage</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#22">设备相关</a>
    <ul>
      <li>
        <a href="#23">插件安装</a>
      </li>
      <li>
        <a href="#24">构建 APP</a>
      </li>
      <li>
        <a href="#25">android 透明状态栏</a>
      </li>
      <li>
        <a href="#26">软键盘弹出时的处理</a>
        <ul>
          <li>
            <a href="#27">iphone 页面跳跃问题</a>
          </li>
          <li>
            <a href="#28">页面背景问题</a>
          </li>
          <li>
            <a href="#29">软键盘弹出时  Tabbar 的处理</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#30">锁定 APP 的方向</a>
      </li>
      <li>
        <a href="#31">调用相册</a>
        <ul>
          <li>
            <a href="#32">安装失败的解决方法</a>
          </li>
          <li>
            <a href="#33">权限检查</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#34">调用摄像头</a>
        <ul>
          <li>
            <a href="#35">拍摄区域与工具按钮</a>
          </li>
          <li>
            <a href="#36">拍摄照片的处理</a>
          </li>
          <li>
            <a href="#37">ios 的遗留问题</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#38">APP 图标与启动画面</a>
      </li>
      <li>
        <a href="#39">ios 的元素点击</a>
      </li>
      <li>
        <a href="#40">手势处理</a>
      </li>
      <li>
        <a href="#41">ios9 页面内容不可见</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#42">页面布局与行为</a>
    <ul>
      <li>
        <a href="#43">界面统一缩放处理</a>
      </li>
      <li>
        <a href="#44">启动时登录页与主界面的切换</a>
      </li>
      <li>
        <a href="#45">页面内容垂直居中</a>
      </li>
      <li>
        <a href="#46">弹性布局在软键盘弹出时的问题</a>
      </li>
      <li>
        <a href="#47">伪造的横屏效果</a>
        <ul>
          <li>
            <a href="#47_2">Echarts 坐标轴变换</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="#48">css 样式定义与修改</a>
    <ul>
      <li>
        <a href="#49">修改Sass变量</a>
      </li>
      <li>
        <a href="#50">自定义样式</a>
      </li>
      <li>
        <a href="#51">Sass 混入范例</a>
      </li>
      <li>
        <a href="#52">统一样式</a>
      </li>
      <li>
        <a href="#53">svg</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#54">RxJS</a>
    <ul>
      <li>
        <a href="#55">监听全局属性值的变化</a>
        <ul>
          <li>
            <a href="#56">distinctUntilChanged</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#57">使用 Observable 管理数据</a>
        <ul>
          <li>
            <a href="#58">async 管道</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#59">RxJS 的多播处理</a>
        <ul>
          <li>
            <a href="#60">Subject</a>
          </li>
          <li>
            <a href="#61">multicast 与 RefCount 处理多播</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#62">可撤销的 http 请求</a>
      </li>
      <li>
        <a href="#63">socket.io 与 RxJS 的配合</a>
      </li>
      <li>
        <a href="#64">RxJS 的取消订阅</a>
        <ul>
          <li>
            <a href="#65">离开页面时取消订阅</a>
          </li>
          <li>
            <a href="#66">切换订阅目标</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#67">RxJS 合并可观察对象</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#68">其他异步处理方式</a>
    <ul>
      <li>
        <a href="#69">Promise</a>
      </li>
      <li>
        <a href="#70">async/await</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#71">ECharts</a>
    <ul>
      <li>
        <a href="#72">组件封装与抽象</a>
      </li>
      <li>
        <a href="#73">回收资源</a>
      </li>
      <li>
        <a href="#74">监测数据变化</a>
      </li>
      <li>
        <a href="#75">自定义 tooltip</a>
      </li>
      <li>
        <a href="#76">ngx-echarts</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#77">杂项</a>
    <ul>
      <li>
        <a href="#78">资源文件的使用</a>
      </li>
      <li>
        <a href="#79">PromisesPlugin 依赖安装失败</a>
      </li>
      <li>
        <a href="#80">全局消息提示</a>
      </li>
      <li>
        <a href="#81">RESTful 接口与 token</a>
      </li>
      <li>
        <a href="#82">日期时间处理</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="#83">遗留问题</a>
    <ul>
      <li>
        <a href="#84">交易日问题</a>
      </li>
      <li>
        <a href="#85">数值与精度</a>
      </li>
      <li>
        <a href="#86">补全实时数据的处理</a>
      </li>
      <li>
        <a href="#87">K 线图的追加数据</a>
      </li>
      <li>
        <a href="#88">股票列表数据合并请求</a>
      </li>
      <li>
        <a href="#89">ECharts 的 tooltip</a>
      </li>
      <li>
        <a href="#90">ECharts 在 iphone 上 cpu 占用率过高</a>
      </li>
    </ul>
  </li>
</ul>
<h1>
<a id="1" class="anchor" href="#1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Angular 基础</h1>
<h2>
<a id="2" class="anchor" href="#2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>子模块与共享模块</h2>
<p>此处的“模块”指的是使用 <code>@NgModule</code> 装饰器的类。在项目开始时，一般只有一个模块，也就是根模块（ <code>/src/app/app.module.ts</code> ）。在模块中，可以声明所要使用的页面、组件、服务、指令、管道、引入插件、启动项目等。所有自定义的页面、组件、服务、指令、管道，在创建之后都必须到模块中进行声明，否则将无法使用。</p>
<p>但是随着项目的增大，根模块的内容也会不断增加，代码变得庞大也不直观，此时可以考虑启用子模块与共享模块。</p>
<p>以 <code>/src/pages/information/information.module.ts</code> 为例，此代码的 <code>InformationModule</code> 类也使用了 <code>@NgModule</code> 装饰器，然后对本模块所用的各种类进行了声明，并将可能会被其他模块引用的组件进行了导出（ <code>exports</code> ）。此外还要注意，在此模块中使用 <code>IonicPageModule.forChild(InformationPage)</code> 导入了 <code>InformationPage</code> ，这与根模块有区别：根模块使用的是 <code>IonicModule.forRoot(GjsApp)</code> ， <code>forRoot()</code> 方法只能在根模块上使用，而其他模块只能使用 <code>forChild()</code> 方法。</p>
<p>在根模块上，使用 <code>imports: [InformationModule]</code> 导入了前面定义的子模块 <code>InformationModule</code> ，这样根模块下的所有成员都可以使用 <code>InformationModule</code> 子模块使用 <code>exports</code> 导出的 <code>InformationPage</code> 。</p>
<p>共享模块类似于子模块，主要区别是其中不包含 Ionic 页面。可以参见 <code>/shared</code> 文件夹下的各个代码文件，例如 <code>/src/shared/list-shared.module.ts</code> ，此共享模块主要是声明并导出了各个管道操作，简化了根模块的代码。</p>
<h2>
<a id="3" class="anchor" href="#3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务与单例</h2>
<p>在模块的声明中，使用 <code>providers</code> 声明的类可以称为“服务”（ provider 或 service ）。服务的特征是在模块内是单例的，一个模块所声明的服务，在其组件内所获得的该服务的实例，都是同一个实例，因此可以用来存储共享数据、公共处理方法等。</p>
<p>模块可以嵌套，如果在根模块内嵌入了其他模块，并且子模块对同一个服务也使用 <code>providers</code> 进行了声明，则根模块与子模块的同一服务的实例将是不同的实例。一个服务若在多个模块内被声明，则每个模块都会分别获得该服务的不同实例。</p>
<h2>
<a id="4" class="anchor" href="#4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>依赖注入</h2>
<p>依赖注入主要是用于解决类的初始化与解耦的问题。</p>
<p>在传统的模式中，如果一个类中使用了其他类的实例，则在初始化目标类的实例时，必须按照目标类的构造函数所规定的参数传入相应的数据。这样一来是每个类都必须知道所使用的其他类需要哪些初始化参数，另一方面当目标类被改写时，使用这些类的类也必须改写初始化调用的代码。这样不同的类之间就出现了强耦合的情况，不利于项目编写与维护。</p>
<p>Angular 使用依赖注入来解决此问题。在类的声明上可以添加装饰器，最基础的是 <code>@Injectable</code> 装饰器。带有该装饰器的类，若构造器函数的参数使用了其他类的实例，或者本类的某些属性是其他类的实例，则 Angular 引擎会自动判断需要为其他类的构造器传入哪些参数，当前类在声明其他类的实例时，只要声明类型即可，完全不需要知道目标类的初始化参数。例如：</p>
<div class="highlight highlight-source-ts"><pre>@<span class="pl-en">Injectable</span>()
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">ImagePickerService</span> {

    <span class="pl-k">constructor</span>(
        <span class="pl-k">private</span> <span class="pl-v">imagePicker</span><span class="pl-k">:</span> <span class="pl-en">ImagePicker</span>,
        <span class="pl-k">private</span> <span class="pl-v">androidPermissions</span><span class="pl-k">:</span> <span class="pl-en">AndroidPermissions</span>,
        <span class="pl-k">private</span> <span class="pl-v">platform</span><span class="pl-k">:</span> <span class="pl-en">Platform</span>,
    ) {

    }

}</pre></div>
<p>Angular 用于修饰类的其他任意装饰器（例如 <code>@Component</code> 、 <code>@Directive</code> 等），实际上都带有依赖注入的特性。</p>
<h3>
<a id="5" class="anchor" href="#5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>@Inject 装饰器</h3>
<p>前面提到的依赖注入，使用的是以类声明为目标的装饰器。而还有另外一种方式，可以用在函数参数上，也就是 <code>@Inject</code> 装饰器。例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(
  @<span class="pl-en">Inject</span>(<span class="pl-s"><span class="pl-pds">'</span>appSettings<span class="pl-pds">'</span></span>) <span class="pl-smi">public</span> <span class="pl-smi">appSettings</span>,
) {

}</pre></div>
<p>在 <code>@Inject</code> 装饰器的参数内使用字符串代表需要注入的类。注意：使用这种方式时，需要先在模块的 <code>providers</code> 声明上做相应的定义，例如：</p>
<div class="highlight highlight-source-ts"><pre>@<span class="pl-en">NgModule</span>({
  providers: [
    {provide: <span class="pl-s"><span class="pl-pds">'</span>appSettings<span class="pl-pds">'</span></span>, useClass: <span class="pl-smi">AppSettings</span>},
  ]
})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">AppModule</span> {}</pre></div>
<p>使用 <code>@Inject</code> 装饰器从表面上看来可以在进行注入时不书写类型（ <code>@Inject('appSettings') public appSettings</code> ），因此在相关页面也不需要进行导入（ <code>import { AppSettings } from '../../providers/app-settings';</code>），似乎比较方便。但实践后发现这并不是一种好的代码书写方式。原因是在声明 <code>appSettings</code> 属性时，并没有声明其类型，类型默认为 <code>any</code> ，这样代码提示与属性、方法检查等等特性都无法使用了。若使用 <code>@Inject</code> 装饰器同时还对属性进行类型声明，则 <code>@Inject</code> 节约代码的优势就没有了。</p>
<p><strong>因此在实践后放弃了 <code>@Inject</code> 装饰器，并且也不建议再使用它。</strong></p>
<h3>
<a id="6" class="anchor" href="#6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>循环依赖</h3>
<p>使用依赖注入时，需要注意循环依赖的问题。例如 A 类依赖了 B 类，而 B 类也依赖了 A ；或者 A 依赖 B ， B 依赖 C ， C 依赖 A ；诸如此类。依赖注入时若出现循环依赖，则在注入时将会报错（运行时错误）。</p>
<p>出现循环依赖时，一般代表项目的结构设计出现了问题，需要修正。一般的解决方式是：</p>
<ol>
<li>将公共的部分提取到一个类中，其他涉及到的类都依赖此公共类即可；</li>
<li>使用 Promise 、 Observable 等，在一个类中将状态的变化暴露出来；而其他类订阅该暴露出的状态/属性，绑定本类中相应的处理函数，在目标状态变化时触发处理函数，实现类之间的解耦。</li>
</ol>
<h2>
<a id="7" class="anchor" href="#7" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>指令</h2>
<p>Angular 的指令主要分为属性型指令与结构指令。</p>
<p>属性型指令主要是对元素的样式进行修改，也可以监听元素上的事件。结构性指令可以改变 html 文档的结构。</p>
<blockquote>
<p><strong>每个 html 元素上最多只能使用一个结构性指令。</strong></p>
</blockquote>
<p>可以使用 <code>@Input</code> 装饰器为指令输入参数。默认情况下，输入参数的名称与指令名称相同，但也可以进行改名。可以为一个指令输入多个参数。简单的例子可参考 <code>/src/directives/liked/liked.ts</code> ：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">Directive</span>, <span class="pl-smi">ElementRef</span>, <span class="pl-smi">Input</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/core<span class="pl-pds">'</span></span>;

@<span class="pl-en">Directive</span>({
  selector: <span class="pl-s"><span class="pl-pds">'</span>[liked]<span class="pl-pds">'</span></span>
})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">LikedDirective</span> {
  
  <span class="pl-k">constructor</span>(<span class="pl-k">private</span> <span class="pl-v">el</span><span class="pl-k">:</span> <span class="pl-en">ElementRef</span>) { }

  @<span class="pl-en">Input</span>(<span class="pl-s"><span class="pl-pds">'</span>liked<span class="pl-pds">'</span></span>)
  <span class="pl-k">set</span> redFont(<span class="pl-v">value</span>) {
    <span class="pl-k">const</span> color <span class="pl-k">=</span> <span class="pl-smi">value</span> <span class="pl-k">?</span> <span class="pl-s"><span class="pl-pds">"</span>#ea3333<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>#fff<span class="pl-pds">"</span></span>;
    <span class="pl-c1">this</span>.<span class="pl-smi">el</span>.<span class="pl-smi">nativeElement</span>.<span class="pl-c1">style</span>.<span class="pl-c1">color</span> <span class="pl-k">=</span> <span class="pl-smi">color</span>;
    <span class="pl-c1">this</span>.<span class="pl-smi">el</span>.<span class="pl-smi">nativeElement</span>.<span class="pl-c1">getElementsByClassName</span>(<span class="pl-s"><span class="pl-pds">'</span>thumb<span class="pl-pds">'</span></span>)[<span class="pl-c1">0</span>].<span class="pl-c1">style</span>.<span class="pl-c1">backgroundColor</span> <span class="pl-k">=</span> <span class="pl-smi">color</span>;
  }
}</pre></div>
<p>使用范例：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">div</span> [<span class="pl-e">liked</span>]=<span class="pl-s"><span class="pl-pds">"</span>isLiked(commentItem)<span class="pl-pds">"</span></span>&gt;
  <span class="pl-c"><span class="pl-c">&lt;!--</span> 内容 <span class="pl-c">--&gt;</span></span>
&lt;/<span class="pl-ent">div</span>&gt;</pre></div>
<p>结构型指令可以利用 TemplateRef 与 ViewContainerRef 调用局部模板与容器，进行自定义的渲染。参考下面的例子。</p>
<h3>
<a id="8" class="anchor" href="#8" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>利用指令传递数据</h3>
<p>参考以下模板：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-row</span> *<span class="pl-e">ngFor</span>=<span class="pl-s"><span class="pl-pds">"</span>let data of listData; trackBy: (data?.baseData | async)?.stockCode;<span class="pl-pds">"</span></span>
     <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>bottom-hr light-transparent<span class="pl-pds">"</span></span>
     [<span class="pl-e">class</span>.<span class="pl-e">dark-transparent</span>]=<span class="pl-s"><span class="pl-pds">"</span>isOption<span class="pl-pds">"</span></span>
     <span class="pl-e">tappable</span> [<span class="pl-e">navPush</span>]=<span class="pl-s"><span class="pl-pds">"</span>stockDetailPage<span class="pl-pds">"</span></span> [<span class="pl-e">navParams</span>]=<span class="pl-s"><span class="pl-pds">"</span>(data?.baseData | async)?.stockCode<span class="pl-pds">"</span></span>
&gt;
  &lt;<span class="pl-ent">ion-col</span> <span class="pl-e">padding</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col1<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">h5</span>&gt;{{(data?.baseData | async)?.name || '----'}}&lt;/<span class="pl-ent">h5</span>&gt;
      &lt;<span class="pl-ent">div</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>isOption<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>font-smaller<span class="pl-pds">"</span></span>&gt;持仓&lt;/<span class="pl-ent">span</span>&gt;
        &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>color-important<span class="pl-pds">"</span></span>&gt;{{data?.personalData?.restQuantity}}&lt;/<span class="pl-ent">span</span>&gt;
      &lt;/<span class="pl-ent">div</span>&gt;
      &lt;<span class="pl-ent">span</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>!isOption<span class="pl-pds">"</span></span>&gt;{{(data?.baseData | async)?.stockCode}}&lt;/<span class="pl-ent">span</span>&gt;
      &lt;<span class="pl-ent">h6</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>showDetail<span class="pl-pds">"</span></span>&gt;总市价：{{(data?.baseData | async)?.marketInfo?.marketValue}}&lt;/<span class="pl-ent">h6</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
  &lt;/<span class="pl-ent">ion-col</span>&gt;
  &lt;<span class="pl-ent">ion-col</span> <span class="pl-e">padding</span>&gt;
    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col2<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">h4</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>{{(data?.baseData | async)?.changeRate | riseOrFall}}<span class="pl-pds">"</span></span> [<span class="pl-e">class</span>.<span class="pl-e">showDetail</span>]=<span class="pl-s"><span class="pl-pds">"</span>showDetail<span class="pl-pds">"</span></span>&gt;{{(data?.baseData | async)?.latestPrice | number:'.2-2'}}&lt;/<span class="pl-ent">h4</span>&gt;
      &lt;<span class="pl-ent">h6</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>showDetail<span class="pl-pds">"</span></span>&gt;换手率：{{(data?.baseData | async)?.marketInfo?.turnoverRate | percent:'.2-2'}}&lt;/<span class="pl-ent">h6</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
  &lt;/<span class="pl-ent">ion-col</span>&gt;
  <span class="pl-c"><span class="pl-c">&lt;!--</span> 其他内容…… <span class="pl-c">--&gt;</span></span>
&lt;/<span class="pl-ent">ion-row</span>&gt;</pre></div>
<p>在此模板中，可以看到 <code>(data?.baseData | async)</code> 表达式被重复书写了多次，相当繁琐。能不能进行一次数据传递，简化模板呢？</p>
<p>尝试使用结构型指令来解决这个需求。</p>
<ol>
<li>
<p>创建一个指令：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c"><span class="pl-c">//</span> '/src/directives/tri-row/tri-row.ts'</span>
<span class="pl-k">import</span> { <span class="pl-smi">Directive</span>, <span class="pl-smi">Input</span>, <span class="pl-smi">TemplateRef</span>, <span class="pl-smi">ViewContainerRef</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/core<span class="pl-pds">'</span></span>;

@<span class="pl-en">Directive</span>({
  selector: <span class="pl-s"><span class="pl-pds">'</span>[triRow]<span class="pl-pds">'</span></span>
})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">TriRowDirective</span> {
  
  <span class="pl-k">constructor</span>(
    <span class="pl-k">private</span> <span class="pl-v">templateRef</span><span class="pl-k">:</span> <span class="pl-en">TemplateRef</span>&lt;<span class="pl-c1">any</span>&gt;,
    <span class="pl-k">private</span> <span class="pl-v">viewContainer</span><span class="pl-k">:</span> <span class="pl-en">ViewContainerRef</span>,
  ) {

  }

  @<span class="pl-en">Input</span>(<span class="pl-s"><span class="pl-pds">'</span>triRow<span class="pl-pds">'</span></span>)
  <span class="pl-k">set</span> triRowData(<span class="pl-v">value</span>) {
    <span class="pl-k">if</span> (<span class="pl-smi">value</span>){
      <span class="pl-k">const</span> view <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">viewContainer</span>.<span class="pl-c1">get</span>(<span class="pl-c1">0</span>) <span class="pl-k">as</span> <span class="pl-en">EmbeddedViewRef</span>&lt;<span class="pl-c1">any</span>&gt; <span class="pl-k">||</span>
        <span class="pl-c1">this</span>.<span class="pl-smi">viewContainer</span>.<span class="pl-en">createEmbeddedView</span>(<span class="pl-c1">this</span>.<span class="pl-smi">templateRef</span>)
      <span class="pl-smi">view</span>.<span class="pl-smi">context</span>.<span class="pl-smi">$implicit</span> <span class="pl-k">=</span> <span class="pl-smi">value</span>
    }
  }
}</pre></div>
</li>
<li>
<p>修改模板页：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-grid</span> <span class="pl-e">no-padding</span> <span class="pl-e">text-center</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col-center-center<span class="pl-pds">"</span></span> [<span class="pl-e">class</span>.<span class="pl-e">dark-transparent</span>]=<span class="pl-s"><span class="pl-pds">"</span>isOption<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">div</span> <span class="pl-e">no-padding</span> *<span class="pl-e">ngFor</span>=<span class="pl-s"><span class="pl-pds">"</span>let data of listData; trackBy: (data?.baseData | async)?.stockCode;<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">ion-row</span> *<span class="pl-e">triRow</span>=<span class="pl-s"><span class="pl-pds">"</span>data?.baseData | async; let subData;<span class="pl-pds">"</span></span>
       <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>bottom-hr light-transparent<span class="pl-pds">"</span></span>
       [<span class="pl-e">class</span>.<span class="pl-e">dark-transparent</span>]=<span class="pl-s"><span class="pl-pds">"</span>isOption<span class="pl-pds">"</span></span>
       <span class="pl-e">tappable</span> [<span class="pl-e">navPush</span>]=<span class="pl-s"><span class="pl-pds">"</span>stockDetailPage<span class="pl-pds">"</span></span> [<span class="pl-e">navParams</span>]=<span class="pl-s"><span class="pl-pds">"</span>subData?.stockCode<span class="pl-pds">"</span></span>
  &gt;
    &lt;<span class="pl-ent">ion-col</span> <span class="pl-e">padding</span>&gt;
      &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col1<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">h5</span>&gt;{{subData?.name || '----'}}&lt;/<span class="pl-ent">h5</span>&gt;
        &lt;<span class="pl-ent">div</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>isOption<span class="pl-pds">"</span></span>&gt;
          &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>font-smaller<span class="pl-pds">"</span></span>&gt;持仓&lt;/<span class="pl-ent">span</span>&gt;
          &lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>color-important<span class="pl-pds">"</span></span>&gt;{{data?.personalData?.restQuantity}}&lt;/<span class="pl-ent">span</span>&gt;
        &lt;/<span class="pl-ent">div</span>&gt;
        &lt;<span class="pl-ent">span</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>!isOption<span class="pl-pds">"</span></span>&gt;{{subData?.stockCode}}&lt;/<span class="pl-ent">span</span>&gt;
        &lt;<span class="pl-ent">h6</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>showDetail<span class="pl-pds">"</span></span>&gt;总市价：{{subData?.marketInfo?.marketValue}}&lt;/<span class="pl-ent">h6</span>&gt;
      &lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">ion-col</span>&gt;
    &lt;<span class="pl-ent">ion-col</span> <span class="pl-e">padding</span>&gt;
      &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>col2<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">h4</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>{{subData?.changeRate | riseOrFall}}<span class="pl-pds">"</span></span> [<span class="pl-e">class</span>.<span class="pl-e">showDetail</span>]=<span class="pl-s"><span class="pl-pds">"</span>showDetail<span class="pl-pds">"</span></span>&gt;{{subData?.latestPrice | number:'.2-2'}}&lt;/<span class="pl-ent">h4</span>&gt;
        &lt;<span class="pl-ent">h6</span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>showDetail<span class="pl-pds">"</span></span>&gt;换手率：{{subData?.marketInfo?.turnoverRate | percent:'.2-2'}}&lt;/<span class="pl-ent">h6</span>&gt;
      &lt;/<span class="pl-ent">div</span>&gt;
    &lt;/<span class="pl-ent">ion-col</span>&gt;
    <span class="pl-c"><span class="pl-c">&lt;!--</span> 其他内容…… <span class="pl-c">--&gt;</span></span>
  &lt;/<span class="pl-ent">ion-row</span>&gt;
  &lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">ion-grid</span>&gt; </pre></div>
</li>
<li>
<p>修改相应的 module 代码文件，添加对于 TriRowDirective 的引用与导出。</p>
</li>
<li>
<p>修改说明：</p>
<ul>
<li>使用指令的 <code>triRow</code> 输入属性（与指令同名）来传入数据，属性重命名为 <code>triRowData</code> 。</li>
<li>在输入值改变时，获取对于局部嵌入视图的引用（ EmbeddedViewRef ），若不存在则使用 <code>viewContainer.createEmbeddedView()</code> 创建一个新的。</li>
<li><strong>对于所获得的 EmbeddedViewRef 的实例， <code>view.context.$implicit = value</code> 手动指定并刷新模板所用的数据（修改模板的上下文，为上下文对象的 <code>$implicit</code> 属性指定了特定值）。</strong></li>
<li>在模板上，多加了一层 <code>&lt;div&gt;</code> 元素。因为前面也提到过，一个 html 元素上是不能绑定两个结构型指令的，因此需要增加元素层级。此外，不能破坏 <code>&lt;ion-row&gt;</code> 与 <code>&lt;ion-col&gt;</code> 的层级关系，避免改变预设样式与行为，因此 <code>&lt;div&gt;</code> 元素被添加到 <code>&lt;ion-row&gt;</code> 的外层（ <code>&lt;ion-grid&gt;</code> 的层级关系则并不太重要）。</li>
<li>
<code>&lt;ion-row *triRow="data?.baseData | async; let subData;"&gt;</code> ，此处使用了结构型指令的语法 <code>*triRow</code> ，并且使用了微语法 <code>let</code> ，将数据对象赋值给一个临时变量 <code>subData</code> ，以便在局部模板内使用。</li>
</ul>
</li>
</ol>
<p>这样修改之后，模板得到了一定程度的简化，渲染效果也符合预期。</p>
<blockquote>
<p><strong>之前曾经尝试仿造过 <code>*ngIf</code> 指令，在数据变化时先使用 <code>viewContainer.clear()</code> ，再执行 <code>viewContainer.createEmbeddedView(this.templateRef, {$implicit: value})</code> 。但试验后发现每次重新渲染时都清除了局部内容并重新创建元素，导致页面上的 DOM 结构被改变，相关的 node 节点每次渲染时都是不同的节点，对页面性能有负面影响。因此后来修改了实现方式，改用 <code>view.context.$implicit = value</code> 。</strong></p>
</blockquote>
<p><strong>作为在模板上给局部模板传递数据的尝试，使用结构型指令可以实现需求，也就是将一个复杂的表达式赋值到一个变量上，以便局部模板可以直接使用这个变量。但是这样的负面效果是可能必须增加一层 html 元素，以应对一个元素上不能使用多个结构型指令的限制。这类需求另一种解决方案是进一步提取、划分子组件，从父组件向子组件传递数据，但同样需要注意增加子组件后的层级关系变化问题。</strong></p>
<p>此问题可能还有其他的解决方案，有待今后进一步研究。</p>
<h2>
<a id="9" class="anchor" href="#9" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>管道与参数</h2>
<p>管道用于在 Angular 的 html 模板页上对数据进行处理，例如转换格式、过滤等等。使用时使用管道操作符（竖线， <code>|</code> ），也可以添加调用参数，使用冒号 <code>:</code> ，多个参数就使用多个冒号。</p>
<p>例如 <code>/src/pages/account-center/account-center.html</code> 模板页上就使用了一个带参数的自定义管道 <code>numMask</code> ：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>f-right<span class="pl-pds">"</span></span>&gt;{{personalDataService.relatedBankAccount.cardNo | numMask:4:4}}&lt;/<span class="pl-ent">span</span>&gt;</pre></div>
<p>该管道的代码为：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c"><span class="pl-c">//</span> /src/pipes/num-mask.ts</span>
<span class="pl-k">import</span> { <span class="pl-smi">Pipe</span>, <span class="pl-smi">PipeTransform</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/core<span class="pl-pds">'</span></span>;

@<span class="pl-c1">Pipe</span>({
  name: <span class="pl-s"><span class="pl-pds">'</span>numMask<span class="pl-pds">'</span></span>,
})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">NumMaskPipe</span> <span class="pl-k">implements</span> <span class="pl-e">PipeTransform</span> {
  transform(<span class="pl-v">value</span><span class="pl-k">:</span> <span class="pl-c1">any</span>, <span class="pl-v">left</span> <span class="pl-k">=</span> <span class="pl-c1">3</span>, <span class="pl-v">right</span> <span class="pl-k">=</span> <span class="pl-c1">4</span>) {
      <span class="pl-smi">value</span> <span class="pl-k">=</span> <span class="pl-smi">value</span>.<span class="pl-c1">toString</span>();
      <span class="pl-k">let</span> span <span class="pl-k">=</span> <span class="pl-smi">value</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-smi">left</span> <span class="pl-k">-</span> <span class="pl-smi">right</span>;
      <span class="pl-k">if</span>(<span class="pl-smi">span</span> <span class="pl-k">&lt;=</span> <span class="pl-c1">0</span> <span class="pl-k">||</span> <span class="pl-smi">left</span> <span class="pl-k">&lt;</span> <span class="pl-c1">0</span> <span class="pl-k">||</span> <span class="pl-smi">right</span> <span class="pl-k">&lt;</span> <span class="pl-c1">0</span>){
        <span class="pl-k">return</span> <span class="pl-smi">value</span>;
      } <span class="pl-k">else</span> {
        <span class="pl-k">return</span> <span class="pl-smi">value</span>.<span class="pl-c1">slice</span>(<span class="pl-c1">0</span>, <span class="pl-smi">left</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>*<span class="pl-pds">'</span></span>.<span class="pl-en">repeat</span>(<span class="pl-smi">span</span>) <span class="pl-k">+</span> 
          (<span class="pl-smi">right</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span> <span class="pl-k">?</span> <span class="pl-smi">value</span>.<span class="pl-c1">slice</span>(<span class="pl-k">-</span><span class="pl-smi">right</span>) <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>);
      }
  }
}</pre></div>
<p>自定义管道需要实现 <code>PipeTransform</code> 接口，在转换函数 <code>transform()</code> 中，第一个参数是需要处理的原值，后面的参数则对应于管道在模板上调用时冒号后面的部分。</p>
<h2>
<a id="10" class="anchor" href="#10" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>表单</h2>
<p>Angular 的表单有几种构建方式，这里只介绍其中两种，未涉及 <code>FormBuilder</code> 方式。</p>
<ol>
<li>
<p>直接使用 <code>&lt;form&gt;</code> 元素，然后在每个输入项元素上使用 <code>[(ngModel)]</code> 双向绑定。例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-input</span> <span class="pl-e">placeholder</span>=<span class="pl-s"><span class="pl-pds">"</span>Text Input<span class="pl-pds">"</span></span> [(<span class="pl-e">ngModel</span>)]=<span class="pl-s"><span class="pl-pds">"</span>searchTitle<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">ion-input</span>&gt;</pre></div>
<p>这里使用双向绑定，将该输入项的实际值与当前类的 <code>searchTitle</code> 属性进行了双向绑定。</p>
<p>输入值的有效性验证、表单提交都自行安排。当然也可以在输入项元素上使用一些预设的有效性限制属性，例如 <code>required</code> 、 <code>min-length</code> 等等，直接书写为输入项元素的属性。为了屏蔽浏览器的 html5 表单验证，可以在 <code>&lt;form&gt;</code> 元素上添加 <code>novalidate</code> 属性，即不对整个表单的有效性做验证，而是逐个验证每个输入项。</p>
</li>
<li>
<p>使用 FormGroup</p>
<p>前一种方式中，输入项的值（以及所绑定的相关属性）、有效性验证等，都是零散的。而使用 <code>FormGroup</code> ，可以将输入项有效整合在一起，有利于统一处理。并且 <code>FormGroup</code> 还是可以嵌套的。</p>
<p>以 <code>/src/pages/login/login.ts</code> 为例：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">Component</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/core<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">FormControl</span>, <span class="pl-smi">FormGroup</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/forms<span class="pl-pds">'</span></span>;

@<span class="pl-en">Component</span>({
  selector: <span class="pl-s"><span class="pl-pds">'</span>page-login<span class="pl-pds">'</span></span>,
  templateUrl: <span class="pl-s"><span class="pl-pds">'</span>login.html<span class="pl-pds">'</span></span>,
})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">LoginPage</span> {
  loginForm<span class="pl-k">:</span><span class="pl-en">FormGroup</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">FormGroup</span> ({
    customerId: <span class="pl-k">new</span> <span class="pl-en">FormControl</span>({value: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, disabled: <span class="pl-c1">true</span>}),
    password: <span class="pl-k">new</span> <span class="pl-en">FormControl</span>({value: <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, disabled: <span class="pl-c1">true</span>}),
    savePassword: <span class="pl-k">new</span> <span class="pl-en">FormControl</span>({value: <span class="pl-c1">false</span>, disabled: <span class="pl-c1">true</span>}),
  });
}</pre></div>
<p>相应的模板主要内容为：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">form</span> [<span class="pl-e">formGroup</span>]=<span class="pl-s"><span class="pl-pds">"</span>loginForm<span class="pl-pds">"</span></span> (<span class="pl-e">ngSubmit</span>)=<span class="pl-s"><span class="pl-pds">"</span>login()<span class="pl-pds">"</span></span> <span class="pl-e">novalidate</span>&gt;
  &lt;<span class="pl-ent">ion-item</span> <span class="pl-e">no-padding</span> <span class="pl-e">no-lines</span>&gt;
    &lt;<span class="pl-ent">ion-input</span> <span class="pl-e">formControlName</span>=<span class="pl-s"><span class="pl-pds">"</span>customerId<span class="pl-pds">"</span></span> <span class="pl-e">placeholder</span>=<span class="pl-s"><span class="pl-pds">"</span>客户号<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>number<span class="pl-pds">"</span></span> <span class="pl-e">required</span>&gt;&lt;/<span class="pl-ent">ion-input</span>&gt;
  &lt;/<span class="pl-ent">ion-item</span>&gt;
  &lt;<span class="pl-ent">ion-item</span> <span class="pl-e">no-padding</span> <span class="pl-e">no-lines</span>&gt;
    &lt;<span class="pl-ent">ion-input</span> <span class="pl-e">formControlName</span>=<span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> <span class="pl-e">placeholder</span>=<span class="pl-s"><span class="pl-pds">"</span>登录密码<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> <span class="pl-e">required</span>&gt;&lt;/<span class="pl-ent">ion-input</span>&gt;
  &lt;/<span class="pl-ent">ion-item</span>&gt;
  <span class="pl-c"><span class="pl-c">&lt;!--</span> 其他代码…… <span class="pl-c">--&gt;</span></span>
&lt;/<span class="pl-ent">form</span>&gt;</pre></div>
<p>可以看到，在 <code>&lt;form&gt;</code> 元素上绑定了一个 <code>[formGroup]="loginForm"</code> 属性，对应于 ts 文件中的类属性 <code>loginForm</code> 的声明；而在输入项上，使用 <code>formControlName="customerId"</code> 的方式绑定了 <code>loginForm</code> 的属性，需要注意此处 <code>formControlName</code> 是必要的。</p>
<p><code>loginForm</code> 的每一个属性都是一个 <code>FormControl</code> 的实例，此处只简单为每个项设置了初值，并设置 <code>disabled: true</code> 让输入项在初始条件下不可激活，在本页面的初始化工作完成之后才会解除 <code>disabled</code> 。若创建 <code>FormControl</code> 的实例时，只需要赋初值、不用设置 <code>disabled</code> 属性，则参数可以不使用对象形式，例如： <code>customerId: new FormControl('')</code> 。</p>
<p>创建 <code>FormControl</code> 的实例时，还可以使用验证函数参数以及异步验证参数， <code>FormControl</code> 构造器的签名为：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(<span class="pl-smi">formState</span>: <span class="pl-smi">any</span>, <span class="pl-smi">validator</span><span class="pl-k">?:</span> <span class="pl-smi">ValidatorFn</span><span class="pl-k">|</span><span class="pl-smi">ValidatorFn</span>[]<span class="pl-k">|</span><span class="pl-c1">null</span>, <span class="pl-smi">asyncValidator</span><span class="pl-k">?:</span> <span class="pl-smi">AsyncValidatorFn</span><span class="pl-k">|</span><span class="pl-smi">AsyncValidatorFn</span>[]<span class="pl-k">|</span><span class="pl-c1">null</span>)</pre></div>
<p>即第二个参数允许是一个验证函数、或验证函数构成的数组，而第三个参数允许是一个异步验证函数或数组。简例：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">new</span> <span class="pl-en">FormControl</span>(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>, <span class="pl-smi">Validators</span>.<span class="pl-smi">required</span>)</pre></div>
<p>此处引入了 Validators 对象，使用了它的 required 成员方法。 <code>required</code> 之类的有效性限制，可以写在模板页输入项元素的属性上，也可以写在 <code>FormControl</code> 的实例创建调用处。</p>
<p>对表单进行验证时，可以对 <code>FormGroup</code> 的元素（属性）进行验证，例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">login</span>(){
  <span class="pl-k">const</span> controls <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">loginForm</span>.<span class="pl-smi">controls</span>;
  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">loginForm</span>.<span class="pl-smi">invalid</span>){
    <span class="pl-k">for</span> (<span class="pl-k">const</span> field <span class="pl-k">in</span> <span class="pl-smi">controls</span>){
      <span class="pl-k">const</span> fieldControl <span class="pl-k">=</span> <span class="pl-smi">controls</span>[<span class="pl-smi">field</span>];
      <span class="pl-k">if</span> (<span class="pl-smi">fieldControl</span>.<span class="pl-smi">invalid</span>){
        <span class="pl-c"><span class="pl-c">//</span> 针对输入项存在的问题，给出相应的提示消息</span>
        <span class="pl-k">return</span>;
      }
    }
  }
}</pre></div>
<p>首先检测 <code>FormGroup</code> 实例的 <code>invalid</code> 属性，若 <code>invalid</code> 为 <code>true</code> 就表示整个表单验证未通过，接下来对各个项目（ controls ）进行遍历，找到具体的问题。</p>
<p>此外，针对一些复杂的限制条件，可以在所有项目验证通过之后，再针对个别项目进行额外验证。</p>
</li>
</ol>
<h2>
<a id="11" class="anchor" href="#11" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>安全过滤与 DomSanitizer</h2>
<p>Angular 的引擎会对页面上的输出内容进行检查或过滤，以避免 XSS （跨站脚本攻击）。当动态渲染内容中包含特殊字符而被判定为可能有危险时，这些动态内容可能会被过滤替换，也可能会导致报错。</p>
<p>在页面上使用 <code>&lt;div&gt;{{htmlContent}}&lt;/div&gt;</code> 可能会导致 <code>htmlContent</code> 的内容被使用 html 实体（ html entity ）进行转义，例如 <code>&lt;</code> 会转换为 <code>&amp;lt;</code> ，也就是将 <code>htmlContent</code> 的内容处理为文本，以规避恶意代码。但有时我们确实需要显示 dom 内容，不期望 html 内容被转换为文本（前提是可以完全确信这些内容中不包含恶意代码），此时可以尝试以下的写法：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">div</span> [<span class="pl-e">innerHTML</span>]=<span class="pl-s"><span class="pl-pds">"</span>htmlContent<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">div</span>&gt;</pre></div>
<p>此外，有时候为自定义样式赋值时，由于样式内容中可能包含 <code>&lt;</code> 、 <code>&gt;</code> 、 <code>(</code> 、 <code>)</code> 等特殊字符，有可能会导致程序在执行时报错。此时需要使用 <code>DomSanitizer</code> 来解决此问题，例如 <code>/src/modals/camera/camera.ts</code> ：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(
  <span class="pl-smi">public</span> <span class="pl-smi">sanitizer</span>: <span class="pl-smi">DomSanitizer</span>,
) {

}

<span class="pl-en">getAllTransform</span>(){
    <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">sanitizer</span>.<span class="pl-en">bypassSecurityTrustStyle</span>(
        <span class="pl-s"><span class="pl-pds">`</span>translate(${<span class="pl-c1">this</span>.<span class="pl-smi">translateX</span>}px, ${<span class="pl-c1">this</span>.<span class="pl-smi">translateY</span>}px) scale(${<span class="pl-c1">this</span>.<span class="pl-smi">imageScale</span>})<span class="pl-pds">`</span></span>
    );
}</pre></div>
<p>对应的模板为：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">img</span> [<span class="pl-e">src</span>]=<span class="pl-s"><span class="pl-pds">"</span>picture<span class="pl-pds">"</span></span> *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>picture<span class="pl-pds">"</span></span> [<span class="pl-e">style</span>.<span class="pl-e">transform</span>]=<span class="pl-s"><span class="pl-pds">"</span>getAllTransform()<span class="pl-pds">"</span></span> /&gt;</pre></div>
<h1>
<a id="12" class="anchor" href="#12" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Ionic</h1>
<h2>
<a id="13" class="anchor" href="#13" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>保证 Ionic 控件的层级关系</h2>
<p>在登录页与主界面切换动画的问题上，某个旧版本的代码曾经使用过安卓版的纵向滑动效果，原因是当时使用 ios 的横向滑动时，若前往 TabsPage 页面并不会看见动画效果。当时检查发现动画函数确实有执行，但因为相关元素的 <code>z-index</code> 属性不正常，导致登录页的界面层被压在下方，动画效果不可见。</p>
<p>但是后来反复尝试，发现问题是来源于 TabsPage 中所使用的一个自定义的菜单控件。这个自定义菜单控件会导致在 <code>&lt;ion-menu&gt;</code> 之上多加一层 html 元素，结果影响到了页面元素层级关系，影响了相关样式的应用，也影响了动画效果。只要把 TabsPage 页面上的自定义菜单控件去掉，或者是直接使用官方的 <code>&lt;ion-menu&gt;</code> 、不额外进行一层封装，页面滑入滑出的效果就会正常。</p>
<p>观察 Ionic 的预设样式，会发现许多样式上都使用了子元素的选择器（例如 <code>.ion-row &gt; .ion-col</code> ）。这样若我们在 Ionic 的预设层级之间插入了自定义的控件元素，则不可避免的会在原有层级之间多出一层 html 元素（自定义控件所对应的元素），这样就破坏了 Ionic 预设的层级关系。由此可能带来各种各样的问题，包括样式不正确、页面元素行为不正确等等。会被影响的有 Ionic 的栅格布局（ grid ）、页头或页脚元素、菜单元素等等。因此在提取公共 html 代码、构建自定义元素时一定要小心，需要检查自定义元素是否会破坏原有的层级关系。</p>
<h2>
<a id="14" class="anchor" href="#14" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>二级页面不显示  Tabbar</h2>
<p>目前我们 APP 的一级页面构建在 Tabs 中，即界面下方会显示 Tabbar （标签条），点击 Tabbar 上的图标来切换页面。</p>
<p>有些页面的二级页面（例如新闻详情页）要求不显示 Tabbar ，这可以在对应的 ion-tab 元素上设置 <code>tabsHideOnSubPages="true"</code> 来实现。例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-tab</span> [<span class="pl-e">root</span>]=<span class="pl-s"><span class="pl-pds">"</span>infoTabsRoot<span class="pl-pds">"</span></span> <span class="pl-e">tabTitle</span>=<span class="pl-s"><span class="pl-pds">"</span>资讯<span class="pl-pds">"</span></span> <span class="pl-e">tabIcon</span>=<span class="pl-s"><span class="pl-pds">"</span>infos<span class="pl-pds">"</span></span> <span class="pl-e">tabsHideOnSubPages</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">ion-tab</span>&gt;</pre></div>
<p>注意：该属性只会对子页面有作用。也就是说，对于一级页面 <code>news.html</code> （新闻列表页）来说，底部的 Tabbar 依然是会显示的；而点击新闻条目后弹出的子页面（ <code>news-content.html</code> ，新闻详情页）， Tabbar 就会被页面内容遮住。</p>
<p><strong>鉴于所有二级页面都不需要显示 Tabbar ，因此后来将 <code>tabsHideOnSubPages</code> 的设置改到 <code>/src/app/app.module.ts</code> 中了，在 IonicModule 的启动参数中添加 <code>tabsHideOnSubPages: true</code> ，<code>tabs.html</code> 中所有 <code>tabsHideOnSubPages</code> 设置都已取消。</strong></p>
<h2>
<a id="15" class="anchor" href="#15" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>页面 footer 在导航后退时的问题</h2>
<p>新闻详情页使用了 <code>NavController</code> 组件进行导航显示，在页面弹出时会有从右向左滑入的动画，而页面收起或后退时会有从左向右滑出消失的动画。</p>
<p>此页面为二级页面，不显示 Tabbar ；并且它包含了一个 <code>&lt;ion-footer&gt;</code> 元素，用于显示提交评论的输入框。原先这个元素在页面滑出时会有显示问题， <code>&lt;ion-footer&gt;</code> 元素的背景会变为透明，然后与出现的 Tabbar 内容重叠在一起，在动画结束后 <code>&lt;ion-footer&gt;</code> 元素才会消失，视觉效果很不理想。</p>
<p>开始以为这是 Ionic2 设计上的缺陷，曾经通过在 <code>ionViewWillLeave()</code> 事件处理函数中增加代码、在离开页面时隐藏 <code>&lt;ion-footer&gt;</code> 元素来解决问题。但是发现这样貌似有效，却会有其他遗留问题。</p>
<p>后来经过试验发现，实际上官方已经给出了解决问题的简单方案，就是在 <code>&lt;ion-footer&gt;</code> 元素内再增加一层 <code>&lt;ion-navbar&gt;</code> ，这样其内部的内容就会在页面滑动时跟着移动了。对于 <code>&lt;ion-header&gt;</code> 的内容来说也是这样，在必要时应当使用 <code>&lt;ion-navbar&gt;</code> 。</p>
<h2>
<a id="16" class="anchor" href="#16" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NavPush 、 NavParams 与 NavPop</h2>
<p>Ionic2+ 没有使用路由的方式来切换页面，而主要使用了 <code>NavController</code> ，以便更好地在移动设备上实现页面前后导航。推入新的页面使用 <code>push()</code> 方法，弹出导航栈顶部的页面使用 <code>pop()</code> 方法（此外还有 <code>insert()</code> 、 <code>setRoot()</code> 、 <code>popToRoot()</code> 等相关方法）。</p>
<p>一般是在 ts 代码中获取 <code>NavController</code> 的实例，然后调用上面的各种方法。但若只需要在页面的某些元素被点击时执行页面推入、弹出的操作，则完全可以不使用 <code>NavController</code> ，直接在页面元素上使用 <code>NavPush</code> 或 <code>NavPop</code> 属性。例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-row</span> [<span class="pl-e">navPush</span>]=<span class="pl-s"><span class="pl-pds">"</span>stockDetailPage<span class="pl-pds">"</span></span>&gt;</pre></div>
<p>这样就可以直接在导航栈顶部推入 <code>StockDetailPage</code> 的一个实例页面（在本页面的 ts 代码中已经使用 <code>stockDetailPage: any = StockDetailPage;</code> 将 <code>StockDetailPage</code> 赋值给 <code>stockDetailPage</code> 属性）。</p>
<p>弹出页面的例子：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">button</span> <span class="pl-e">ion-button</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span> <span class="pl-e">navPop</span>&gt;返回&lt;/<span class="pl-ent">button</span>&gt;</pre></div>
<p>注意 <code>navPush</code> 属性因为需要设置对应的值（目标页面的类），因此需要使用方括号写成一个输入属性；而 <code>navPop</code> 则由于没有参数，所以可以直接书写为不加方括号的属性。</p>
<p>在使用 <code>[navPush]</code> 时，还可以配合 <code>[navParams]</code> 为新的页面传入参数，例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-row</span> [<span class="pl-e">navPush</span>]=<span class="pl-s"><span class="pl-pds">"</span>stockDetailPage<span class="pl-pds">"</span></span> [<span class="pl-e">navParams</span>]=<span class="pl-s"><span class="pl-pds">"</span>baseData?.stockCode<span class="pl-pds">"</span></span>&gt;</pre></div>
<p><code>[navParams]</code> 可以传入一个单值（数值、字符串等），也可以传入一个对象，例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-buttons</span> <span class="pl-e">end</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>hdr<span class="pl-pds">"</span></span> [<span class="pl-e">navPush</span>]=<span class="pl-s"><span class="pl-pds">"</span>tradeInterfacePage<span class="pl-pds">"</span></span> [<span class="pl-e">navParams</span>]=<span class="pl-s"><span class="pl-pds">"</span>stockCodeParams<span class="pl-pds">"</span></span>&gt;</pre></div>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">stockCodeParams</span> <span class="pl-k">=</span> {
  stockCode: <span class="pl-s"><span class="pl-pds">'</span>000001<span class="pl-pds">'</span></span>,
}</pre></div>
<p>在目标页面获取传递过来的参数时，可以直接取 <code>NavParams</code> 上的 <code>data</code> 属性，例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(
  <span class="pl-smi">private</span> <span class="pl-smi">navParams</span>: <span class="pl-smi">NavParams</span>,
) {
  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">navParams</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-k">typeof</span> <span class="pl-c1">this</span>.<span class="pl-smi">navParams</span>.<span class="pl-c1">data</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>string<span class="pl-pds">'</span></span>){
    <span class="pl-c1">this</span>.<span class="pl-smi">_stockCode</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">navParams</span>.<span class="pl-c1">data</span>;
  }
}</pre></div>
<p>如果所传入的参数是一个对象，也可以使用 <code>NavParams</code> 的 <code>get()</code> 方法：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(
  <span class="pl-smi">private</span> <span class="pl-smi">navParams</span>: <span class="pl-smi">NavParams</span>,
) {
  <span class="pl-c1">this</span>.<span class="pl-smi">_stockCode</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">navParams</span>.<span class="pl-c1">get</span>(<span class="pl-s"><span class="pl-pds">'</span>stockCode<span class="pl-pds">'</span></span>);
}</pre></div>
<h2>
<a id="17" class="anchor" href="#17" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ion-slides</h2>
<p><code>&lt;ion-slides&gt;</code> 幻灯控件用于显示若干个可以滑动切换的元素（ <code>&lt;ion-slide&gt;</code> 控件），例如用于展示幻灯图片。</p>
<h3>
<a id="18" class="anchor" href="#18" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>幻灯联动</h3>
<p>有时需要在幻灯切换时，对页面上的其他元素进行一些联动处理。若联动目标也是一个 <code>&lt;ion-slides&gt;</code> 控件，则只要为目标控件定义模板变量（使用 <code>#</code> ），并且在当前幻灯控件上使用 <code>contorl</code> 属性即可。例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-slides</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>slides-1<span class="pl-pds">"</span></span> [<span class="pl-e">control</span>]=<span class="pl-s"><span class="pl-pds">"</span>otherSlides<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">ion-slide</span>&gt;&lt;/<span class="pl-ent">ion-slide</span>&gt;
  &lt;<span class="pl-ent">ion-slide</span>&gt;&lt;/<span class="pl-ent">ion-slide</span>&gt;
  &lt;<span class="pl-ent">ion-slide</span>&gt;&lt;/<span class="pl-ent">ion-slide</span>&gt;
&lt;/<span class="pl-ent">ion-slides</span>&gt;

&lt;<span class="pl-ent">ion-slides</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>slides-2<span class="pl-pds">"</span></span> #<span class="pl-e">otherSlides</span>&gt;
  &lt;<span class="pl-ent">ion-slide</span>&gt;&lt;/<span class="pl-ent">ion-slide</span>&gt;
  &lt;<span class="pl-ent">ion-slide</span>&gt;&lt;/<span class="pl-ent">ion-slide</span>&gt;
  &lt;<span class="pl-ent">ion-slide</span>&gt;&lt;/<span class="pl-ent">ion-slide</span>&gt;
&lt;/<span class="pl-ent">ion-slides</span>&gt;</pre></div>
<p>此处有两个 <code>&lt;ion-slides&gt;</code> 元素，为第二个绑定了一个模板变量 <code>#otherSlides</code> ，同时在第一个上设置了 <code>[control]="otherSlides"</code> 属性，这样在第一个幻灯控件滑动切换时，第二个幻灯控件也会跟随切换。</p>
<p>也可以让这两个控件彼此进行控制，实现双向联动。</p>
<p>若联动目标并不是一个幻灯控件，那么就需要使用 <code>&lt;ion-slides&gt;</code> 的事件，一般是使用 <code>ionSlideWillChange</code> （切换之前触发）或 <code>ionSlideDidChange</code> （切换完成后触发），并传入 <code>$event</code> 参数。例如：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-slides</span> (<span class="pl-e">ionSlideWillChange</span>)=<span class="pl-s"><span class="pl-pds">"</span>slidesChange($event)<span class="pl-pds">"</span></span>&gt;</pre></div>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">Slides</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>ionic-angular<span class="pl-pds">'</span></span>;

@<span class="pl-en">Component</span>({
  selector: <span class="pl-s"><span class="pl-pds">'</span>page-test<span class="pl-pds">'</span></span>,
  templateUrl: <span class="pl-s"><span class="pl-pds">'</span>test.html<span class="pl-pds">'</span></span>
})
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">TestPage</span> {
  slidesChange(<span class="pl-v">slides</span><span class="pl-k">:</span> <span class="pl-en">Slides</span>) {
    <span class="pl-k">const</span> destIndex <span class="pl-k">=</span> <span class="pl-smi">slides</span>.<span class="pl-smi">realIndex</span>
    <span class="pl-c"><span class="pl-c">//</span> 后续处理……</span>
  }
}</pre></div>
<p>此处也可以使用 <code>slides._snapIndex</code> 。<strong>但不能使用 <code>slides._activeIndex</code> ，向前切换时会有越界问题。</strong></p>
<h3>
<a id="19" class="anchor" href="#19" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>向前切换时的越界问题</h3>
<p>在幻灯控件滑动切换时，子控件（ <code>&lt;ion-slide&gt;</code> ）上的样式也会自动调整，当前激活的 <code>&lt;ion-slide&gt;</code> 元素上会有 <code>swiper-slide-active</code> 的 class 。但此特性存在一个问题：</p>
<p>假设有 3 个 <code>&lt;ion-slide&gt;</code> 元素，当切换到第 3 个元素时，该元素上会有 <code>swiper-slide-active</code> class ；此时再向前切换（向左拖动以图显示右侧元素），则所有的 <code>&lt;ion-slide&gt;</code> 元素上都不会再有 <code>swiper-slide-active</code> ，而在 <code>ionSlideWillChange</code> 或 <code>ionSlideDidChange</code> 事件所接收到的参数（也就是 Slides 的实例）上， <code>_activeIndex</code> 属性的值将会是 3 ，也就是越界了（此时正常的有效值原本应当是 0～2 ）。而向后切换就没有这个问题， <code>_activeIndex</code> 最小值为 0 ，不会变成 -1 ，第一个 <code>&lt;ion-slide&gt;</code> 元素上会保留 <code>swiper-slide-active</code> class 。</p>
<p>这种表现不知道是 <code>&lt;ion-slides&gt;</code> 的故意设计，还是一个 bug 。</p>
<p>由此带来两个问题：</p>
<ol>
<li>
<p><code>slides._activeIndex</code> 不能用，因为不准确。</p>
</li>
<li>
<p>如果在样式设计上，有些样式是与 <code>swiper-slide-active</code> class 相关的，那么可能会出现显示效果不正常的情况。</p>
</li>
</ol>
<p>解决样式问题可以参考如下的方法：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">tabChange</span>(<span class="pl-smi">slides</span>: <span class="pl-smi">Slides</span>){
  <span class="pl-k">const</span> destIndex <span class="pl-k">=</span> <span class="pl-smi">slides</span>.<span class="pl-smi">_snapIndex</span>;
  <span class="pl-k">if</span> (<span class="pl-smi">slides</span>.<span class="pl-en">isEnd</span>() <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">slides</span>.<span class="pl-en">getActiveIndex</span>() <span class="pl-k">===</span> <span class="pl-smi">destIndex</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>) {
    <span class="pl-smi">slides</span>.<span class="pl-en">slideTo</span>(<span class="pl-smi">destIndex</span>, <span class="pl-c1">0</span>);
  }
}</pre></div>
<p>判断是否向前切换越界，若是，则使用 <code>slideTo</code> 跳回最后一个有效位置，并且将第二个参数指定为 0 ，不显示切换的动画过渡。</p>
<h2>
<a id="20" class="anchor" href="#20" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>水平方向的 ion-scroll</h2>
<p><code>&lt;ion-scroll&gt;</code> 控件用于显示可滚动的内容，通过用户的操作（例如手指在屏幕上滑动）来进行滚动。</p>
<p>此控件的缺点是没有提供编程方式的滚动功能。</p>
<p>如果是垂直方向的滚动，可以考虑不使用 <code>&lt;ion-scroll&gt;</code> ，直接使用 <code>&lt;ion-content&gt;</code> ，并利用其 <code>scrollTo()</code> 、 <code>scrollToBottom()</code> 、 <code>scrollToTop()</code> 等方法。</p>
<p>水平方向的滚动就没有现成的编程方法可用了，浏览器原生的 <code>scrollIntoView()</code> 方法只能让元素纵向滚动到视口。为了实现编程方式的滚动，就需要自行书写代码来实现，参考 <code>/src/pages/quotations/quotations.html</code> 与 <code>/src/pages/quotations/quotations.ts</code> （以下代码为片段，删除了一部分无关的内容）。</p>
<p>在 <code>&lt;ion-scroll&gt;</code> 元素上设置横向滚动的属性：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-scroll</span> <span class="pl-e">scrollX</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> #<span class="pl-e">sectorScroll</span>&gt;
    &lt;<span class="pl-ent">div</span> #<span class="pl-e">sectorTitles</span> *<span class="pl-e">ngFor</span>=<span class="pl-s"><span class="pl-pds">"</span>let item of sectorList; let i = index;<span class="pl-pds">"</span></span> (<span class="pl-e">click</span>)=<span class="pl-s"><span class="pl-pds">"</span>changeActive(i)<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">span</span>&gt;{{item.sectorName}}&lt;/<span class="pl-ent">span</span>&gt;
    &lt;/<span class="pl-ent">div</span>&gt;
&lt;/<span class="pl-ent">ion-scroll</span>&gt;</pre></div>
<div class="highlight highlight-source-ts"><pre>@<span class="pl-en">ViewChildren</span>(<span class="pl-s"><span class="pl-pds">'</span>sectorTitles<span class="pl-pds">'</span></span>) <span class="pl-smi">sectorTitles</span>;
@<span class="pl-en">ViewChild</span>(<span class="pl-s"><span class="pl-pds">'</span>sectorScroll<span class="pl-pds">'</span></span>) <span class="pl-smi">sectorScroll</span>: <span class="pl-smi">Scroll</span>;

<span class="pl-en">changeActive</span>(<span class="pl-smi">index</span>){
  <span class="pl-c1">this</span>.<span class="pl-en">sectorTitleDoScroll</span>(<span class="pl-smi">index</span>);
}

<span class="pl-smi">sectorTitleScrollTimer</span>: <span class="pl-smi">number</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;

<span class="pl-en">sectorTitleDoScroll</span>(<span class="pl-smi">index</span>) {
  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">this</span>.<span class="pl-smi">sectorScroll</span> <span class="pl-k">||</span> <span class="pl-k">!</span><span class="pl-c1">this</span>.<span class="pl-smi">sectorTitles</span>) {
    <span class="pl-k">return</span>;
  }

  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">sectorTitleScrollTimer</span>) {
    <span class="pl-c1">clearInterval</span>(<span class="pl-c1">this</span>.<span class="pl-smi">sectorTitleScrollTimer</span>);
    <span class="pl-c1">this</span>.<span class="pl-smi">sectorTitleScrollTimer</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;
  }

  <span class="pl-k">const</span> scrollContent <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">sectorScroll</span>.<span class="pl-smi">_scrollContent</span>.<span class="pl-smi">nativeElement</span> <span class="pl-k">as</span> <span class="pl-en">HTMLElement</span>;
  <span class="pl-k">const</span> contentWidth <span class="pl-k">=</span> <span class="pl-c1">parseFloat</span>(<span class="pl-c1">window</span>.<span class="pl-en">getComputedStyle</span>(<span class="pl-smi">scrollContent</span>).<span class="pl-c1">width</span>);
  <span class="pl-k">const</span> originalScrollLeft <span class="pl-k">=</span> <span class="pl-smi">scrollContent</span>.<span class="pl-smi">scrollLeft</span>;
  <span class="pl-k">const</span> titles <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">sectorTitles</span>.<span class="pl-en">toArray</span>() <span class="pl-k">as</span> <span class="pl-en">ElementRef</span>[];
  <span class="pl-k">const</span> activeTitle <span class="pl-k">=</span> <span class="pl-smi">titles</span>[<span class="pl-smi">index</span>];
  <span class="pl-k">let</span> totalWidth <span class="pl-k">=</span> <span class="pl-c1">0</span>;
  <span class="pl-k">let</span> prevTotalWidth <span class="pl-k">=</span> <span class="pl-c1">0</span>;
  <span class="pl-k">const</span> currentWidth <span class="pl-k">=</span> <span class="pl-c1">parseFloat</span>(<span class="pl-c1">window</span>.<span class="pl-en">getComputedStyle</span>(<span class="pl-smi">activeTitle</span>.<span class="pl-smi">nativeElement</span> <span class="pl-k">as</span> <span class="pl-en">HTMLElement</span>).<span class="pl-c1">width</span>);
  <span class="pl-k">for</span> (<span class="pl-k">let</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; <span class="pl-smi">i</span> <span class="pl-k">&lt;</span> <span class="pl-smi">titles</span>.<span class="pl-c1">length</span>; <span class="pl-smi">i</span><span class="pl-k">++</span>) {
    <span class="pl-k">const</span> thisWidth <span class="pl-k">=</span> <span class="pl-c1">parseFloat</span>(<span class="pl-c1">window</span>.<span class="pl-en">getComputedStyle</span>(<span class="pl-smi">titles</span>[<span class="pl-smi">i</span>].<span class="pl-smi">nativeElement</span> <span class="pl-k">as</span> <span class="pl-en">HTMLElement</span>).<span class="pl-c1">width</span>);
    <span class="pl-smi">totalWidth</span> <span class="pl-k">+=</span> <span class="pl-smi">thisWidth</span>;
    <span class="pl-k">if</span> (<span class="pl-smi">i</span> <span class="pl-k">&lt;</span> <span class="pl-smi">index</span>) {
      <span class="pl-smi">prevTotalWidth</span> <span class="pl-k">+=</span> <span class="pl-smi">thisWidth</span>;
    }
  }

  <span class="pl-k">const</span> leftSpacing <span class="pl-k">=</span> (<span class="pl-smi">contentWidth</span> <span class="pl-k">-</span> <span class="pl-smi">currentWidth</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>;
  <span class="pl-k">const</span> scrollLeft <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">min</span>(<span class="pl-smi">totalWidth</span> <span class="pl-k">-</span> <span class="pl-smi">contentWidth</span>, <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(<span class="pl-c1">0</span>, <span class="pl-smi">prevTotalWidth</span> <span class="pl-k">-</span> <span class="pl-smi">leftSpacing</span>));

  <span class="pl-k">if</span> (<span class="pl-smi">originalScrollLeft</span> <span class="pl-k">!==</span> <span class="pl-smi">scrollLeft</span>) {
    <span class="pl-k">const</span> spacing <span class="pl-k">=</span> <span class="pl-smi">scrollLeft</span> <span class="pl-k">-</span> <span class="pl-smi">originalScrollLeft</span>;
    <span class="pl-k">let</span> count <span class="pl-k">=</span> <span class="pl-c1">0</span>; 

    <span class="pl-c1">this</span>.<span class="pl-smi">sectorTitleScrollTimer</span> <span class="pl-k">=</span> <span class="pl-c1">setInterval</span>(() <span class="pl-k">=&gt;</span> {
      <span class="pl-smi">scrollContent</span>.<span class="pl-smi">scrollLeft</span> <span class="pl-k">=</span> <span class="pl-smi">originalScrollLeft</span> <span class="pl-k">+</span> <span class="pl-smi">spacing</span> <span class="pl-k">*</span> <span class="pl-k">++</span><span class="pl-smi">count</span> <span class="pl-k">/</span> <span class="pl-c1">20</span>;
      <span class="pl-k">if</span> (<span class="pl-smi">count</span> <span class="pl-k">===</span> <span class="pl-c1">20</span>) {
        <span class="pl-c1">clearInterval</span>(<span class="pl-c1">this</span>.<span class="pl-smi">sectorTitleScrollTimer</span>);
        <span class="pl-c1">this</span>.<span class="pl-smi">sectorTitleScrollTimer</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;
      }
    }, <span class="pl-c1">16</span>);
  }
}</pre></div>
<p>说明：</p>
<ul>
<li>使用了 <code>@ViewChildren</code> 与 <code>@ViewChild</code> 装饰器获得了对页面元素的引用。</li>
<li>使用 <code>sectorTitleScrollTimer</code> 属性来保存 <code>setInterval()</code> 产生的定时器。</li>
<li>计算每个子元素的宽度以及容器宽度。基于“当前激活的元素要尽量显示在容器的水平居中位置”的原则，计算出需要的 <code>scrollLeft</code> 值，并对其进行修正，以保证值不越界（越界不会引发浏览器行为出问题，但会影响定时器的计算）。</li>
<li>开启定时器，逐步修改 <code>scrollContent</code> 元素的 <code>scrollLeft</code> 值，直到目标值为止，以便产生动画效果。 <code>scrollContent</code> 元素实际上是 <code>&lt;ion-scroll&gt;</code> 元素的子元素 <code>&lt;div class="scroll-content"&gt;</code> ，在模板中不可见，是 Ionic 的控件产生的，使用 <code>sectorScroll._scrollContent.nativeElement</code> 可以获取到。</li>
<li>
<code>scrollLeft</code> 是 html 元素的一个属性，并不是 css 属性，因此不能直接用 css3 或 Angular 的动画与过渡功能来处理。此处代码比较累赘，今后可以考虑是否能进行优化。** Angular 等现代模板引擎不建议直接操作 DOM 元素，但在此问题上暂时还没有找到更好的解决方案。**</li>
</ul>
<blockquote>
<p>可以使用指令将其中的代码逻辑提取出来，参照之后完成的 <code>/src/directives/scroll-fix-x/scroll-fix-x.ts</code> 。</p>
</blockquote>
<h2>
<a id="21" class="anchor" href="#21" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Storage</h2>
<p>Ionic2+ 提供了 Storage 来解决数据存储的问题，并且它是一种智能的解决方案，会根据实际运行的平台来选择底层实现，优先使用 SQLite （在手机上），当 SQLite 不可用时，会自动进行降级，改为使用 localStorage 或 IndexedDB 等方式。</p>
<p>Storage 可用于存储简单的 键/值 对，也可以用于存储 JSON 对象。 Storage 的所有方法都是基于 Promise 的，因此在使用时，需掌握 Promise 的特性以及 <code>Promise.all()</code> 等方法。</p>
<p>高交所 APP 目前暂时使用 Storage 来存储用户账号、密码、 token 等信息，后期可以考虑将股票的名称也保存在 Storage 中（这样列表加载时可以直接看到股票名称，不用等服务端返回详细数据。但由于股票有可能改名，因此最终依然要使用服务端返回的数据，本地缓存的股票名称仅用于加快列表的显示）。</p>
<p>在 <code>/src/providers/app-data-service.ts</code> 代码中，对 <code>token</code> 、 <code>customerId</code> 等属性进行了劫持，在设置这些属性值的时候，自动将新的值写入到 Storage 中。之前使用了 ES6 的代理对象（ Proxy ）来实现此需求，但代码书写与使用并没有得到简化，因此后来改用 <code>Object.defineProperty</code> 。</p>
<p>在进入 APP 时，会使用 <code>Promise.all()</code> 来读取所有储存在 Storage 中的数据，在读取完毕后触发 APP 的初始化（利用类型为 Promise 的属性 <code>_dataReady</code> ）。</p>
<h1>
<a id="22" class="anchor" href="#22" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设备相关</h1>
<h2>
<a id="23" class="anchor" href="#23" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>插件安装</h2>
<p>Native 插件的安装与使用参考： <a href="http://ionicframework.com/docs/native/">Ionic Native</a> 。</p>
<p>安装 Native 插件需要注意：不仅是开发用的电脑需要执行安装流程，构建用的电脑也需要再执行一次安装，否则所构建出的 APP 有些功能会无法使用。</p>
<h2>
<a id="24" class="anchor" href="#24" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>构建 APP</h2>
<p>构建 APP 一般使用 <code>ionic cordova build &lt;平台名称&gt; --prod</code> 命令行指令，其中 <code>&lt;平台名称&gt;</code> 是 <code>android</code> 、 <code>ios</code> 等。</p>
<p>在构建之前，需要先使用 <code>ionic cordova platform add &lt;平台名称&gt;</code> 来添加平台。其中 <code>ios</code> 平台的添加与构建只能在苹果电脑（如 Macbook 、 iMac ）上进行。安卓平台添加时，需要安装 Java SDK ，并设置好相关的环境变量（主要是 <code>ANDROID_HOME</code> ），根据所用电脑的不同，设置方法也不同。另外需要注意，在 Windows 电脑中，需要下载 <code>tools_r25.2.3-windows</code> 并解压到合适的位置（ <code>ANDROID_HOME</code> 下的 tools 子目录），否则会报告 gradle 找不到的错误。</p>
<p>调试 APP 可以使用 <code>ionic cordova run &lt;平台名称&gt; -l</code> ，或 <code>ionic cordova emulate &lt;平台名称&gt;</code> ，可以在浏览器或模拟器中对 APP 的页面进行实施查看、修改、跟踪。</p>
<p>创建正式版本的 APP 需要使用 <code>ionic cordova build &lt;平台名称&gt; --prod --aot --minifyjs --minifycss --optimzejs --device</code> ，让构建产品 js 、 css 被混淆压缩。</p>
<h2>
<a id="25" class="anchor" href="#25" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>android 透明状态栏</h2>
<p>Ionic2 安装了 <code>cordova-plugin-statusbar</code> 插件后，在 ios 下默认就有透明状态栏，也就是设备屏幕顶部的状态栏会融入到 APP 的背景中。</p>
<p>而在 Android 中，默认情况下状态栏与 APP 是分离的，状态栏背景会显示为黑色， APP 无法占据这块显示空间。</p>
<p>通过修改与 android 框架有关的文件可以实现透明状态栏（参考资料 <a href="http://www.jianshu.com/p/4c283e37294f">ionic2实现透明状态栏</a> ）。但这需要修改 <code>platforms/android/</code> 目录下的文件，此文件一般不会被包含在项目的代码仓库中，因此这种方式存在隐患，也不够正规。</p>
<p>仅仅修改项目自身代码也可以实现 android 的透明状态栏：</p>
<ol>
<li>
<p>引入 AndroidFullScreen 插件，</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">AndroidFullScreen</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>../../node_modules/@ionic-native/android-full-screen<span class="pl-pds">'</span></span>;</pre></div>
</li>
<li>
<p>在 constructor() 方法的参数中进行声明：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(<span class="pl-smi">public</span> <span class="pl-smi">androidFullScreen</span>: <span class="pl-smi">AndroidFullScreen</span>)</pre></div>
</li>
<li>
<p>在 <code>platform.ready().then()</code> 中添加如下代码：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">if</span> (<span class="pl-smi">platform</span>.<span class="pl-en">is</span>(<span class="pl-s"><span class="pl-pds">'</span>android<span class="pl-pds">'</span></span>)){
  <span class="pl-c1">this</span>.<span class="pl-smi">androidFullScreen</span>.<span class="pl-en">isImmersiveModeSupported</span>()
    .<span class="pl-en">then</span>(() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">androidFullScreen</span>.<span class="pl-en">immersiveMode</span>())
    .<span class="pl-en">then</span>(() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">androidFullScreen</span>.<span class="pl-en">showSystemUI</span>())
    .<span class="pl-en">then</span>(() <span class="pl-k">=&gt;</span> <span class="pl-c1">this</span>.<span class="pl-smi">androidFullScreen</span>.<span class="pl-en">showUnderStatusBar</span>())
    .<span class="pl-en">catch</span>((<span class="pl-v">error</span><span class="pl-k">:</span> <span class="pl-c1">any</span>) <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">error</span>.<span class="pl-smi">message</span> <span class="pl-k">||</span> <span class="pl-smi">error</span>));
}</pre></div>
</li>
<li>
<p>修改项目的设置文件 <code>config.xml</code> ，添加一行：</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">preference</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>StatusBarBackgroundColor<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>#00FFFFFF<span class="pl-pds">"</span></span>/&gt;</pre></div>
<p>此处的颜色值使用 <code>hex color</code> ，前两位表示色彩的饱和性，后六位为 RGB 颜色值。此处在前两位设置了 <code>00</code> ，代表完全透明，这样就实现了完全透明的状态栏。</p>
<blockquote>
<p>此步骤是否有必要，存疑。使用修改 <code>platforms/android/</code> 目录下文件的方式时，需要有这一步。而新方法是否必须有此步骤并未测试。</p>
</blockquote>
</li>
</ol>
<p>注意：</p>
<ol>
<li>
<p>由于状态栏融入了背景，因此页面顶部元素（ <code>ion-header</code> ）的高度可能会不够，可能出现顶部元素的内容与状态栏文字重叠的情况，需要增加 <code>ion-header</code> 元素的顶部内边距：</p>
<div class="highlight highlight-source-scss"><pre><span class="pl-e">.platform-ios</span> {
  <span class="pl-c1"><span class="pl-ii">ion-header</span></span> {
    <span class="pl-c1"><span class="pl-c1">padding-top</span></span>: <span class="pl-smi">$cordova-ios-statusbar-padding</span>;
  }
}

<span class="pl-e">.platform-android</span> {
  <span class="pl-c1"><span class="pl-ii">ion-header</span></span> {
    <span class="pl-c1"><span class="pl-c1">padding-top</span></span>: <span class="pl-smi">$cordova-md-statusbar-padding</span>;
  }
}

<span class="pl-e">.platform-windowsphone</span> {
  <span class="pl-c1"><span class="pl-ii">ion-header</span></span> {
    <span class="pl-c1"><span class="pl-c1">padding-top</span></span>: <span class="pl-smi">$cordova-wp-statusbar-padding</span>;
  }
}</pre></div>
<p>这样修改仍然会有后遗症，在某些 iphone 上会出现顶部边距偏大的问题，需要进一步修改：</p>
<div class="highlight highlight-source-scss"><pre><span class="pl-e">.platform-ios</span> {
  <span class="pl-c1"><span class="pl-ii">ion-header</span></span> {
    <span class="pl-c1"><span class="pl-c1">padding-top</span></span>: <span class="pl-smi">$cordova-ios-statusbar-padding</span>;

    &gt;<span class="pl-c1"><span class="pl-ii">ion-navbar</span></span><span class="pl-e">.toolbar.statusbar-padding</span> {
      <span class="pl-c1"><span class="pl-c1">margin-top</span></span>: -<span class="pl-smi">$cordova-ios-statusbar-padding</span>;
    }

    <span class="pl-e">.header-with-bg</span> {
      <span class="pl-c1"><span class="pl-c1">margin-top</span></span>: -<span class="pl-smi">$cordova-ios-statusbar-padding</span>;
      <span class="pl-c1"><span class="pl-c1">padding-top</span></span>: <span class="pl-smi">$cordova-ios-statusbar-padding</span>;
    }
  }
}</pre></div>
<p>具体情况需要具体分析，以上样式修改供参考。</p>
</li>
</ol>
<h2>
<a id="26" class="anchor" href="#26" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>软键盘弹出时的处理</h2>
<p>在实现了 iphone 与 android 的透明状态栏之后，会导致输入框获得焦点时的行为不正常。</p>
<p>在默认情况下，当输入框获得焦点后，软键盘弹出，页面高度会自动调整，以保证 <code>&lt;ion-footer&gt;</code> 以及输入框元素的正常显示，保证其不会被软键盘遮住。而实现透明状态栏相当于启用了全屏模式，页面高度不会再自动调整。</p>
<p>示例：</p>
<p>启用透明状态栏之前：</p>
<p><a href="///D://Develop%20Files/books/ionic2/statusbar-before.jpg" target="_blank"><img src="data:image/jpeg;base64,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c2VudW0AAAAAUGdQcwAAAABQZ1BDAAAAAExlZnRVbnRGI1JsdAAAAAAAAAAAAAAAAFRvcCBVbnRGI1JsdAAAAAAAAAAAAAAAAFNjbCBVbnRGI1ByY0BZAAAAAAAAAAAAEGNyb3BXaGVuUHJpbnRpbmdib29sAAAAAA5jcm9wUmVjdEJvdHRvbWxvbmcAAAAAAAAADGNyb3BSZWN0TGVmdGxvbmcAAAAAAAAADWNyb3BSZWN0UmlnaHRsb25nAAAAAAAAAAtjcm9wUmVjdFRvcGxvbmcAAAAAADhCSU0D7QAAAAAAEABIAAAAAQACAEgAAAABAAI4QklNBCYAAAAAAA4AAAAAAAAAAAAAP4AAADhCSU0EDQAAAAAABAAAAB44QklNBBkAAAAAAAQAAAAeOEJJTQPzAAAAAAAJAAAAAAAAAAABADhCSU0nEAAAAAAACgABAAAAAAAAAAI4QklNA/UAAAAAAEgAL2ZmAAEAbGZmAAYAAAAAAAEAL2ZmAAEAoZmaAAYAAAAAAAEAMgAAAAEAWgAAAAYAAAAAAAEANQAAAAEALQAAAAYAAAAAAAE4QklNA/gAAAAAAHAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAOEJJTQQIAAAAAAAQAAAAAQAAAkAAAAJAAAAAADhCSU0EHgAAAAAABAAAAAA4QklNBBoAAAAAA1UAAAAGAAAAAAAAAAAAAAGrAAAA8AAAABAAcwB0AGEAdAB1AHMAYgBhAHIALQBiAGUAZgBvAHIAZQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA8AAAAasAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAG51bGwAAAACAAAABmJvdW5kc09iamMAAAABAAAAAAAAUmN0MQAAAAQAAAAAVG9wIGxvbmcAAAAAAAAAAExlZnRsb25nAAAAAAAAAABCdG9tbG9uZwAAAasAAAAAUmdodGxvbmcAAADwAAAABnNsaWNlc1ZsTHMAAAABT2JqYwAAAAEAAAAAAAVzbGljZQAAABIA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OkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06RG9jdW1lbnRJRD0iOThENzRFM0FDQUQzMDM1QjhENDY1N0Q0RkZFQjY3RkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTRiOTQyNmYtMTc5My01YjRjLTk0ODItOTVlZjZmMWIyNTk0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9Ijk4RDc0RTNBQ0FEMzAzNUI4RDQ2NTdENEZGRUI2N0ZEIiBkYzpmb3JtYXQ9ImltYWdlL2pwZWciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHhtcDpDcmVhdGVEYXRlPSIyMDE3LTA1LTEyVDEwOjQ4OjE5KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxNy0wNS0xMlQxMDo1MjowNCswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxNy0wNS0xMlQxMDo1MjowNCswODowMCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjU0Yjk0MjZmLTE3OTMtNWI0Yy05NDgyLTk1ZWY2ZjFiMjU5NCIgc3RFdnQ6d2hlbj0iMjAxNy0wNS0xMlQxMDo1MjowNCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8P3hwYWNrZXQgZW5kPSJ3Ij8+/+4ADkFkb2JlAGSAAAAAAf/bAIQADAgICAkIDAkJDBELCgsRFQ8MDA8VGBMTFRMTGBEMDAwMDAwRDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAENCwsNDg0QDg4QFA4ODhQUDg4ODhQRDAwMDAwREQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgBqwDwAwEiAAIRAQMRAf/dAAQAD//EAT8AAAEFAQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAABBAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHxY3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A4/Hxrcgu9MtAZG4vdtEuOytg/wCEtf7a2oh6bmC+rHLR6t7tjW7vovhrzVf/AKKxrHsdtUMbLsxi41hj9+0kPG4bmH1KbBq33VvRH9SybK66rNr2VCA07tdW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" alt="启用透明状态栏之前" style="max-width:100%;"></a></p>
<p>启用透明状态栏之后：</p>
<p><a href="///D://Develop%20Files/books/ionic2/statusbar-after.jpg" target="_blank"><img src="data:image/jpeg;base64,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dGxvbmcAAAAAAAAADWNyb3BSZWN0UmlnaHRsb25nAAAAAAAAAAtjcm9wUmVjdFRvcGxvbmcAAAAAADhCSU0D7QAAAAAAEABIAAAAAQACAEgAAAABAAI4QklNBCYAAAAAAA4AAAAAAAAAAAAAP4AAADhCSU0EDQAAAAAABAAAAB44QklNBBkAAAAAAAQAAAAeOEJJTQPzAAAAAAAJAAAAAAAAAAABADhCSU0nEAAAAAAACgABAAAAAAAAAAI4QklNA/UAAAAAAEgAL2ZmAAEAbGZmAAYAAAAAAAEAL2ZmAAEAoZmaAAYAAAAAAAEAMgAAAAEAWgAAAAYAAAAAAAEANQAAAAEALQAAAAYAAAAAAAE4QklNA/gAAAAAAHAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAOEJJTQQIAAAAAAAQAAAAAQAAAkAAAAJAAAAAADhCSU0EHgAAAAAABAAAAAA4QklNBBoAAAAAA1MAAAAGAAAAAAAAAAAAAAGrAAAA8AAAAA8AcwB0AGEAdAB1AHMAYgBhAHIALQBhAGYAdABlAHIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAPAAAAGrAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAAGrAAAAAFJnaHRsb25nAAAA8AAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAAAABUb3AgbG9uZwAAAAAAAAAATGVmdGxvbmcAAAAAAAAAAEJ0b21sb25nAAABqwAAAABSZ2h0bG9uZwAAAPAAAAADdXJsVEVYVAAAAAEAAAAAAABudWxsVEVYVAAAAAEAAAAAAABNc2dlVEVYVAAAAAEAAAAAAAZhbHRUYWdURVhUAAAAAQAAAAAADmNlbGxUZXh0SXNIVE1MYm9vbAEAAAAIY2VsbFRleHRURVhUAAAAAQAAAAAACWhvcnpBbGlnbmVudW0AAAAPRVNsaWNlSG9yekFsaWduAAAAB2RlZmF1bHQAAAAJdmVydEFsaWduZW51bQAAAA9FU2xpY2VWZXJ0QWxpZ24AAAAHZGVmYXVsdAAAAAtiZ0NvbG9yVHlwZWVudW0AAAARRVNsaWNlQkdDb2xvclR5cGUAAAAATm9uZQAAAAl0b3BPdXRzZXRsb25nAAAAAAAAAApsZWZ0T3V0c2V0bG9uZwAAAAAAAAAMYm90dG9tT3V0c2V0bG9uZwAAAAAAAAALcmlnaHRPdXRzZXRsb25nAAAAAAA4QklNBCgAAAAAAAwAAAACP/AAAAAAAAA4QklNBBEAAAAAAAEBADhCSU0EFAAAAAAABAAAAAE4QklNBAwAAAAAEHgAAAABAAAAWgAAAKAAAAEQAACqAAAAEFwAGAAB/9j/7QAMQWRvYmVfQ00AAv/uAA5BZG9iZQBkgAAAAAH/2wCEAAwICAgJCAwJCQwRCwoLERUPDAwPFRgTExUTExgRDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwBDQsLDQ4NEA4OEBQODg4UFA4ODg4UEQwMDAwMEREMDAwMDAwRDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIAKAAWgMBIgACEQEDEQH/3QAEAAb/xAE/AAABBQEBAQEBAQAAAAAAAAADAAECBAUGBwgJCgsBAAEFAQEBAQEBAAAAAAAAAAEAAgMEBQYHCAkKCxAAAQQBAwIEAgUHBggFAwwzAQACEQMEIRIxBUFRYRMicYEyBhSRobFCIyQVUsFiMzRygtFDByWSU/Dh8WNzNRaisoMmRJNUZEXCo3Q2F9JV4mXys4TD03Xj80YnlKSFtJXE1OT0pbXF1eX1VmZ2hpamtsbW5vY3R1dnd4eXp7fH1+f3EQACAgECBAQDBAUGBwcGBTUBAAIRAyExEgRBUWFxIhMFMoGRFKGxQiPBUtHwMyRi4XKCkkNTFWNzNPElBhaisoMHJjXC0kSTVKMXZEVVNnRl4vKzhMPTdePzRpSkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2JzdHV2d3h5ent8f/2gAMAwEAAhEDEQA/AOX6dRVmMLK6GOupDC/1LXtNnqWMxq/TYyuxv8/bTX9Ov+d/t1XXNbh41Dsvpu0H9F6u6h4c9rd9rq9nq7t27/C/Q2W/pLbWfosVrX1EhtrWExO26tp0Ie36Nrfova1/9dWbcvJyXOfk5XrOe82O33sI3uG1zwz1fTY7aNnsb/N/o/5tIDRdJsNyMMWF5xA4EW+wvhs2SatGMbt+zP2sZ7v5j1Nnp3+jfXTeyWwdfNTG39+v/t2v/wBKJHbH06/+3av/AEoktaALmuIUtxKM5tcn3V/9u1f+lUM7QdH1f9u1f+lUCGSwxZYxj9z6xbAlrXfR3AtcC9v+Fr9ux9X56Kc3DbTk1Mww03tYKXeoXGl4H6Z9RLf5u1/vZV+Z/NetsQH68Pr/AO3av/SqGWH96v8A7eq/9KpoUaTW5dTi19WLTU4VOre3buYS4bfXawncy5n+Dfu/RqJyMMWVlmLNbGNa5tlhJe4WC19zn1tr/nKv1b09myutBLHfvV/9vVf+lU3pu/er/wC3qf8A0qnI0bRzOnmmqt2CHPYSbbg8VusBJ2t/Q1tbVt+iqc/ln5fup/Sf+9X/ANvVf+lU/oW/yP8At2r/ANKocOla73ue/EjhFVZ34vml+9xb/u/1P8D5H//Q3/qN03plv1KxMy7p1GZkfrBJfUx73RkXsbueWWWO2Mb+a2yz0/5quz+bW5V036v24DstvS8QOY1+5hoYIcydzDvqZY33N/wlddn/AAa826J9fOt9E6ZT0zEoxbKKC8sdaLC8+o997t3p2Nb9O1Xv/HT+shEHFwo/q2/+lUgkveV9O6C5jXHpFG5wBgY9ZEkbvpbG/wCci09G6FaXf5LxmgRBdRXqD/ZXn4/xp/WP/uLhf5tv/pVP/wCOl9Y/+42F/m2/+lUkPof/ADe6B/5W4n/bFf8A5BN/zd+r5/7zMT/tiv8A8gvNrP8AG39ZWGBiYJ+Vv/pVMP8AG19ZyJ+yYP3W/wDpVIlPCX0r/m59Xv8Ayrw//Yer/wAgl/zb+rv/AJV4f/sPV/5BeZH/ABvfWYf9pMH7rf8A0ql/47/1m/7iYP3W/wDpVCwnhL6Z/wA2/q7/AOVeH/7D1f8AkEv+bf1d/wDKvD/9h6v/ACC8z/8AHf8ArLH9EwZ+Fv8A6VUf/Hg+s3/cPB+63/0qlaKL6d/zb+rv/lXh/wDsPV/5BfNcnx/MXo3/AI8P1m/7h4P3W/8ApVef/Zx4njaiqi//0eXw8jCp9T7VV6u9oFfta7afdL/0jm/yE2TdiW+l9mq9EMYG2cDc+Bus9h/1/wDPcKnkbvTe1vE7g0zz++16l694n9I06To1h/8ARaASikeIUbLWsbyEZ2Vc0SXD/MZ/5BVn5eQ4/TEf1K//AEmkTSQLaznBxklLfAiUb7RkfvD/ADK//SaRyMj98f5lf/pNNXtYkeKUjxCsfacj94f5lf8A6TTfacj98f5lf/pNJDXJHiFEkRyFZ+03/vj/ADK//SaicnI/fH+ZX/6TSUiqfWxrxY0WOc2GO3EbHSDv2t/nfZ7Nlil61XgFI5OR++P8yv8A9JqP2rI/fH+ZX/6TRU//0uGHpyfVLx4bA0/fvLUZrscDm37mf+TUqG3O3ejWbBpuAaXeO2VJ1Oc6f0Fmo2mK3DT5JoNAspNonOx3d7vuZ/5NRjG8bvuZ/wCTU/smX/oLf8x39yk3CyxqaLP8x39ybujZi1uKBJNv3M/8moO+yk83fcz/AMmiWY2WdBRb/mO/uQ/smZ/oLf8AMd/cioMYxvG77mf+TTH7L43fdX/5NS+yZn/ce3/Md/cmOJmf9x7f8x39ySmB+y+N33V/+TUT9l8bvur/APJqZw8z/uPb/mO/uUTh5v8A3Ht/zHf3IqYn7J43f5tf/k00Ynjf/m1/+TT/AGLN/wC49v8AmO/uS+x5v/ca3/tt39yKn//T4oNpcNthiODt3fFRNWOJjXTT2ge7w7o9dXP6MW8cl+n/AG0+v6SlsaJnHZoJOt3Hj/PJlFfYaoqrGpaPuCRayJ2j7gjuc2daK4/rW/8ApdDfZX3oZ/nW/wDpdJLXLGfuj7gmLK/3W/cEY2V/6Cv/ADrv/S6j6lZ/7T1/513/AKXSShLK/wB1v3BR2M/db9wRjbV/3Hr/AM67/wBLqdZreZOPWGj+Vd/6XSU1jXWRJaPuChsZ+637grNltO6G0VkD+Vd/6XQjdUP+01f+dd/6XTkIi2v90fcFHZX+6PuCN61X/cav/Ou/9LpetV/3Gr/zrv8A0ukp/9Tja3O1ixtcfvEifhsa9SJP+nq8PpP/APSarNtrbPqN3TxrBEJjbTrDYlsD3TB/f1UerLwtjQ/4an/Od/6SQ7GAn+ep/wA53/pJBDxPI+9T9hG5zgB8UgogBdtG4x61P+c7/wBJIjsdhG0XU/5zv/SSruuaNGEfelWQTJcPvRQWZxJcALqY/rO/9JJ7WNa3Y26kePud/wCkk4cJgEeZlV7SGkyR96KN1jSP9PR/nO/9JJvRb/p6P853/pJQ9sTuH3ptPEfeilKKGn/D0f5zv/SSXoN/09P+c7/0khbm+I+9Nub4j70lP//VK/8AxVPw63W2fWCrHr0Dn2YoDfBvvuytvdSp/wAV2RkVNuo+sNVtTxLLGYbHNI/kubkLvOqYBz8YV12Ci+uxttN5YLNjmmHQwln85S+2n2vY/wDSp+m4AwMX7OH+pL32Ehja2h1jvUe2mmr21Vb3fR97/wDSWWWJUKTxyeEf/ityaWOtt+sFVdbBLnvw2taB/Kc7IDWqZ/xWZ7h/y6yO0YTf/ehdp1npOP1fBOHkOcxhc2wObB9zDuaLK3zXbU76NlT/APz4j4OHVg4VGFS5768attTHWHc8ho27rHae9yVBXEXgXf4q8tg3P+sFbBMS7DaBP9rIU2/4rM7b7eusIOoIwm/+9C7LrHRMPrNVNWWXBtFhtYG7TLix9PvFjX+3bZ+arWHi14eHj4VRLqsWplNZdG4traK2l+wMZu9v5rEqCLLwn/jXZrBr16sSQJOE0ak7Wj+k/nOUXf4qM5x166z/ANgm/wDvQu7y8KrLDBY57fTcHDY4jh1dv0fof4Fv6X+fo/7TWU2I7WhrQ0TDQAJJJgaaudLnJKsvnTv8U+WPpfWCtvhOGwf9Vkeaf/xps0aft5uun9Cb/wCl13HUuk43UjQ69zmnHJdXsDDqdn0vVZZub+j/AJr+af8A4VnsrV06kHzlJVl86/8AGkzef262P/CLf/S6b/xpc3/y+b/7BN/9Lr0L7PT9o+1bT62z0924xtmf5ufT3/8ACbPURElWX//W9Eyst1GRjVitzha7aXNJj3EVxtDX7tm71/e+n9HWln5NmO2sspsul0n0ufZ7tr/a/wBj27v+oVpIOkSJHbUEHT4pKa3UL3Y+K57WuJ3MYSw7S3c4Nc/eWu9rP6qJmWPrx7HVMc98ANbXAdLiK5Zua9vs37/c1FBOuhEGNdPuUG3NdbZUA7dVt3EiAdwkbXfnJKVj2Osx6rC0tc9jXFjuQSPoP0Hu3fT9ihhOsfiUOtBa9zGlwcS5wn99xZTuf+/+jYib5s2Q6du7dB287dvqfR3/AMhOXw9rSHHdJDgCW6dnO/NSUhw322VE2tcxwse2HkE6OLfzWs/Rb932f/uv6VibGyDbbewsez03wS6YkF9e1mjf8HVXkf8AoUjlxBb7S7cdsjWNCdz/AOR7UnOIAMF2oEN1Op2z/Vb9JySmDSftNo923ZWRP0JJtDvT0+n7f0vu/wBGguyHjqLKAx+xzDJn26zZ6uzb+Z6fob/V+nez9ErFtnp1Ps2ueGNLtjBucYE7a2fnvU9ePwSU17rLRl0Vsre5hD3WPDgGNGjB6jS39J9L2M3o6ZrtzQ6C3cAdp0IkcO/lJ0lP/9f05Aw8VuJT6LXvsaHFwNkF0uO9/uaG/Ss32f8AXFOyx7HNa1m/dyfDUD+KVFj7Glz2GsgwAQRpAM+74pKYY2I3Gde5ri717DaQQAATzEJVYjasm7IDiTdy2AB2PuLfdb/wfqfzTPYljXvtsyAWwyu0sYTIJAADvY9jNjN7XbP5z1f53+b9NKu978y6k1vaytrS20/QcT9P0/b9Nm79L7/9F/wvppTIY1Yyn5eptfW2rnQNYXO9o/lOf7lC3DFmVVk7y11Om2AZHu0BeC6vdv8A0vp/zv6P/Rp/tDvtn2f0yGbN3qGdT/J2sNe1v0Pfdv3/AOCUrLrG5FVQrLmWAk2CYbt+lvMez830/wDS/wBhJTHIw68iyp73PaaTLQwwCd1Vvv8A32/oNuxTyaftFRq3msOI3FoBJaDucz3fv/vIeVk2UWY7GUutF1gY9zZ9o09zoa797d/1tLNyLcan1K6X5EE7mV6uDQ19hc1oa/f/ADezZ/L/AEf6X9G9KZ5eMzLofRY57GvIJdW4td7XNs9r2+5v0UnUNdinGLiGurNRc0Bpgt9Pc1rfY1LLtfTQ6xjHWEFoLWTuDXOayyxm1r9zqa3Ot27ffsUsex9tFdllZqe9oc6omS0nlkkNSUyaHBrQ9254A3OiJPjt/NTrM6b1a/MyjTbS2kbLHFnu3sLHtrbXduaK9z9/+DWmjSrf/9D04uDRJIaPEmAkCCAQZB4I1ChbUy5oa+YDg7TxCepgrrZWDIY0NBPJgJKZme/ZMgsxamPD26bTLRA00I2/R/lI0ag66Tp218UlKUXW1te2tzw19k7GEwXbRuftH8hqkq11eS631G1UPdVu+z2Pc8Fu5oHvY1j93v8A5aSmykkmjUHXSdJ018UlL69kjpzp4yh2UVWPZY8Eur+iQSIT+iz0DRqWFpZJMmDp9IpKZ7gdNwPgJnhJV6sCiqxljZ3VztmPziXH83zVhJT/AP/ZOEJJTQQhAAAAAABdAAAAAQEAAAAPAEEAZABvAGIAZQAgAFAAaABvAHQAbwBzAGgAbwBwAAAAFwBBAGQAbwBiAGUAIABQAGgAbwB0AG8AcwBoAG8AcAAgAEMAQwAgADIAMAAxADUAAAABADhCSU0EBgAAAAAABwABAAAAAQEA/+EMwWh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwNjcgNzkuMTU3NzQ3LCAyMDE1LzAzLzMwLTIzOjQwOjQyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1wTU06RG9jdW1lbnRJRD0iMUFDMUM3NjUxNTU5NjlFQzNDNzFEMDM0Q0NGQ0JBOUEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ZDQzODJmZjItZTk3Yy0zNDQ2LThkMjktNGE2MDM5MjExOWUwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9IjFBQzFDNzY1MTU1OTY5RUMzQzcxRDAzNENDRkNCQTlBIiBkYzpmb3JtYXQ9ImltYWdlL2pwZWciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHhtcDpDcmVhdGVEYXRlPSIyMDE3LTA1LTEyVDEwOjQ4OjE5KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxNy0wNS0xMlQxMDo1MjoyMCswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxNy0wNS0xMlQxMDo1MjoyMCswODowMCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmQ0MzgyZmYyLWU5N2MtMzQ0Ni04ZDI5LTRhNjAzOTIxMTllMCIgc3RFdnQ6d2hlbj0iMjAxNy0wNS0xMlQxMDo1MjoyMCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8P3hwYWNrZXQgZW5kPSJ3Ij8+/+4ADkFkb2JlAGSAAAAAAf/bAIQADAgICAkIDAkJDBELCgsRFQ8MDA8VGBMTFRMTGBEMDAwMDAwRDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAENCwsNDg0QDg4QFA4ODhQUDg4ODhQRDAwMDAwREQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8AAEQgBqwDwAwEiAAIRAQMRAf/dAAQAD//EAT8AAAEFAQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAABBAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHxY3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A47Gxrcgu9MtGwDcXu2iXHbWwf8Ja721tRv2bmC6qgtb6tztjW7vovAa81X/6KxrHsdtQMTMsxi4sax2/aSHjcA5h9Sqwat91b1q4mN9Y+qYrH4eDZm41J9PewEtLgWvf6n6VrnP0YgF5aDsO1lV1hfVGOQ21m4h8uO1m2tzW7t60auk4zmsYyvLysgsrdYyg1AA2MF/sbaw/omNeyre+3e+7/Bqp1JnU6Wub1DHOKx1wbDhtAsrrbV6DXbnfzVD2e1Gd171cGvFyqRdjsaxkC+ypjvT/AJqx1VR9P1m/6ROWp29JwwH2vfeaiKnVs9jLG+ow3PGQ57Xs3VR6f6NiFndOxqcT7TQ6yW2CtzbCxwIcHODmPqbX7mur+ind16629199LLZdXZWN72uY6tjqGP8AWEut3VPd6vq/T/nFG/q/rOaTi1Eeo225trnWttNbXV1V2td6f6FrXu9lf00ENbIoZTi4mQHl32quywtLYA9Ox1H6N3+Fb7PpK47o1jaizePtbLDubP6L0RjN6j6nqRv9XY7Z9H00F/Vs66u6vJc3JruEBlrQW1O+iy3Ca3Z9lfWz2M9L9F/pK056tmnpQ6WbHegLfUncZ2bdn2X/AMLtf+l2b0lNLkSoOaiJiEQVNOxqgDBVi0KseUpassdQla5S3IIKeVHSqSEppUJTygpclNXTZfZ6dcAwXOc87Wta0bnvsd+axrUxKeq51Nm9oa6WuY9jhLXNeNr2Oja73NSS2qOjGzFynvuDM7HtZTTggt3Wl+39IxznfzbN/u2/mIRxbsfMGJZDXGwVtsIcGOl3perWXNG+nd+e1Cdk5By3ZofsyXEn1GACJb6fs52/o/Yi9Q6lk9QNBv2tdjVNorcyQdrfobnPc/3N/MRtBdfqHQhiYdtrcg320t3uDWgM2tP6VrvdY+u5jP0m1zv31m4HTqs5j3vyPT2GDU1oLoP0XF9j6qm7vzP52z+Qp5P1hzr6H0hlVLbQRa6tvuO4bbNpcf0fq+71P66z8bIsxr2X1RvrMgGYI/OrftLHOqs+jYzcitps9S6fXhOYGXi71Ndhbte0fvex1tT2fm+2zf8A8EpW4HT2dJrzGZ7Lc1+31MJsAsDiW7Tu977GN979v6NAyc1+VVUyytgfUbHOvAPqWG1wf+ne5zt/o7fTp/4NVjqI48wkpudM6Zd1C4Mb7KQYsuPA49rf3rPd9BC6fh39Qyq8WiPUskyeA1o3Pd+87/i2e+z6Ct1fWDNpa1lNdNbK52MawwJ/tLPoutx7W3UnbbXqx8Alpjbvbu/PbPsd+YkpsV4TG4bs3KNldXrnFY1jAXGxrfWt3+o5mz02uZ7Fo9P+rlXUMZmTRfY1j3FoD2sBlp29nrJpy31UOxyxl1Ln+rssBMPj097XNcx3uZ9NXMb6xZ+JUKcZtVVTSXNY0OgE6u+k8pmUZTH9UYxlf6e1MWcZjD9TKMZ3vPWPCiyOlXV+q+lwfRSxtr3u9rgH7/bsbv8Af+hs/kKtfjXY5rFzdptrbawSCdj52b4+g/2/QRv2rk+ucgNrFuwMrIaf0YAe39E3d9L9LZ/O+qhZWbk5jmPyXh7q2bGugAkS5/v2Bu925/0k9lF1q//Q4QFbn1Vtrrzsx1jwwHpuY0FztoLnVw1on89yxAFKAeRPfVIMpew+qjKben9MrDabMgftNxZcGOAIprOO7Ibb/gt4/wAKrmKa/t1fqsxHdYdgVDOdQ7GDmXeq6bcWvIH7Jvt+y7P2hXvr/Rf0dcXh5eRh3OvxnBlr630udAM12D07We795iG1lYYGbRtHDY0TqWEN/qram9VzG0vqsqFztj8duykjxorl+yv+Tv8A6nsVZME4TVq6SSSSlJFJJJSKwaKs5mquOCEWhJfGVNcNT7UbaExCaQv4kW1PCkUyVLSWJCiVMobigUgrEqJTkqJSCipJJMihSZOmSUpMkmRUpJJMkpdJMkkh/9Hkh0vqH/cc/wCcz/0ol+y+of6A/wCcz/0oj9A+r9vXuot6diGqq01utL7R7Q1m2dGe789dN/40XWP+5eH/AJj0AvJeSHTOof6A/wCcz/0opjpvUP8AQH/OZ/5NdV/40PWP+5mH/mPSH+KLrH/cvD/zHp9ot5gdO6h/oD/nM/8AJp/2dn/6A/5zP/Jrpx/ik6x/3Lw/8x6f/wAaXq//AHLw/wDMegh5j9nZ/wDoD/nM/wDJpfs/P/0B/wA5n/k11H/jS9X/AO5eH/mPS/8AGm6v/wBy8P8AzHoIeX/Z+f8A6A/5zP8AyaX7Oz/9Af8AOZ/5NdT/AONN1f8A7l4f+Y9L/wAabq//AHLw/wDMekp5U9Oz/wDQH/OZ/wCTQz03qH+gP+cz/wAmutP+KXq5/wC1eH/mPUD/AIousH/tXh/5j0QkPKfs3qH+gP8AnM/9KKJ6Z1H/ALjn/OZ/6UXWf+ND1n/uZh/5j0x/xQdYP/azD/zHpGk28kemdS/7jn/OZ/6UUf2Z1L/uO7/OZ/6UXWn/ABPdZP8A2swv8yxN/wCM51r/ALmYX+ZYmkJsd3kj0zqX/cc/51f/AKUUD0vqf/cd3+dX/wClF1x/xN9aP/azC/zLP7k3/jM9a/7m4X+ZZ/chSrDyH7K6n/3Gd/nV/wDpRL9ldT/7jO/zq/8A0ouv/wDGZ61/3Nwv8yz+5N/4zPWv+5uF/mWf+RSpVvIfsnqf/cd3+dX/AOlE37J6n/3Hd/nV/wDpRdh/4zHW/wDubhf5ln/kUv8AxmOt/wDc3D/zLP8AyKNKt4/9k9T/AO45/wA6v/0om/ZPU/8AuOf86v8A9KLsf/GY63/3Nw/8yz/yKb/xl+t/9zcP/Ns/8ilSreO/ZHVP+45/zq//AEol+yOqf9xz/nV/+lF2P/jL9b/7m4f+bZ/5FL/xl+t/9zcP/Ns/8iki3jv2R1T/ALjn/OZ/6UTfsjqn/cc/51f/AKUXZf8AjLdb/wC5uH/m2f8AkUv/ABlut/8Ac3D/AM2z/wAikq3jf2R1T/uOf85n/pRL9kdU/wC45/zmf+lF2P8A4y3W/wDubh/5tn/kVyn1j+rmR9XepnpuW6q2wVttFlQO0tfMfTG7d7ElW//Sqf4sD/2WN/8ACt35aV7AvHv8V/8A4rG/+Fbvy0r2FALpbufmdd6dh3Opuc8uqaH3urre9tTXfRfkvra5tO7+Wr7XNe0OaQ5rhLXDUEHuFkW4XV8e7MHT/s76s93qbry4OqsLG0vOxjX/AGmrbUzYzdT/AJiN0G79QZhPqfRdgBuPbXZ/IaAyyuz6FtVrPex7EVrpKnT1PHstvqeRU6i00jcR7obXZv8A5P8AO7VcWFiVWuy+puqrLnOyoJlpY6Ksf25DH/u/yElO6kswY2WHXOhzrCH9wGPDj7G7g71PYz6H0E9OJcXM3tLWMse9oJAAljNnsY53+F3exJToPsYyN5jcQ1vmTwFJZjcSxzGtdU4O3V+s4vkPIM2PHu/6SuYlb6qixwgB7tgmfbuOz/opKTpJJJKUkkkkpSSSSSlJJJJKUkkkkpSSSSSlJJJJKUkkkkpSSSSSlLxT/G1/4rz/AOFafy2r2teKf42v/Fef/CtP5bUkjd//06v+LEf9lbf/AArd+Wlevr56rfbU8WU2PqsHD63FjhPg9ha5G/aHVP8Aufl/+xFv/pRALjq+/pLwD9o9U/7n5f8A7EW/+lEv2j1T/ufl/wDsRb/6UTqRT7+oMqrrLixoabHbnkCJdAbud/K2tXgf7R6p/wBz8v8A9iLf/Sif9o9U/wC5+X/7EW/+lEqVT78kvAv2j1P/ALn5f/sRb/6UT/tDqf8A3Pyv+37f/SiCH3xJeCftDqf/AHOyv+37f/SiX7Q6n/3Pyv8At+3/ANKJKfe0l4Eeo9T/AO5+V/7EW/8ApRAs6n1UcZ+X/wCxFv8A6URpIFv0IkvnY9V6t/5YZf8A7EW/+lE37V6uf+9DL/8AYi3/ANKJpNJ4C/RSS+dx1Pq//lhl/wDsRb/6USPUur/+WGX/AOxFv/pRK1cL9EJL51PVerj/AL0Mv/2It/8ASij+1usf+WGX/wCxFv8A6UStXCX6MSXzn+1usf8Alhl/+xFv/pRL9rdX/wDLDL/9iLf/AEolauEv0YkvnX9rdX/8sMv/ANiLf/SiX7X6t/5YZf8A7EW/+lErVwl+ikl87Dq3Vv8Aywy//Yi3/wBKKLurdX7dQy//AGIt/wDSiVq4X6LSXzj+1+sf+WOX/wCxFv8A6US/a/Wf/LHL/wDYi3/yaVq4S/RyS+cP2v1n/wAscv8A9iLf/JpftfrP/ljl/wDb9v8A5NK1cJfo9eKf42v/ABXn/wAK0/ltXNftjrP/AJY5f/b9v/k1WuuvvsNt9j7rXfSsscXuMcS95c5JQD//1OPAS0ThavRmMdWd1Qs9TJrqc7YXlrXNfxtrvc33fyNn+kQS5OiS3s+itmRRW7HqdGTZW1rpY17PTa5nqP8ASqf7XfpP5v8AnFLqOLiY2E240V2VioBh2NY7c9zq3fzX6X9Vtc39Yt/Rv/R1IqefhKE8aap0lLJ0kkkKTpkpSUxcq9hRbHKu4ygSviGBTtTQkmrkrYScQoByYuSRSzlFOUySVkk6SSlkk6ZJSpTJ0yKFkk6ZJSySZ+7806nRrY5Pn/JSbJ3T4kD4JKXiU+wq+3B6b+zftv2/9NOz7H6f6T1OY3b9vo/neuq7QISQ/wD/1eOBVjH6hk41T6qS0NscHuJaHGWhzNN8+3a9V4RqsVtrN5yKKTJGy1zmu0/Ohtb/AGpq7RI7qua8VS5odQ91lbmsaCHOaKzwNrva385qd3U82wsPqbDWx9Y2ADcLP5/1Z3eo63a3f/4H6aj9gZ/3NxP+3H/+kU4wmf8Ac3E/7cf/AOkU5RQR4JKz9iZ/3NxP+3H/APpFL7Ez/uZi/wDbj/8A0iktaySs/Ymf9zMX/tx//pFL7Ez/ALm4n/bj/wD0ikprKD3QrTsNn/c3E/7cf/6RQX4bD/2uw/8Atx//AKRQJSA03ulQVv7Az/udh/8Abj//AEim+wM/7nYf/bj/AP0imsjUSVv7Az/udh/9uP8A/SCX2Bn/AHOw/wDtx/8A6QSU00lc+wM/7nYf/bj/AP0gm+wM/wC52H/24/8A9IJKaiZXPsDP+52H/wBuP/8ASCX2Bn/c7D/7cf8A+kElNNJW/sDP+52H/wBuP/8ASCX2Bn/c7D/7cf8A+kEkNRMrn2Bn/c7D/wC3H/8ApBN9gZ/3Pw/+3H/+kElNRMrn7PZ/3Pw/+3H/APpBN+z2f9z8P/tx/wD6QRU1ITK5+z2f9z8P/tx//pBL9ns/7n4f/bj/AP0gkpoljXGXCTxKeI4Vz9ns/wC5+H/24/8A9IJv2ez/ALn4X/bj/wD0gkpqcGU4eQrX7PZ/3Pwv+3H/APpBL9ns/wC5+F/24/8A9IJKf//W5FLz7Ie9GpyGtZtLgCXO5EgSzaHf5ybaaLAwmRjdj7RsDZDTtnU7tv5wj99M+ypwO3aCCNukaFvv/wCmnBVIx+HinTtf+hewnktLW/AncogpKXUSYTkwhPcgSoBZ7kIpyZTJpK8BZJOmQSsknhPCSlkydMihSZOmSUpMnSSUsknTJKWSTpklLJk6ZJSkk6ZJSyZOmKKn/9fhpKbckUWm3DYzbdiG98k+p6769OzfTYxzfamMyMORA5EGR03/AMrz/wCxVn/pNTGR07/yvP8A7FWf+k0+OyCEQcpbkT7R07/yvP8A7FWf+k0jk9O/8rz/AOxNn/pNAlaQgc9CJlWjkdOP/eef/Yqz/wBJpfaOm/8Alef/AGKs/wDSaaUgNRJW/tHTf/K8/wDsVZ/6TTfaOm/+V5/9irP/AEmglqpAK19o6b/5Xn/2Ks/9Jqbbunf+V5/9irP/AEmkglqtakWq76/TgP6Af/Ymz/0moOyenf8Alef/AGJs/wDSaKGkUytnI6b/AOV5/wDYqz/0mm+0dN/8rz/7FWf+k0ktRJWvtHTf/K4/+xVn/pNL7R03/wArj/7FWf8ApNJTUSVv7R03/wArj/7FWf8ApNL7T03/AMrj/wCxVn/pNJTUTK39p6b/AOVx/wDYqz/0mm+09N/8rj/7FWf+k0lNRJW/tHTP/K4/+xVn/pNN9o6Z/wCVx/8AYqz/ANJpKaiSt/aOmf8Alcf/AGKs/wDSab7T0z/yuP8A7FWf+k0VNRJWvtPS/wDyuP8A7FWf+k0vtPS//K4/+xVn/pNKlNQqJV37T0v/AMrj/wCxVn/pNN9p6X/5XH/2Ks/9Jo0h/9Dhy1OzHtsG5g3CSI76Def+ipQiV2BrNhBIkkwY0c300ymW0DarDENcd30dDr8FP0rByxwmeQRxyjuyC5pEES0tMQBO309w03KFl+8ODgfcQef3W+mng0EXbAVOLC8EQAXbZ90N+k7b/JQyiB9YqcyHB7vpOBEED6Lf6qGmEpWSTpkFKSSTgJKXaFMCEgISJRWlZxQiVJxUEkgKSSTIJUnTJJIUmKUpIqWTJ0ySlJJJikpRUU6ZFSySSZJS6SZJFT//0eJlL1GAwXAHwJTNEq1RnZuNX6VFuxkl23ZW7U8+6yt7kxkLWN1f74+8KBtrP54+8K8esdU/7kf+B1f+kk37Y6p/3I/8Dq/9IpEqAaPqV/vD7wl6lf7w+8K9+2Oqf9yP/A6v/SSb9sdU/wC5H/gdX/pFBLR9Sv8AeH3hL1K/3h94V79sdU/7kf8AgdX/AKRUh1fqn/cj/wADq/8ASSSGkH1/vD7wpCysfnN+8K7+2Opj/tR/4HV/6STftjqn/cj/AMDq/wDSSKGmba/3h94UHXV/vt+8K8esdU/7kf8AgdX/AKSUD1nqn/cj/wADq/8ASKSgGiba/wB9v3hR9Wv98feFf/bPVf8AuR/4HT/6RS/bPVf+5H/gdP8A6RQXND1a/wB9v3hL1a/32/eFe/bPVf8AuR/4HT/6RS/bPVf+5H/gdP8A6RSU0PVr/fH3hL1a/wB9v3hXv211X/uR/wCB0/8ApFN+2eq/9yP/AAKn/wBIooaPq1/vt+8JvVr/AH2/eFf/AG11X/uR/wCB0/8ApFN+2uq/9yP/AAOn/wBIpJaPq1/vt+8JerX++37wr37a6t/3I/8AAqf/AEil+2uq/wDcj/wKn/0ikpo+rV++37wmNtf77fvCvHrfVf8AuR/4FT/6RTftvq3/AHI/8Cp/9IooaHqV/vt+8JvUr/eH3haH7c6r/wByP/Aqf/SKX7b6r/3I/wDA6f8A0ikpzvUr/eH3hL1K/wB4feFoftrqv/cj/wACp/8ASKX7b6t/3I/8Cp/9Iooc/wBSv94feExsr/eH3haB631b/uR/4FT/AOkk37c6t/3IH/bVX/pJJT//0uKboisrbYzcX7NXDUae1vqIJKdtr2CAdASYInUjYf8AopjJTM4toaHOhoiTJ4Eb9dP3Uz8d1YlzmmDBgnQkb29vz2pjdYRBI+jtJgSQRt9zv6qY3WGZIO4gmR3A2D/ooaK1XZWx1T3ydzBJ4j+S39/3IakLXhmwREETAmD9Ju791yYBJKgFPhIaKJKK3dRMpJgk4pKYkqKcpkFykySSSlJikmlFSkyeU0pKWSSShJSkycpklKhIhSCi4ooYJJJIqUClKUqKSl0ySSSn/9PiIKsUdOz8mv1ceh1tclu4FsSOR7nNUNgUXU1uMuaCfEhMpfxNn9jdX/7iP+9n/k037G6v/wBxH/ez/wAmq32er9xv3BL7PV+437glSrbY6L1b/uI/72f+TTjo3Vh/2kf97P8AyaqehV+437gommv9xv3BKlW3D0fq/wD3Ef8Aez/yab9jdX/7iP8AvZ/5NUvQr/cb9wS9Gv8Acb9wSU3v2N1b/uI/72f+TUT0bq//AHEf97P/ACapGuv9xv3BQ9Kr9xv3BJIb37F6v/3Ef97P/Jpv2L1j/uI/72f+TVE1VfuN+4JjVV+437gglvfsXrH/AHDs+9n/AJNL9i9Y/wC4dn3s/wDJqh6VX7jfuCiaqv3G/cEVOh+xesf9w7PvZ/5NN+xOsf8AcOz72f8Ak1Q9Kr9xv3BP6NX7jfuCSm6eidY/7h2fez/yaX7E6x/3Ds+9n/k1QNdX7jfuCb06/wBxv3BJTofsTrH/AHDs+9n/AJNL9i9Y/wC4dn3s/wDJrP8ASr/cb9wSFVZ/Mb9wRU6A6H1g/wDaOz72f+TUv2F1j/uG/wC9n/k1Trx6u7G/cFN9VIH0G/cEkW2D0XrH/cOz72f+TQz0TrP/AHDf97P/ACapPrq/cb9wUDXX+6PuCKm/+w+s/wDcN/3s/wDJpfsPrP8A3Df97P8Ayaz/AE6/3R9wTGuv90fcElauh+w+s/8AcN/3s/8AJpfsLrP/AHDf97P/ACaz9jP3R9wS9Ov90fcElat/9hdZ/wC4b/vZ/wCTS/YXWf8AuG/72f8Ak1Q9Ov8AdH3BL06/3R9wSVq//9Tj5RqWscyXN3Hc4COdGbgFW3Jbj4plrqbZpra2SSYaXGOD7d/tMJn1VtBLdx2kA8d27/8AoqtuPjoluRtVNitjDS9xLS+JAnVsEdv5aCQFHclvStVFcgKJaluS3IWmixLUNyI5yE4pJCxTJFMglRTQnGqIxkoq2YBqZyOWgBBcNUkAo4SUiIUSilblErZKZjJKsNAaEkEq0aEC16la9V3GUUALEpJkkly5TJJklKhKEk6KGKcBPtTwkp//1eJlHpqxXs3W5YofJHpmqx+n72+r2e5V5TE9+3iomWm59nwP/LFv/sPd/cm9DA/8sW/+w939ypkppSTTd9DA/wDLFv8A7D3f3JvQwP8Ayxb/AOw939ypw4gkAkDkgGB8SmlJVN30MD/yxb/7D3f3Jxj4H/li3/2Hu/uVGU4KSqbhx8D/AMsW/wDsPd/coHG6f/5Yt/8AYe7+5VyoFFDZON0//wAsW/8AsPd/cl9l6f8A+WLf/Ye7+5VQCVIMRU2mYfT/APyxb/7D3f3Iwxungf8AKDf/AGHu/uVMQ0KJeit3bpx8A/8Aei3/ANh7v7k32Xp//lg3/wBh7v7lR3qbTKSqbTsTp/8A5Yt/9h7v7kL7H0+f+UW/+w939yGSk1qSrbLMPp4H/KDf/Ye7+5M+np//AJYtH/oPd/cq7nQEB5lJQ1bDsbp5/wC9Jv8A7D3f3KH2Tp3/AJZN/wDYe7+5V4USiltfZOnf+WTP/Ye7+5N9k6d/5Zs/9h7v7lUShJTb+ydO/wDLNn/sPd/cl9k6b/5Zt/8AYe7+5U0klNz7J03/AMsmf+w939yf7J07/wAs2/8AsPd/cqScBJTdGL07/wAsmf8AsPd/ckcXp3/lkz/2Hu/uVNMkp//W4WUfHuayvaXAEud9ISBNexrv89VpSUbPTbdZihg2NbIYds6ndt4e3b/pP5ShbZS4O2CtpBG32xoWfpP/AAVVkklU2K7G/Z3VvcI9xDfcH7jGyI9j2fvKukkkml04UVIJILJINlOBKnwEQsJYhoCYuAUXPUCZRVS7nqMpoTgIJXaJRQICiwKaK0lUJSkSk0SkhZwJCCRCtRog2AIpBQlQKk5RSSoNSIhSGiY6pKYJQpQmhJSwCdPCZJCySSSSX//X4KUam7CYyL8R175PvF7q9OzfTbW9el/+NH0T/ufmf+Bf+kkv/Gj6J/3PzP8AwL/0km8JZuOL5x9o6Z/5Xu/9in/+kk32jpn/AJXu/wDYp/8A6SXpH/jRdE/7n5n/AIF/6SS/8aLon/c/M/8AAv8A0klRRxxfN/tHTP8Ayvd/7FP/APSSX2jpn/le7/2Kf/6SXpH/AI0XRP8Audmf+Bf+kkv/ABouif8Ac/M/8C/9JJUVccXzgZHTP/K93/sU/wD9JIjbum/9wHf+xT//AEkvRB/ik6IP+12X/wCBf+klL/xp+i/9zsv/AMC/9JpUUGQfPBf00D+gO/8AYl//AKSUH5XTf+4Dv/Yl/wD6SXop/wAU3Rf+5+X/AOBf+k0x/wAUfRD/ANr8z/wL/wBJJUVth83OT0z/AMr3f+xT/wD0km+0dM/8r3f+xT//AEivSP8Axouif9z8z/wL/wBJJf8AjRdE/wC5+Z/4F/6SSop4g+b/AGjpn/le7/2Kf/6SUhf0w/8Aee7/ANin/wDpJejf+NF0T/ufmf8AgX/pJSH+KXog/wC12X/4F/6SRpXEHztt3Tf+4Dv/AGJf/wCkk7snpo/7QO/9iX/+kl6L/wCNR0X/ALm5f/gf/pNRP+Kbop/7XZf/AIF/6TSpFh86F/TSf6A7/wBiX/8ApJEF3TQP6A7/ANiX/wDpJehD/FP0Uf8Aa7L/APA//Sac/wCKjo3/AHOy/wDwL/0mlSrD547J6b/3Ad/7Ev8A/SSC/I6af+893/sU/wD9JL0j/wAafov/AHOy/wDwL/0mm/8AGl6J/wBzsv8A8C/9JpKsPmZv6Z/5Xu/9in/+kkhf0sf957v/AGKf/wCkV6Wf8UfQz/2uy/8AwL/0kmP+KHoZ/wC1+Z/4F/6SSpPEHzM5PS//ACvd/wCxT/8A0km+09K/8r3f+xT/AP0kvS//ABn+h/8Ac/M/8C/9JJf+M90P/ufmf+Bf+kklWHzUZPS//K93/sU//wBJKQyOl/8Ale7/ANin/wDpFekf+M/0P/ufmf8AgX/pJP8A+NB0P/ufmf8AgX/pJJFh82N/S/8Ayvd/7FP/APSKj6/S/wDyvd/7FP8A/SS9L/8AGg6H/wBz8z/wL/0kl/40HQ/+5+Z/4F/6SSVYfM/tHS//ACvd/wCxT/8A0kl9o6X/AOV7v/Yp/wD6SXpn/jQdD/7n5n/gX/pJN/4z/Qv+5+Z/4F/6SRVYf//Q9OVPq/Uq+ldMyOo2VutZjN3OrZAcdQ387+sriBnYjM3CyMN/0cit9Zn+UNo/6SSnmsz6zdcFLLbG4HQ2ZDd1H2611l7m/v8A2alnt/tra+rnVT1bo2PmvLXXHdXeWfR9Ssmt7mfyHx6jFyvS/rNmg0DNycrNyqRsuwKcAF5e2Wek/Nf7du9v857F0H1Yx+psPUMvOxm4FWdeLsfCaQXV+0V2Os2exr7drHP/AOETiNFoLuJJJJq5S5vrf10r6Zkvx8bCszfRsbTfcDtqba4eo3Fa/a/1Mn0/zF0i4PrP1Zz6OsZWSzBt6tgZrjdVVTcajVe78+1u5u7Z7vf/AKNGNdUG+j1/Seq09UxnXMrfRbU81ZONbAsqsADnV2R/JduarqwPqd0PM6R0+057pzMuwWWtDt20NHpsa5/59n7630jvokKSSSQU4HU/rhi9P6hdgHFtufQa2ve11TG7rRura31rK3f1n/QUujfW3E6tmjCZjW0WPrdaxz3VuaQwhjwfRe91btfz1mdY+r3Vsjr2Zm14pycTI9F9Xp310uD6mgTZ69V30XD6Cn9Xfq/1PC64zMuxvs2HVj2VNa+5lz973Nf7XU11e3+unUKW2betSSSTVylF79o0hzyD6dcgF5A3bGblJVMjp1Fmfj9U2udl4TLGUtDoa4WD3Vua72btzfbYkpj0rqbepYdeV6Tsb1i706rHNLyGHY549NzvzldWH0fojjh9Nf1Ol1GX0t9z6a22BzSbS79I99X0m7H/AM2txEqCkkkkFNXqfUK+nYZynsNnubWxgIbL7D6de+2yK6mbj77bFQZ9Z8R9uNW2l/6csbad9c1Pte6iqr0w/fkP9St7rPQ/m6P1j+bV3q7M2zAezCaH2uczez2Eur3D12VfaA7H9Z1f836/6NYXTuhdV6flY11NYaX7XXndSWVN9S199L2+k25z/s1uym/Ff/Pfzn6uiKpBt6lQt/mn/wBU/kU/goW/zT/6p/IglmEO3Ix6I9e1lW76O8gTHMSiBV87BozqDTcPNjx9Jjv3mpKSVZGPfPoWst2xu2EGJ4mERV8HBowMcU0jze8/Se795ysJKf/R9OSSUH211uY17g11rtlYP5zo3bR9ySkm4+KZJJJSklCy+mpzGWPDHWmKwe5U0lKSSUH3U1vZW94a+zRjT3SUzSSSSUpJRdbWx7GOcGvtJFbSdXEDe7aP5LVJJSkklA3VC4UFw9VzS8M1naNNySmaSSSSlJKPqV+p6W4epG4t7geJUklKSSQ/Xp9b7PvHrRuDNZgd/wB3ukpIkkkkpSSgL6XWupa8G1glzO4H+pU0lKTEBwLTwdCnUG3UvsfUx4dZX9No5CSmaSSSSlJIbL6bLH1VvDrKjFjRyCiJKf/S9OVHPzcCmyuq+xwsqIyNlbHWENbub6lram2enT/KcryyrHZ3T8/MyacN+a3M9J1fpFoIdW30XUXeo5uxmnq12fzaIU6ddld1bbanCyuwBzHtMhzTq1zXKSo9Doso6XTXaw1WTY59REbC+x9vpf1a9+xrvz1eQU0L8zBtOFb9qDK7rzXSzbIttbuHpu3Dcz0XVWf9c/sK3VfTcbBU4P8ARearI7PaAXM/s7ljXdKy7MnOAYRTUHXYL5EuuuczJsazX2enbj+n/wBfWl0um2rBr9duzItLr8hnhZa43WM0/wBHv9NEobazc3OwPtjKrLrPUxHNfZVXU+wBxG+rdZXW/b7Hf5i0lg5NGSzq2bca+oela6p1Rw3MDHBtbGP3h7g7fvZsSCS7ySUyJiJ7JIKcvJzukfbW3232Mswnmp7g1/otcRDq7rNjqW/zjd7961Fz+T0jPfVn2tNrhZlPsPT94bXk0EM31bh763Xt3/4T6f8AO/onrfaZaDBbIHtOhH8k/wBVEoC6y787preqM9S2xuRWC30m02HdHsn1G1++lnq+7/BLUVSyq49YxsgNJprx7mPf2DnOpcxv9rYgEttJJJJTner031j1QZBDQ/7O9gBk3A/Zm0uZHq79z/5n/ry0Vm/s7/L32z0z6Ho+oTPs+0g+g270/wDuR9j/AEfqf6NaSJUpVG5WE5reoC7dVdtx63Qdu42GuGiN26y72K4DBBWBTj54xcfpLsWwOoym2vyiW+iamXOyvUY/dvc+xm1no+n/ADiQU7ySRMmUkFNSqnHb1S57bSch1bXPqjhjjsY7d+c3dT7Gq2qjKbR1i/ILT6L8aqtr+xc19rnt/ste1W0lKWXjZnST1F1lV5L8gmmr2ubS54O+5tN5b6N1z31/mPWjdX6tNlQcWGxjmbxyNwLd39lYwpz7unYvR3Yb6X45obbkkt9FrMdzH+tjvDt9j7fS/RV+n7PU/SohTuJEgAk6ACSfIJEySVGwE1vAEktcAPEkIKc7Azel25e7Hvc9+S1zqGvY+sOaXfaLfQfYxnre93qf8WtNZXSukvqx8CzMuustxKm7MewsDKrNnpO9tTW731sc+tm971qolQf/0/TkkkklKSSSgjlJSkkkklKSTMeyxjXscHMcJa4cEHuE6SlJKL7GVsL7HBrG8uPCaq2q5m+pweziR4hJTNJJM5zWNLnuDWjUuJgBJS6SZj2WND2ODmO1a4agp0lKSUbLaqoNjgwOO1pOklOCHAOaZBEg+IKSl0klGy2qphsteK2DlzjAEpKZJJmua9oc07muALSOCDqCnSUpJQuvooZvvsbUyY3PMCT2UgQQCDIIkHyKSl0klC2+mloddY2tpIALiBJPxSUzSS51HCSSlJKFt9NIabnisOMNLu5U0lKSSSSU/wD/1PTkkkklLP2bHb42Qd06CI90oHT7MK3DquwHB2LaN1Thuggn/hPehdYpysnBOJjSHZTm1WWiIrqdrfa5pLd36Nvp7f8AhEPpmNmYeRl0XRZRa4ZFNzG7Ghz/AGX4/p737Nr6/W/66j0U6KFk5NGLUbsh+xgIbMEkucdrGMY3c973fuMRVS6vS67EDW47skNsa9zK3+na0N/w+I/2/rNLvexm9m9BSTAycS+jbiv3Cj9E9paWOY4CdllTw19btpVlZ3RmZjRecgW+i5zfszskNGQWhsWfaPS+k31P5j1P0q0Uipo9YtoZj1tut9Jz7B6PsdZuc0GzZ6dLXv8AoBN0Y0uxHPqtbcDY4Oc1pYWlv+Dsrc1jq3sn/RsS6n6zL8DJqpsyG49z3WtpALw11VlQdtc5n570um05Byc3NvqOP9rfWa6XkF4bWz0vUu2FzG2W/ufuI9EdW+qfVbMNmGa8yx1VV7m1NLGlzi8+9rGNY17t3s/dVxZ/WcS7Lbh10l7dmUx9llRDXsYGWtdY1zv621AJbGBZjvxWDGLzVWPTBsa5jvb/ACbG1u/6KsIePSaKW1Gyy7bP6S07nmTPucA1ESU1OpW4VdAbmP2tscGVhrS97nc7Ka2B73P2futT9Ovx7saKLjeKnFjy8Fr2uGvp2Vv2vrc2fouQeoV5FebidQqpdksx221WVMj1Gi3YRfS15a17mel6djN3829LpA6gTk2ZYeK7HtOP6za2XFobtsdc3H9v0/5rf+k2I9FdXQQbjiW2Nw7w2x9jTY2lwkFrC1rn/u+xz2oyzs3AtyuqY1gfdTTXRa111L9h3OfS5lbuXO3Na5AKbuPbRYwjHILKnOpIAgNdWdj6/wDraIqHRsW3Exrqbd0/ab3sdYdznMc8urtc7+W1X0lI768d9Z+0Ma+tnvIcJA2g+7/NT1WV3VMtqO6qxofW4cFrhuYf81VuqX5VVG2jFflNta+t/pkb2ktip2x5buY5/te7d+jRcCl9GBjUWR6lNNdb4Mjc1rWOg/1gkpOqXUKulZn6nn7Hek37UWPO0NYw7fXc/wCi1rHK6sXq3SMjqPUNzXmqpmLDHGDU65toupryq/pW0t27n1fnohRdbHvqyKK76TNVjQ6swWy38121wa5EQsW6+/HrtyKTj3uH6WlxBLXD2uAc36bP9G/9xFQUguOPbazEsd+kcPWFcTuYxzd27+RvcxHWdmuvx+qUZbca7JqGPbU70A1xDnPqe3c176/pNY5aDHb2NftLdwB2u0cJ/Nd/KSUukkkkp//V9OSSSSUpJJJJSkkkklKSTMex7dzCHNMwRxoYTpKUkkmY9r2h7CHNcJBHBSUukkkkpSSSSSlJJJJKUkkkSAJJgDUk8JKUkkkkpSSRIAkmAOSdEklKSSTPe1jS952taJJPYJKXSSSSUpJJJJSkkkklP//W9OQ3XgW+ixpssDS9wbHtH5m6fzrf8GiKpbRuyDZ6TvTaJs2GDa46N9rXM/mm/nvSUlGUw1MtYC5jwZIgbYHFk/R936N/+jTU5jbrBWGFpIJB3NcNI09v9ZA+y3Npo2MAv9/q2Tq3c1zPUc/6Vjm+xTx6L67xv1a0OO4Elo3BjdrPUc6z8ze9JTbULrhRWbnNe8MgltbS9x1/NrZ7nKaq9Ssz68N56fV6uUYbWNPbuMOuh7mNf6Lff6f+ESUw6Vl411b8Wk2b8OGWiyt1ZG4epW2H/nemVdVLpNQox/s4xrscMO51l5Y59r3ndbe91T7N1r3e6zcrqRUiycujEY27IdsrL2s3wdoLzsZ6jh/N17/b6iHgvoDX41T/AFXYrtlzwIb6jv0z2Nd9Hczf7/8ARpupsybcR2PjVtsfkfonusgsZW7S26xh/nNjPoVfn2IPRsS/AxndPsbNGMYxciQTbW73Td+d9qrd7b3/AOG/nkeinQQcvKx8WrfkOIa8itjWgue97vo1VMZ732O/koyo9RoyDdh5uOw3Pw7HOdQCGucyxjqHuqL/AGerVu3ta76aCkuDl4uRUW4+5poIrsqsDm2MMBzW2st9/uY7c1356sqth25dxtsyKBjMLgKGEg2loHufkbC6tvu/m62u+grKSkN2Syu2rH3AX5G70Q4HaSwb7G7mfnbPcnoyGWutrBDrMdwru2g7Q8tFmxrnfS9j27kHqmPddjB+O3flYz25GOydu57Oat/5vr1Osp/64n6bjOxsRrLNb7C628+NlhNlnH7u700eim0qudm4+MGVW+o5+TubUyqs2uO1u5/6Nod9Fv76tLL6zi5F2Rg21V3WsodabfszxXYN7NjIc59Xt3fS9yAU38XJoyqG3UO3VmW6gtIc07Hsex211djHD3sRVQ6LjZONhGrIBaTbY+tjnB9gY525n2i5v87kfnWWK+kprZOVjC+vp77RXk5jHmgETu2R6kbh6e5u76D0WnIqyA91R3Ct7qn6RD2HZY3X+UqPUemOzsxhdLKm0PDL2xurvFlVuPbWP32bP/Ran0WnNpw3jPY2vJsvuse1h3NO95LXsP7tn85/IR6Kb6rW5OI/Mb0x7yMmyv7QK4PurY4A+/6P0/zFZWR1PDzznnPwqhZdRTWMeXBoc7fc3IqO76P6G7ekFOji5uNmescd/qCi11FpggCxn02ifpfS+kjKh0jBfgsyKSIYbQ6p0/SHp1MfZ/J33NtV9BSO++rHpffcdtdYlx/gP5TlkN+s27YG4NpNpIrhw9xH0tnt921XOtYD87CLKifUrPqMZ2cR+Y7/AL4sLEvvx8c45xshzbS71XAODmSNjfsvt/Rv/wBN/pEQgvQ9M6gzqFDrm1mrY/YWuIPaZkK2sn6tVWV4FgsY5hNpIDgWkiAOCtZApf/X9OSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpPud4lMkkpRJPKSSSSn//0PTlC2wVVusILto0a0SSTo1rY/ecpoeSx9mPYxjnMc5pAcz6Q0/M/lJKaw6jZtYfsz5M+oA5pDYPp7mv+i79N7P/AARXRMCRtPdvh5aLLuwj9mYzY9zrG1BtbdwDC3Z6vqbXem1mi1A1rQGt+iNB30+JSUpDffUy2ulx/SWmGtGp4J3O/db7URDtrLnVFoHtsDnnvADx/wB+SUw+248EkuDQCWuLTDoO13pfvolVrbQS0FpaYc1whwPPuagN+1l7rn0/pgCK2ue3Y1s/Qbs93qWM/wAKiYtb6w+W+mxzpYwu3Eae7c/3fSckpMkkoOY51tbw8tazduYOHSNrd39T6SSmaSSSSlJJJiQASeAJPwCSmr1TKfjYdj6TGQWn0REyRq+G/wAlnuS6XlPycKt9xnIDR6wiIJ1ZLf5TPciRR1DDDme6m5u6t8QR+5Y2fc17Uoo6fhlz5bVS3dY+JJ/fsd+c57klJ0kgQQCOCAR8CkkpSSSSSlJIdVTq3PJeX7zIB7f6/wAlESUjuvpoANrg2Z2jWTA3aQo0ZePeAa3idocWnQgO/rJ76BbtO5zHM3bSwx9IbdUKvCLWMJe42NrDCHGQCB+Zp+a9JTZa9jvouDvgQefgnVfExXY+6XNcHfuiNVYSU17s1tN4qcxx3BsPH0Zc7YBuUGdSqcwuLS1wcGlpI5cPU9v9kKOXi2WXusYwuPphjHbho7du+hZ7WM/0iHVh5DMSzG2BrnnRwc0ta2OGu2+o/wDtsRUmxuo15DmN27HPJDZcDMTtj+vtVtUsPGyKHNJ0rdIdXIJbBPpPdzvft/cerqCn/9H05JJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpIgEEHgiD8CkkkpoDoXSgIFLgBwBY//wAkkehdKIg0uIPINj//ACSvpI6q0UAAABwBA+ASSSQUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSU//2Q==" alt="启用透明状态栏之后" style="max-width:100%;"></a></p>
<p>在不使用透明状态栏的情况下（也就是没有启用全屏显示属性）， Ionic2 会自动处理软键盘的弹出收起。软键盘弹出时，页脚元素（ <code>&lt;ion-footer&gt;</code> ）会跟随显示，不会被软键盘遮住，而输入框也会自动调整位置以保证可见。</p>
<p>为了解决此问题，需要订阅软键盘的弹出/收起事件。</p>
<ol>
<li>
<p>为项目安装 <code>ionic-plugin-keyboard</code> 插件。</p>
</li>
<li>
<p>导入插件：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">Keyboard</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@ionic-native/keyboard<span class="pl-pds">'</span></span>;</pre></div>
<p>并在构造器中声明类属性：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">constructor</span>(
  <span class="pl-c"><span class="pl-c">/*</span> 其他声明…… <span class="pl-c">*/</span></span>
  <span class="pl-smi">private</span> <span class="pl-smi">keyboard</span>: <span class="pl-smi">Keyboard</span>,
) {

}</pre></div>
</li>
<li>
<p>添加对于软键盘事件的处理。</p>
<p>**由于 <code>ionic-plugin-keyboard</code> 是作为服务导入的，在有效的作用范围（同一个模块）内是单例模式，在该模块内包含的任意页面上做事件绑定都可以。为了避免重复绑定，将相关的代码写到一个服务内（ <code>/src/providers/keyboard-service.ts</code> ）。**并且将事件处理方法的绑定或初始化调用放在 <code>constructor()</code> 内，保证只绑定一次。</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c1">this</span>.<span class="pl-smi">keyboard</span>.<span class="pl-en">onKeyboardShow</span>()
  .<span class="pl-en">subscribe</span>(() <span class="pl-k">=&gt;</span> {
  <span class="pl-k">const</span> keyboardHeight <span class="pl-k">=</span> <span class="pl-smi">e</span>.<span class="pl-smi">keyboardHeight</span> <span class="pl-k">||</span>
      (<span class="pl-smi">e</span>.<span class="pl-smi">detail</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">e</span>.<span class="pl-smi">detail</span>.<span class="pl-smi">keyboardHeight</span>);
    <span class="pl-c1">this</span>.<span class="pl-en">toggleContentHeight</span>(<span class="pl-c1">true</span>, <span class="pl-smi">keyboardHeight</span>);
  });

<span class="pl-c1">this</span>.<span class="pl-smi">keyboard</span>.<span class="pl-en">onKeyboardHide</span>()
  .<span class="pl-en">subscribe</span>(() <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">this</span>.<span class="pl-en">toggleContentHeight</span>(<span class="pl-c1">false</span>, <span class="pl-c1">0</span>);
  });</pre></div>
<p>此处不仅使用布尔类型参数传入了软键盘的弹出/收起状态，还在弹出时传入了软键盘的高度。</p>
</li>
<li>
<p>在修改页面的高度之前，需要首先知道页面原先的完整高度。</p>
<p>Ionic 的 Platform 对象提供了一个 <code>height()</code> 方法，可用于获取页面高度。但实际上这样获取的结果有可能不准确，例如在 Android 机上使用透明状态栏的时候，页面实际可用的高度要大于 <code>Platform.height()</code> （差值为状态栏的高度）。</p>
<p>因此可以使用页面根元素的计算高度，以下代码同时获取了两种高度，将其中较大值作为页面高度来使用。</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">const</span> platformHeight <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-c1">platform</span>.<span class="pl-en">height</span>();

<span class="pl-k">const</span> appElem <span class="pl-k">=</span> <span class="pl-c1">document</span>.<span class="pl-c1">querySelector</span>(<span class="pl-s"><span class="pl-pds">'</span>ion-app<span class="pl-pds">'</span></span>);
<span class="pl-k">const</span> computedHeight <span class="pl-k">=</span> <span class="pl-c1">parseFloat</span>(<span class="pl-c1">window</span>.<span class="pl-en">getComputedStyle</span>(<span class="pl-smi">appElem</span>).<span class="pl-c1">height</span>);
<span class="pl-c1">this</span>.<span class="pl-smi">_fullHeight</span> <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(<span class="pl-smi">platformHeight</span>, <span class="pl-smi">computedHeight</span>);</pre></div>
</li>
<li>
<p>在软键盘事件的具体处理方法（前面代码中的 <code>toggleContentHeight()</code> 方法）中，对 APP 根元素的高度进行调整。</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">toggleContentHeight</span>(<span class="pl-smi">keyboardShow</span>: <span class="pl-smi">boolean</span>, <span class="pl-smi">keyboardHeight</span>: <span class="pl-smi">number</span>){
  <span class="pl-k">const</span> renderer2 <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">renderer2</span>;
  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">renderer2</span>){
    <span class="pl-k">return</span>;
  }

  <span class="pl-k">const</span> rootComponent <span class="pl-k">=</span> <span class="pl-c1">document</span>.<span class="pl-c1">querySelector</span>(<span class="pl-s"><span class="pl-pds">'</span>ion-app &gt; ng<span class="pl-pds">'</span></span>) <span class="pl-k">as</span> <span class="pl-en">HTMLElement</span>;
  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">rootComponent</span>){
    <span class="pl-k">return</span>;
  }

  <span class="pl-k">const</span> rootHeight <span class="pl-k">=</span> <span class="pl-smi">keyboardHeight</span> <span class="pl-k">?</span> <span class="pl-c1">this</span>.<span class="pl-smi">fullHeight</span> <span class="pl-k">-</span> <span class="pl-smi">keyboardHeight</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>px<span class="pl-pds">'</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>100%<span class="pl-pds">'</span></span>;
  <span class="pl-smi">renderer2</span>.<span class="pl-en">setStyle</span>(<span class="pl-smi">rootComponent</span>, <span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>, <span class="pl-smi">rootHeight</span>);
}</pre></div>
<p>其中 renderer2 是 Angular 的 Renderer2 对象的实例。使用 renderer2 未见得必要，也可以使用 html 原生的方法。若要使用 Renderer2 ，需要注意在一个非组件的模块（未使用 <code>@Component</code> 装饰器）中依赖注入 Renderer2 是会报错的。当前代码文件（ <code>keyboard-service.ts</code> ）使用的是 <code>@Injectable</code> 装饰器，因此无法注入 Renderer2 ，需要让其他组件传入 Renderer2 的实例并进行赋值。</p>
</li>
</ol>
<h3>
<a id="27" class="anchor" href="#27" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>iphone 页面跳跃问题</h3>
<p>以上使用了修改页面高度的方式来调整界面，从而影响 <code>&lt;ion-content&gt;</code> 与 <code>&lt;div class="scroll-content"&gt;</code> 的高度。这样在 iphone 上会引发问题，会明显看到页面的一次纵向跳跃，然后页面高度才被调整。</p>
<p>此问题的产生原因是 iphone 会自动调整输入框的位置以保证其可见。</p>
<p>可以将此特性关闭，调用 <code>keyboard.disableScroll(true)</code> 即可（ <code>keyboard</code> 为 <code>ionic-plugin-keyboard</code> 的实例），此设置对于 iphone 与 windows phone 有效。</p>
<p><strong>需要特别注意， <code>disableScroll()</code> 必须在 <code>platform.ready().then()</code> 中调用才能生效，也就是在平台准备好之前是无效的。</strong></p>
<h3>
<a id="28" class="anchor" href="#28" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>页面背景问题</h3>
<p>软键盘弹出/收起时，有一个动画过程，而页面高度调整也有动画。这两个动画经常不太同步，会短暂漏出后面的背景。如果是单一纯色背景，就没什么问题，但目前方舟采用两种背景，一种是登录相关页面的偏黑色的背景，一个是主界面暗棕色的背景。这样在软键盘弹出/收起时，有可能会看到与当前页面不同色调的背景，视觉效果比较差。</p>
<p>为了解决此问题，在登录状态改变时，将 <code>&lt;ion-app&gt;</code> 元素的背景修改为与目标界面的背景相同。这种方式不规范，也可能造成一定程度的性能损耗（多个嵌套元素都各自设置了背景图，以保证各种显示效果都正确），但目前没有找到更好的处理方法。</p>
<h3>
<a id="29" class="anchor" href="#29" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>软键盘弹出时  Tabbar 的处理</h3>
<p>在 Tabs 一级页面（也就是能够看到 Tabbar 的页面）存在输入框时，会出现一个问题：当软键盘弹出时， Tabbar 也会跟随软键盘向上移动，从而占据多余的显示空间。无论是使用透明状态栏还是原有的非全屏模式，都存在此问题。</p>
<p>解决此问题需要对 <code>&lt;ion-footer&gt;</code> 元素进行判断与处理，若 <code>&lt;ion-footer&gt;</code> 元素的 <code>bottom</code> 样式值不为 0 ，表示在页脚元素下面还存在其他需要显示的元素，最大可能性就是 Tabbar 。因此可以在软键盘弹出时，先记录 <code>&lt;ion-footer&gt;</code> 元素的 <code>bottom</code> 样式值，将其设为 0 ，当软键盘收起时再将原值设置回去。此外还需要相应修改 <code>.scroll-content</code> 元素的 <code>margin-bottom</code> 样式。</p>
<p>在高交所 APP 后期代码中，已经不存在位于一级页面的输入框，因此相关的处理代码已删除，此处只提供一个思路，也可以参考旧版本的代码。</p>
<h2>
<a id="30" class="anchor" href="#30" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>锁定 APP 的方向</h2>
<p>高交所 APP 要求使用竖屏方式（ PORTRAIT ），因此需要锁定 APP 的方向，使用相应的插件：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">AndroidFullScreen</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@ionic-native/android-full-screen<span class="pl-pds">'</span></span>;</pre></div>
<p>Android 手机相对容易实现锁屏，在 <code>/src/app/app.component.ts</code> 中添加代码：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c1">this</span>.<span class="pl-smi">screenOrientation</span>
  .<span class="pl-en">lock</span>(<span class="pl-c1">this</span>.<span class="pl-smi">screenOrientation</span>.<span class="pl-c1">ORIENTATIONS</span>.<span class="pl-c1">PORTRAIT</span>)
  .<span class="pl-en">catch</span>(<span class="pl-v">err</span> <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>screenOrientation error:<span class="pl-pds">'</span></span>, <span class="pl-smi">err</span>.<span class="pl-smi">message</span>);
  });</pre></div>
<p>而在 ios 中，会出现锁屏失败的问题，试验后发现必须将相应的代码写在 <code>platform.ready().then()</code> 的处理函数内才能生效（ ios 有好几个设备相关的功能调用都需要遵守此准则）。此外，需要注意 ios 的竖屏有两种方式，一种是正常的垂直，另一种是倒过来的垂直。最后相关的代码书写为：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">if</span> (<span class="pl-smi">platform</span>.<span class="pl-en">is</span>(<span class="pl-s"><span class="pl-pds">'</span>ios<span class="pl-pds">'</span></span>)) {
  <span class="pl-c"><span class="pl-c">//</span> ios 设备需要在 platform ready 之后再设置方向锁定，</span>
  <span class="pl-c"><span class="pl-c">//</span> 并且锁定的方向应为 PORTRAIT_PRIMARY 。</span>
  <span class="pl-c1">this</span>.<span class="pl-smi">screenOrientation</span>
    .<span class="pl-en">lock</span>(<span class="pl-c1">this</span>.<span class="pl-smi">screenOrientation</span>.<span class="pl-c1">ORIENTATIONS</span>.<span class="pl-c1">PORTRAIT_PRIMARY</span>)
    .<span class="pl-en">catch</span>(<span class="pl-v">err</span> <span class="pl-k">=&gt;</span> {
      <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>screenOrientation error:<span class="pl-pds">'</span></span>, <span class="pl-smi">err</span>.<span class="pl-smi">message</span>);
    });
}</pre></div>
<p>牢记必须书写在 <code>platform.ready().then()</code> 的处理函数内。</p>
<h2>
<a id="31" class="anchor" href="#31" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>调用相册</h2>
<p>使用 <code>ImagePicker</code> 插件，可参阅 <a href="http://ionicframework.com/docs/native/image-picker/">官方说明</a> 。使用方法则参照 <code>/src/providers/image-picker-service.ts</code> 。使用此插件选择图片时，可以设置最多可以选择几张图片。在选择完成之后，返回数据会是一个数组，其中包含了每张被选中的图片在设备中的储存路径。</p>
<h3>
<a id="32" class="anchor" href="#32" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>安装失败的解决方法</h3>
<p>使用 <code>npm install --save @ionic-native/image-picker</code> 命令安装 ImagePicker 插件时，很有可能会出现 fetch ImagePicker.git 失败的错误。这可能是因为 npm 对插件信息的要求更新了，而 ImagePicker 仓库代码长期未更新，导致安装失败。</p>
<p>可以尝试将官方仓库 <code>https://github.com/Telerik-Verified-Plugins/ImagePicker.git</code> 替换为由其 fork 出的分支，例如 <code>https://github.com/darkbasic/ImagePicker.git</code> ，在项目文件中进行查找并替换即可。</p>
<blockquote>
<p>此问题后期似乎已不存在，可能是官方仓库已进行了修正。所以此处的替换操作就不再必要了，但遇到类似问题时，可以参考这种办法进行解决。</p>
</blockquote>
<h3>
<a id="33" class="anchor" href="#33" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>权限检查</h3>
<p>在选取图片之前，首先要检查 APP 是否有相应的权限。 Android 与 ios 使用不同的检查方式。</p>
<p>Android 需要使用 <code>AndroidPermissions</code> 插件（ <code>@ionic-native/android-permissions</code> ），使用 <code>checkPermission()</code> 方法检查是否有权限，若没有，则需要使用 <code>requestPermissions()</code> 方法来请求权限。</p>
<p>而 ios 可以直接使用 <code>ImagePicker</code> 插件的 <code>hasReadPermission()</code> 与 <code>requestReadPermission()</code> 方法。</p>
<p>在确保有相应权限后，再调用 <code>getPictures()</code> 方法来选取图片。</p>
<h2>
<a id="34" class="anchor" href="#34" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>调用摄像头</h2>
<p>使用 <code>CameraPreview</code> 插件，可参阅 <a href="http://ionicframework.com/docs/native/camera-preview/">官方说明</a> 。具体的使用可参照 <code>/src/modals/camera/camera.ts</code> （但此代码中未包含权限检查与申请的功能）。</p>
<blockquote>
<p>此外还有一个 <code>Camera</code> 插件，但功能没有 <code>CameraPreview</code> 强大。</p>
</blockquote>
<p>需要注意的是， <code>CameraPreview</code> 调用后获得的数据并不是所拍图片的存储路径，而是 BASE64 格式的图片内容字符串。在页面上显示图片时，需要在 src 属性上附加 <code>data:image/jpeg;base64,</code> 的前缀。</p>
<h3>
<a id="35" class="anchor" href="#35" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>拍摄区域与工具按钮</h3>
<p><code>CameraPreview</code> 插件目前在界面显示上有较大的缺陷。调用参数对象上有一个 <code>toBack</code> 属性，控制取景画面是否显示在 APP 界面的后方（下面）。若将取景画面显示在上方（ <code>toBack: false</code> ），则它会遮住 APP 的界面；若取景画面显示在下方，则会被 APP 的界面遮住。也就是说，无法自由调整取景画面的层次、与 APP 页面元素的层次交替堆叠显示。</p>
<p>这样带来的主要问题是无法模仿手机原生的拍摄界面：取景画面占据全屏，功能按钮（拍摄、取消等）浮动在画面上。要使用 <code>CameraPreview</code> 插件实现这种效果，目前只能将取景画面放置在下方，然后将 APP 的界面除了功能按钮之外的部分全部隐藏，但工作量偏大，因此未采用此方案。</p>
<p>目前采用的解决方案是将取景画面置于上层，但不占据全屏，通过计算设置好它的位置与大小，将功能按钮放置在剩余空间上。</p>
<h3>
<a id="36" class="anchor" href="#36" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>拍摄照片的处理</h3>
<p>在 APP 使用了竖屏锁定的情况下，拍摄出的照片始终为竖图（高度大于宽度），即使将手机横过来拍摄也是如此。将照片旋转方向、按特定比例剪裁照片等功能， <code>CameraPreview</code> 插件本身未提供，也没有在 Ionic Native 中找到合用的插件。目前这些功能暂时都未实现，不过与剪裁图片相关的图片双指缩放、手指拖动变换位置等功能，已经进行了尝试，可以参看后面的“手势处理”部分。</p>
<h3>
<a id="37" class="anchor" href="#37" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ios 的遗留问题</h3>
<p>使用 iphone 调用 <code>CameraPreview</code> 插件，发现拍摄速度非常慢，点击拍摄按钮后，需要等十几秒才能获取到所拍摄的照片。此问题暂时未找到解决方法。在这种情况下，建议为界面添加“请稍候……”的提示，以便保证交互功能的友好性。</p>
<h2>
<a id="38" class="anchor" href="#38" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>APP 图标与启动画面</h2>
<p>图标与启动画面文件在项目目录的 <code>resources</code> 文件夹下（与 <code>src</code> 平级）。图片文件有各种规格，宽度高度不同，启动画面还分为竖屏与横屏两类规格。</p>
<p>目前高交所 APP 的图标文件已全部做了修改，但其中大尺寸的图标精度不足、看起来有模糊感。而启动画面目前只替换了部分竖屏的，还有一些仍然采用 Ionic 默认的图片，并且也有精度不足的问题。</p>
<p><strong>另外需要注意一点：在 <code>ionic cordova platform add</code> 命令已经执行之后，单纯修改 <code>resources</code> 下的文件并不会影响到构建出来的 APP ，这些文件需要手动复制到 <code>platforms</code> 文件夹下。可以使用文件搜索功能，查看图片具体要复制到何处。此外还要注意， Android 的图标与启动画面文件在 <code>platforms</code> 中是被统一改名为 <code>icon.png</code> 与 <code>screen.png</code> 的，用所在的文件夹来区分，因此复制时需要根据 <code>mipmap-xxxhdpi</code> 之类的文件名前缀来寻找对应的文件夹，并对复制后的文件进行改名。</strong></p>
<h2>
<a id="39" class="anchor" href="#39" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ios 的元素点击</h2>
<p>在 ios 版的 APP 中，可能会经常遇到某些元素点击时反应很慢的问题，有时需要点击两次才会有响应。</p>
<p>解决此问题的方法有两种：</p>
<ol>
<li>
<p>对于需要被点击的元素，将其设置为 <code>&lt;button&gt;</code> 元素。</p>
</li>
<li>
<p>不方便作为 <code>&lt;button&gt;</code> 的元素，可以为元素添加 <code>tappable</code> 属性。</p>
</li>
</ol>
<h2>
<a id="40" class="anchor" href="#40" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>手势处理</h2>
<p>使用 <code>Gesture</code> 可以对手机触摸屏的手势进行处理，使用范例可参考 <code>/src/modals/camera/camera.ts</code> 的 <code>initGestureListener()</code> 方法。不过因为在 ios 设备上对图片进行双指缩放、单指移动有明显的迟滞感，因此暂时将对于该方法的调用注释掉了。</p>
<p>使用 <code>Gesture</code> 需要创建 Gesture 的一个实例，并使用 <code>listen()</code> 开始监听。此后使用 RxJS 的 fromEvent() 来对事件进行后续处理（也可以使用最基础的事件回调函数处理方式，但更建议使用 RxJS ）。</p>
<p>在现有的代码中，对 <code>pinch</code> （双指缩放）与 <code>pan</code> （单指拖动）进行了处理，以便实现图片缩放、位移等效果，意图是让用户手动设定图片剪裁区域，以便将所拍摄的图片按照目标意图裁剪出合适的区域。但此功能目前只完成了一部分。</p>
<h2>
<a id="41" class="anchor" href="#41" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ios9 页面内容不可见</h2>
<p>在 ios9 系统的设备上曾经出现如下问题：进入主界面之后，只能看到页面背景，看不到任何页面元素。</p>
<p>检查后发现是因为页面模板上使用了 <code>percent</code> 通道，而该通道需要依赖 Intl ，在 ios9 上必须安装 Intl 的 polyfill 才能正常使用。</p>
<p><code>npm install --save intl</code></p>
<p>安装后在 <code>app.module.ts</code> 中添加引用：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">'</span>intl<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">'</span>intl/locale-data/jsonp/en<span class="pl-pds">'</span></span>;</pre></div>
<h1>
<a id="42" class="anchor" href="#42" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>页面布局与行为</h1>
<h2>
<a id="43" class="anchor" href="#43" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>界面统一缩放处理</h2>
<p>手持设备有各种不同的尺寸，不仅宽度高度可能不同，宽高比也可能不同。面对不同尺寸的设备，一般有两种方式来处理界面上的内容显示问题：</p>
<ol>
<li>
<p>内容大小（主要是字号、各个区域的尺寸与间距等）固定，一般采用 px （像素）作为单位。也可以使用 rem 为单位，并且将 root 元素（ html 根元素）的 <code>font-size</code> 设定为以 px 为单位的固定值。这样，页面元素的大小、间距等都是相对固定的像素值，在大屏幕手机上将会看到较多的内容，而小屏手机的信息量就较少。</p>
</li>
<li>
<p>对界面上的内容进行动态缩放，以保证不同尺寸的手机看到的内容基本相近。</p>
</li>
</ol>
<p>前一种方式适用于文字内容较多的场合，大屏显示内容多本来就是合理的。但是当页面布局比较复杂时，再采用前一种方式可能就不太合适，因为一般设计稿都是根据某种尺寸设计出来的，如果没有根据设备进行自动缩放，界面布局有可能在小屏手机或超大屏手机上变得很不美观。</p>
<p>高交所 APP 在前期使用的是第一种方式，但观察到显示效果不理想之后，改用了第二种方式。</p>
<p>第二种方式的实现手段在理论上不止一种。先是尝试了 html 页面的 <code>&lt;meta name="viewport"&gt;</code> ，但并未成功。后来改为控制 html 元素的字号，修改 <code>/src/theme/variables.scss</code> ： <code>$font-size-root: 2.666667vw;</code> ，这个设置会应用到 <code>&lt;html&gt;</code> 元素上。此外将项目中几乎所有的样式的尺寸都设置为以 rem 为单位（即以 root 元素的字号为基础进行计算）。 <code>2.666667vw</code> 在宽度 375 的手机（ iphone6 ）上计算结果几乎等于 10px ，符合设计稿。而其他尺寸的手机会根据实际的屏幕宽度调整字号、间距等，以保证在不同手机上界面基本一致。</p>
<p>使用 vw 来控制字体与间距时需要注意：</p>
<ol>
<li>Ionic 自带的许多样式是以 px 为单位的，需要检查界面上会出现的各种样式，将相关的 Sass 变量值都修改为 rem 。</li>
<li>根据 rem 计算出的实际值，不能小于 1px ，否则在界面上可能会显示不出。在这种情况下，需要将相关样式设置为 1px ，而不采用 rem 单位。</li>
<li>在电脑的浏览器中进行测试时，需要注意 Chrome 浏览器默认是对最小字号是有限制的（一般不接受 12px 以下的字号），需要修改 Chrome 的字体设置的高级特性，将最小字号的限制调整到 6px 或 8px ，以保证显示效果正常。</li>
<li>在电脑上使用浏览器模拟设备进行调试时，切换不同大小的设备时需要刷新页面，以保证显示效果。</li>
<li>vw 是以设备宽度为基准的，因此垂直方向上控制不够精确。若确实有垂直控制的需求（例如 <code>/src/pages/trade-interface/trade-interface.html</code> ），则需要考虑使用弹性布局（ flex ），并留意界面高度是否会被动态改变。</li>
</ol>
<h2>
<a id="44" class="anchor" href="#44" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>启动时登录页与主界面的切换</h2>
<p>高交所 APP 在启动画面之后，会进入登录页或是主界面。</p>
<p>原先采用的显示逻辑为：先显示登录页，使用异步操作判断是否已经登录过：若是则切换到主界面（ TabsPage ）；若否则停留在登录页，等用户手动登录之后再切换到主界面。在主界面中，当用户注销登录时，返回登录页。</p>
<p>之前在登录页与主界面之间尝试了 <code>*ngIf</code> 与 <code>[hidden]</code> 两种方案，效果都不理想。前者会导致注销再重新登录时报告页面元素为空的错误；而后者会导致主界面上页头（ <code>&lt;ion-header&gt;</code> ）、页脚（ <code>&lt;ion-footer&gt;</code> ）元素不能正确占据空间、与页面内容重叠。</p>
<p>此后改用导航控件（ <code>NavController</code> ）来解决此问题。起初的方案是先显示登录页（ LoginPage ），登录成功后再将 TabsPage 推入（ push ）到 <code>NavController</code> 的实例上；在注销登录时，将 TabsPage 从 <code>NavController</code> 的实例弹出（ pop ）。</p>
<p>但是这样又发现了新问题：有的安卓手机带有后退按钮（物理按键或模拟按键），在显示主界面时按后退按钮，就会返回登录页。虽然可以在 <code>tabs.ts</code> 的 <code>ionViewCanLeave()</code> 事件处理函数上进行监守，阻止 <code>NavController</code> 后退，但效果仍然不够理想，需要做多余的逻辑处理。</p>
<p>最终的解决方案是不使用 <code>NavController</code> 的 <code>push()</code> 与 <code>pop()</code> 方法，改用 <code>setRoot()</code> 方法。在需要切换到登录页或主界面时，直接使用 <code>rootNav.setRoot(LoginPage);</code> 或 <code>rootNav.setRoot(TabsPage);</code> 。 <code>/src/app/app.component.ts</code> 中的相关代码片段如下：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">const</span> targetPage <span class="pl-k">=</span> <span class="pl-smi">status</span> <span class="pl-k">?</span> <span class="pl-smi">TabsPage</span> <span class="pl-k">:</span> <span class="pl-smi">EntrancePage</span>;
<span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-c1">this</span>.<span class="pl-smi">rootPage</span>){
  <span class="pl-c1">this</span>.<span class="pl-smi">rootPage</span> <span class="pl-k">=</span> <span class="pl-smi">targetPage</span>;

  <span class="pl-c"><span class="pl-c">//</span> rootPage 为空，表示刚刚进入 app ，</span>
  <span class="pl-c"><span class="pl-c">//</span> 需要在登录状态确认后进行初始化操作。</span>
  <span class="pl-smi">platform</span>.<span class="pl-en">ready</span>().<span class="pl-en">then</span>(() <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">this</span>.<span class="pl-en">afterPlatformReady</span>(<span class="pl-smi">platform</span>, <span class="pl-smi">statusBar</span>, <span class="pl-smi">splashScreen</span>);
  });
} <span class="pl-k">else</span> {
  <span class="pl-k">const</span> rootNav <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">appCtrl</span>.<span class="pl-en">getRootNav</span>();
  <span class="pl-k">const</span> topPage <span class="pl-k">=</span> <span class="pl-smi">rootNav</span>.<span class="pl-en">last</span>().<span class="pl-smi">component</span>;

  <span class="pl-k">if</span> (<span class="pl-smi">targetPage</span> <span class="pl-k">!==</span> <span class="pl-smi">topPage</span>){
    <span class="pl-k">const</span> direction <span class="pl-k">=</span> <span class="pl-smi">status</span> <span class="pl-k">?</span> <span class="pl-s"><span class="pl-pds">'</span>forward<span class="pl-pds">'</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>back<span class="pl-pds">'</span></span>;
    <span class="pl-smi">rootNav</span>.<span class="pl-en">setRoot</span>(<span class="pl-smi">targetPage</span>, {}, {
      <span class="pl-smi">direction</span>, animation: <span class="pl-s"><span class="pl-pds">'</span>ios-transition<span class="pl-pds">'</span></span>, animate: <span class="pl-c1">true</span>,
    });
  }
}</pre></div>
<p>其中：</p>
<ul>
<li>
<code>status</code> 是代表登录状态的布尔值，为 <code>true</code> 时代表登录成功，需要进入主界面（ TabsPage ）。</li>
<li>
<code>rootPage</code> 是当前类的一个属性，初始值为 <code>undefined</code> ，对应的 html 页面模板内容为 <code>&lt;ion-nav [root]="rootPage"&gt;&lt;/ion-nav&gt;</code> 。</li>
<li>当 <code>rootPage</code> 值为空（实际上是 <code>undefined</code> ）时，代表是第一次获取 <code>status</code> 的值，可以直接设置 <code>this.rootPage</code> 值为目标页面；在设置 <code>rootPage</code> 之后才使用 <code>platform.ready().then()</code> 进行一些初始化操作，包括 <code>splashScreen.hide()</code> 。这样可以保证在登录状态确定之后才隐藏启动画面，避免先看见一个黑屏。</li>
<li>当 <code>rootPage</code> 值非空时，代表 APP 的界面已经显示，此时不应该简单切换登录页与主界面，而是需要显示一点动画效果，给用户一个直观的视觉感受。此时使用 <code>this.appCtrl.getRootNav()</code> 来获取 APP 的根导航控件实例；根据所前往的目标页面（ TabsPage 或 LoginPage ），设置 <code>direction</code> 参数以决定导航页切换动画的显示方向（前进或后退）；启用 <code>animate: true</code> 强制显示动画（ <code>setRoot()</code> 方法默认无动画）。</li>
</ul>
<p>此外，使用 <code>animation: 'ios-transition'</code> 参数强制使用 ios 版的页面滑入滑出动画（水平方向左右滑动），视觉效果较好。</p>
<h2>
<a id="45" class="anchor" href="#45" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>页面内容垂直居中</h2>
<p>如果要让 <code>&lt;ion-content&gt;</code> 中的内容垂直居中显示，可以在 <code>&lt;ion-content&gt;</code> 元素上使用 <code>vertical-align-center</code> 样式，对应的 css 代码如下：</p>
<div class="highlight highlight-source-css"><pre><span class="pl-e">.vertical-align-center</span> <span class="pl-k">&gt;</span> <span class="pl-ent">*</span> {
  <span class="pl-c1"><span class="pl-c1">display</span></span>: <span class="pl-c1">flex</span><span class="pl-k">!important</span>;
  <span class="pl-c1"><span class="pl-c1">align-content</span></span>: <span class="pl-c1">center</span><span class="pl-k">!important</span>;
  <span class="pl-c1"><span class="pl-c1">align-items</span></span>: <span class="pl-c1">center</span><span class="pl-k">!important</span>;
}</pre></div>
<p>这个样式需要 css3 支持。</p>
<p>但是如果页面（例如登录页）上存在输入框，那么这个样式会在输入框获得焦点、软键盘弹出时造成问题：输入框会浮到页面上方不可见的区域内。为了解决这个问题，目前是在页面的生命周期事件上添加处理方法。</p>
<ol>
<li>
<p>html 模板的大致内容如下：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-header</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>header-placeholder<span class="pl-pds">"</span></span> #<span class="pl-e">headerRef</span>&gt;&lt;/<span class="pl-ent">ion-header</span>&gt;

&lt;<span class="pl-ent">ion-content</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>bg-out<span class="pl-pds">"</span></span> [<span class="pl-e">class</span>.<span class="pl-e">vertical-align-center</span>]=<span class="pl-s"><span class="pl-pds">"</span>verticalCenter<span class="pl-pds">"</span></span> #<span class="pl-e">contentRef</span>&gt;
  &lt;<span class="pl-ent">ion-grid</span> <span class="pl-e">no-padding</span> [<span class="pl-e">style</span>.<span class="pl-e">marginTop</span>]=<span class="pl-s"><span class="pl-pds">"</span>gridMarginTop<span class="pl-pds">"</span></span> #<span class="pl-e">loginGrid</span>&gt;
    <span class="pl-c"><span class="pl-c">&lt;!--</span> 其余内容 <span class="pl-c">--&gt;</span></span>
  &lt;/<span class="pl-ent">ion-grid</span>&gt;
&lt;/<span class="pl-ent">ion-content</span>&gt;</pre></div>
<p>此处为 <code>&lt;ion-header&gt;</code> 、 <code>&lt;ion-content&gt;</code> 、 <code>&lt;ion-grid&gt;</code> 三个元素分别绑定了模板变量（ <code>#headerRef</code> 、<code>#contentRef</code> 、<code>#loginGrid</code> ），以便在 ts 文件中引用这三个元素。</p>
<p>此外还使用了两个类属性 <code>verticalCenter</code> 与 <code>gridMarginTop</code> 。</p>
</li>
<li>
<p>在对应的 ts 文件中，设置相应的类属性：</p>
<div class="highlight highlight-source-ts"><pre>  @<span class="pl-en">ViewChild</span>(<span class="pl-s"><span class="pl-pds">'</span>loginGrid<span class="pl-pds">'</span></span>) <span class="pl-smi">loginGrid</span>;
  @<span class="pl-en">ViewChild</span>(<span class="pl-s"><span class="pl-pds">'</span>contentRef<span class="pl-pds">'</span></span>) <span class="pl-smi">contentRef</span>;
  @<span class="pl-en">ViewChild</span>(<span class="pl-s"><span class="pl-pds">'</span>headerRef<span class="pl-pds">'</span></span>) <span class="pl-smi">headerRef</span>;

  <span class="pl-smi">private</span> <span class="pl-smi">verticalCenter</span>:<span class="pl-smi">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
  <span class="pl-smi">private</span> <span class="pl-smi">gridPaddingTop</span>:<span class="pl-smi">string</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>0<span class="pl-pds">'</span></span>;</pre></div>
</li>
<li>
<p>在页面加载事件函数 <code>ionViewDidLoad()</code> 中进行处理：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">ionViewDidLoad</span>() {
  <span class="pl-k">function</span> getComputedHeight(<span class="pl-v">elem</span><span class="pl-k">:</span> <span class="pl-en">HTMLElement</span>)<span class="pl-k">:</span> <span class="pl-c1">number</span>{
    <span class="pl-k">return</span> <span class="pl-c1">parseFloat</span>(<span class="pl-c1">window</span>.<span class="pl-en">getComputedStyle</span>(<span class="pl-smi">elem</span>).<span class="pl-c1">height</span>);
  }

  <span class="pl-k">const</span> pageElem <span class="pl-k">=</span> &lt;<span class="pl-en">HTMLElement</span>&gt;<span class="pl-c1">this</span>.<span class="pl-smi">elementRef</span>.<span class="pl-smi">nativeElement</span>;
  <span class="pl-k">const</span> contentElem <span class="pl-k">=</span> &lt;<span class="pl-en">HTMLElement</span>&gt;<span class="pl-smi">pageElem</span>.<span class="pl-c1">querySelector</span>(<span class="pl-s"><span class="pl-pds">'</span>ion-content<span class="pl-pds">'</span></span>);
  <span class="pl-k">const</span> gridElem <span class="pl-k">=</span> &lt;<span class="pl-en">HTMLElement</span>&gt;<span class="pl-smi">contentElem</span>.<span class="pl-c1">querySelector</span>(<span class="pl-s"><span class="pl-pds">'</span>ion-grid<span class="pl-pds">'</span></span>);
  <span class="pl-k">const</span> window <span class="pl-k">=</span> <span class="pl-smi">pageElem</span>.<span class="pl-c1">ownerDocument</span>.<span class="pl-c1">defaultView</span>;
  <span class="pl-k">const</span> gridHeight <span class="pl-k">=</span> <span class="pl-en">getComputedHeight</span>(<span class="pl-smi">gridElem</span>);
  <span class="pl-k">const</span> contentHeight <span class="pl-k">=</span> <span class="pl-en">getComputedHeight</span>(<span class="pl-smi">contentElem</span>);
  <span class="pl-k">const</span> header <span class="pl-k">=</span> &lt;<span class="pl-en">HTMLElement</span>&gt;<span class="pl-smi">pageElem</span>.<span class="pl-c1">querySelector</span>(<span class="pl-s"><span class="pl-pds">'</span>ion-header<span class="pl-pds">'</span></span>);

  <span class="pl-k">const</span> span <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">max</span>(<span class="pl-c1">0</span>, 
    <span class="pl-c1">Math</span>.<span class="pl-c1">floor</span>((<span class="pl-smi">contentHeight</span> <span class="pl-k">-</span> <span class="pl-smi">gridHeight</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>) <span class="pl-k">-</span>
      (<span class="pl-smi">header</span> <span class="pl-k">?</span> <span class="pl-en">getComputedHeight</span>(<span class="pl-smi">header</span>) <span class="pl-k">:</span> <span class="pl-c1">0</span>)
  );

  <span class="pl-c1">this</span>.<span class="pl-smi">verticalCenter</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;
  <span class="pl-c1">this</span>.<span class="pl-smi">gridPaddingTop</span> <span class="pl-k">=</span> <span class="pl-smi">span</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>px<span class="pl-pds">'</span></span>;
}</pre></div>
<p>代码对 <code>&lt;ion-header&gt;</code> 、 <code>&lt;ion-content&gt;</code> 、 <code>&lt;ion-grid&gt;</code> 三个元素的高度进行了计算，算出 <code>&lt;ion-grid&gt;</code> 元素需要使用的 <code>margin-top</code> 样式属性具体值，将其赋值给对应的类属性，并且在计算完成后将 <code>verticalCenter</code> 类属性设置为 <code>false</code> ，以便让页面上 <code>&lt;ion-content&gt;</code> 元素的 <code>.vertical-align-center</code> css 类被去除（ <code>[class.vertical-align-center]="verticalCenter"</code> ）。</p>
<p>于是，在页面加载完成时，先是利用 <code>.vertical-align-center</code> css 类来实现页面内容的居中；紧接着在 <code>ionViewDidLoad()</code> 事件处理函数中算出实际需要的 <code>padding-top</code> 值后，将其应用到 <code>&lt;ion-grid&gt;</code> 元素上，并且去掉 <code>.vertical-align-center</code> 。这样就兼顾了内容垂直居中显示与软键盘弹出时行为的正确性。</p>
<blockquote>
<p>此处仅考虑了页头元素，在某些界面上可能还要考虑页脚元素的高度。</p>
</blockquote>
</li>
<li>
<p>实际上这样修改后还有遗留问题，计算出的 <code>padding-top</code> 值总是比预计的值要小。研究后发现是多语言支持引发的问题。</p>
<p>登录页上存在“忘记密码”文字，对应的元素内容为：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>small-font<span class="pl-pds">"</span></span>&gt;{{'rsForgetPassword'|translate}}&lt;/<span class="pl-ent">span</span>&gt;</pre></div>
<p>这一行文字与“记住密码”并排显示，并使用了 css3 的弹性盒布局（ flex-box ）来保证两个元素各占一半的水平空间。</p>
<p>当页面被渲染时，“忘记密码”的文字会首先被显示为 <code>rsForgetPassword</code> ，由于这行文字比较长，会导致“忘记密码”所在的 <code>&lt;ion-col&gt;</code> 元素无法与“记住密码”并排显示，而是会掉到下一行，这样 <code>&lt;ion-grid&gt;</code> 的高度就增加了，导致算出来的 <code>padding-top</code> 值偏小。而在 <code>ionViewDidLoad()</code> 处理完毕后， <code>translate</code> 管道操作才会执行，将 <code>rsForgetPassword</code> 转换为 <code>忘记密码</code> ，但此时已无法影响页面的垂直布局。</p>
<p>为了解决此问题，目前暂时使用了一种变通手段：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">span</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>small-font<span class="pl-pds">"</span></span> [<span class="pl-e">hidden</span>]=<span class="pl-s"><span class="pl-pds">"</span>verticalCenter<span class="pl-pds">"</span></span>&gt;{{'rsForgetPassword'|translate}}&lt;/<span class="pl-ent">span</span>&gt;</pre></div>
<p>也就是在 <code>ionViewDidLoad()</code> 的计算完成之前，暂时隐藏 <code>rsForgetPassword</code> 文字的显示；在计算完成后（ <code>verticalCenter</code> 属性值变为 <code>false</code> ），再将这行文字显示出来。</p>
<p>如果有多个涉及到多语言处理的页面内容会影响页面布局，则都需要进行这样的处理（不过在目前的登录页上，只有“忘记密码”会有影响）。</p>
<blockquote>
<p>多语言支持在后期的代码中已经被移除，此处修改已无必要，仅作为一个参考。</p>
</blockquote>
</li>
</ol>
<h2>
<a id="46" class="anchor" href="#46" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>弹性布局在软键盘弹出时的问题</h2>
<p>以交易界面（ <code>/src/pages/trade-interface/trade-interface.html</code> ）为例。此界面设计意图是所有内容一屏就可以显示完，不需要滚动页面，并且应当撑满界面。目前高交所 APP 是使用屏幕宽度来控制文字、各个区域的大小的，从水平方向上来说可以做到自适应。但是由于各种手机屏幕宽度高度比例不一致，因此垂直方向并没有得到控制。交易界面是目前仅有的对水平与垂直方向显示内容都有要求的页面。</p>
<p>为了保证所有内容被限制在一屏内，此页面主要区域的高度都进行了限制；而为了在高度比例更大的手机上能够撑满屏幕，在几个主要区域的元素上都做了弹性高度的样式，例如：</p>
<div class="highlight highlight-source-scss"><pre><span class="pl-e">.scroll-content</span> {
  <span class="pl-c1"><span class="pl-c1">display</span></span>: flex;
  <span class="pl-c1"><span class="pl-c1">flex</span>-<span class="pl-c1">direction</span></span>: column;
}

<span class="pl-e">.trtop</span>{
  <span class="pl-c1"><span class="pl-c1">flex</span>-grow</span>: <span class="pl-c1">1</span>;
  <span class="pl-c1"><span class="pl-c1">flex</span>-shrink</span>: <span class="pl-c1">0</span>;
  <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">13</span><span class="pl-k">rem</span>;
}</pre></div>
<p>容器 <code>.scroll-content</code> 使用了纵向弹性布局，而其子元素（ <code>.trtop</code> 等）使用 <code>flex-shrink: 0;</code> 保证高度不可被压缩，并且使用 <code>flex-grow: 1;</code> 让元素高度在页面高度较大时能够自动增长。这样处理之后，实现了页面内容在垂直方向上的高度自适应。</p>
<p>但是由于此页面包含输入框（股票价格与买卖数量），在输入框被激活、软键盘弹出时会出现问题。</p>
<p>前面提到过，软键盘弹出时，目前程序会对页面的高度进行调整，缩小页面高度保证内容可见性。而在此页面中，当页面高度缩小时，留给弹性布局的富余高度没有了，因此各个弹性元素的高度就回复到样式预设的初始高度；在软键盘收起、页面高度增加时，这些元素高度又会自动增长。这样就造成了页面上主要元素的高度变化，让页面在视觉上出现跳跃感。</p>
<p>解决此问题的思路是：在 <code>ionViewDidLoad()</code> 事件上增加处理代码，当页面渲染完成后，计算出各个相关元素的实际高度，将其写到元素的 <code>style</code> 属性上；并且覆盖掉这些元素的 <code>flex-grow</code> 样式，将其设为 <code>flex-grow: 0;</code> ，取消高度的弹性变化特性。这样在页面高度发生变化时，这些元素的高度依然会保持固定值，不会出现跳跃现象。</p>
<p>此处提供的是解决思路，但相关代码并未书写，可以参考登录页对于内容垂直居中的处理方式。</p>
<h2>
<a id="47" class="anchor" href="#47" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>伪造的横屏效果</h2>
<p>在股票详情页上，有横屏显示的需求，以便用更大的区域来显示实时走势或 K 线图。</p>
<p>之前曾经使用过传统的方式：解除手机的方向锁定，将手机方向调整到横屏方向并锁定。但是实践后发现这种方式会导致很差的视觉效果：</p>
<ol>
<li>在显示内容从竖屏方式向横屏方式过渡的过程中，显示内容外部会出现大块白色区域（手机所给的界面背景色），非常难看。</li>
<li>由于使用了状态栏透明的方式，而横屏界面不希望显示状态栏，因此在切换之前需要隐藏状态栏，在切换回竖屏方式后又要再显示状态栏，不仅步骤繁琐，而且在显示/隐藏状态栏的时候会有明显的抖动感。</li>
</ol>
<p>因此后来放弃了调整设备方向的方式，改为使用伪造的横屏效果。核心思路为：</p>
<ol>
<li>设备始终保持竖屏锁定。</li>
<li>在页面上构造一个区域，使用 <code>width: 100vh; height: 100vw;</code> 样式互换宽度与高度，即：宽度为界面高度，而高度则为界面宽度。</li>
<li>该区域初始情况不可见，不使用 <code>display: none;</code> ，也不使用 <code>visibility: hidden;</code> ，而是使用透明度 <code>opacity: 0;</code> 来保证区域元素存在但不可见；此外需要调整其位置，使用 <code>position: relative;</code> 并设置合适的 <code>left</code> 与 <code>top</code> 值；同时为了避免该区域遮挡其他元素，设置 <code>z-index: -1;</code> 。</li>
<li>当需要显示该区域时，利用 css3 的旋转变形 <code>transform: rotate(90deg);</code> 将其旋转 90 度，同时修改透明度与 <code>z-index</code> 。为了增强视觉效果，还可以设置 <code>transition</code> 属性以保证有过渡过程。</li>
</ol>
<p>完整的 Sass 代码如下（位于 <code>/src/app/app.scss</code> ）：</p>
<div class="highlight highlight-source-sass"><pre><span class="pl-e">.sim-landscape</span> {
  <span class="pl-c1">width</span>:<span class="pl-c1"> 100</span><span class="pl-k">vh</span>;
  <span class="pl-c1">height</span>:<span class="pl-c1"> 100</span><span class="pl-k">vw</span>;
  <span class="pl-c1">position</span>: <span class="pl-c1">relative</span>;
  <span class="pl-c1">left</span>: calc(<span class="pl-c1">50</span><span class="pl-k">vw</span> <span class="pl-c1">- 50</span><span class="pl-k">vh</span>);
  <span class="pl-c1">top</span>: calc(<span class="pl-c1">50</span><span class="pl-k">vh</span> <span class="pl-c1">- 50</span><span class="pl-k">vw</span>);
  <span class="pl-c1">transform</span>: rotat<span class="pl-c1">e</span>(0);
  <span class="pl-c1">transition</span>: all <span class="pl-e">.4s</span>;
  <span class="pl-c1">opacity</span>:<span class="pl-c1"> 0</span>;
  <span class="pl-c1">z-index</span>: <span class="pl-c1">-1</span>;

  <span class="pl-k">&amp;</span><span class="pl-e">.show</span> {
    <span class="pl-c1">transform</span>: rotat<span class="pl-c1">e</span>(90deg);
    <span class="pl-c1">opacity</span>:<span class="pl-c1"> 1</span>;
    <span class="pl-c1">z-index</span>:<span class="pl-c1"> 100</span>;
  }
}</pre></div>
<p>在需要显示该区域元素时，在元素上加添 class <code>show</code> 即可：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>sim-landscape<span class="pl-pds">"</span></span> [<span class="pl-e">class</span>.<span class="pl-e">show</span>]=<span class="pl-s"><span class="pl-pds">"</span>!isPortrait<span class="pl-pds">"</span></span>&gt;</pre></div>
<h3><a id="47_2" class="anchor" href="#47_2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Echarts 坐标轴变换</h3>
<p>在使用伪造的横屏效果之后，在 ECharts 图表上点击（或在触摸屏上拖动），会发现触发的坐标不正确，因为虽然元素旋转了 90 度，但页面却没有旋转。</p>
<p>需要修改 <code>/node_modules/zrender/lib/core/event.js</code> 的 <code>defaultGetZrXY()</code> 函数来解决这个问题：</p>
<pre><code class="js">function defaultGetZrXY(el, e, out) {
    // This well-known method below does not support css transform.
    var box = getBoundingClientRect(el);
    if (!window.screenSimLandscape) {
        out.zrX = e.clientX - box.left;
        out.zrY = e.clientY - box.top;
    } else {
        out.zrX = e.clientY - box.top;
        out.zrY = box.width - e.clientX - box.left;
    }
}
</code></pre>

<p>在使用伪造的横屏模式时，需要设置 <code>window.screenSimLandscape = true</code> ；还原到正常模式时，需要将此属性设为 <code>false</code> 。</p>
<h1>
<a id="48" class="anchor" href="#48" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>css 样式定义与修改</h1>
<h2>
<a id="49" class="anchor" href="#49" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>修改Sass变量</h2>
<p>Ionic2+ 的样式使用 Sass ，预定了许多的变量，可参考 <a href="http://ionicframework.com/docs/theming/overriding-ionic-variables/">Overriding Ionic Sass Variables</a> 。这些 Sass 变量是可以覆盖的，一般通过修改 <code>/src/theme/variables.scss</code> 来实现。</p>
<p>修改时需要注意， Ionic2+ 的风格有 ios 、 md 、 wp 三种，一般需要同时修改三个风格的变量值。</p>
<p>修改 Sass 变量值需要首先找到对应的变量名称。一般是通过功能、组件名称等因素去猜测对应的变量名称，到 Overriding Ionic Sass Variables 页面上去查找。但是因为预设变量太多，这样查找有时很难找到目标变量。</p>
<p>也可以使用另一种方式，即直接搜索 Ionic 的源代码。首先在页面上观察需要修改的样式，记下样式的选择器；然后到项目依赖文件 <code>C:\msys64\usr\src\venus\gjs-app\node_modules\ionic-angular</code> 中查找文件内容，所查找的文件扩展名限定为 <code>*.scss</code> （ Sass 文件常用的扩展名）；找到之后观察相应的变量名称。例如查找选择器 <code>.header-ios .toolbar-background-ios</code> ，会在 <code>/node_modules/ionic-angular/components/toolbar/toolbar.ios.scss</code> 中找到如下代码：</p>
<div class="highlight highlight-source-sass"><pre><span class="pl-e">.header-ios</span> <span class="pl-e">.toolbar-background-ios</span>,
<span class="pl-e">.footer-ios</span> <span class="pl-e">.toolbar-background-ios</span> {
  <span class="pl-c1">border-style</span>: <span class="pl-c1">solid</span>;
  <span class="pl-c1">border-color</span>: <span class="pl-v">$toolbar-ios-border-color</span>;
}</pre></div>
<p>这样我们就知道，修改其边框颜色，需要修改的是 <code>$toolbar-ios-border-color</code> ，在 <code>/src/theme/variables.scss</code> 文件中重新书写 <code>$toolbar-ios-border-color</code> 的值，便可以覆盖 Ionic 的预设值。</p>
<h2>
<a id="50" class="anchor" href="#50" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>自定义样式</h2>
<p>自定义的样式可以书写在全局的 <code>/src/app/app.scss</code> 文件中，也可以写在每个组件各自目录下的 scss 文件中。</p>
<p>各个组件自用的样式，可以用组件名称作为外层选择器，将自定义的样式嵌套在其内部，以避免样式相互干扰。 Angular 的样式实际上有三种模式：原生 (Native)、仿真 (Emulated) 和无 (None)，这决定了组件的样式是局部的还是全局的、相互之间是否会影响。 Ionic 使用的是 None 模式，也就是组件定义的样式也会与全局样式相互影响，因此为了保证其局部性，有必要使用组件名称作为外层选择器。</p>
<p>全局样式定义时，需要考虑与 Ionic 预设样式之间的关系。对于允许传入自定义 class 名称的 Ionic 控件，可以考虑在样式定义上多加一层自定义 class 名称，使用时传入该 class 。例如：</p>
<div class="highlight highlight-source-sass"><pre><span class="pl-e">.dark-alert</span> {
  <span class="pl-e">.alert-wrapper</span> {
    <span class="pl-c1">background-color</span>: <span class="pl-c1">rgba</span>(0, 0, 0, .75);
    <span class="pl-c1">max-width</span>:<span class="pl-c1"> 90</span><span class="pl-k">%</span>;

    <span class="pl-e">.alert-button</span> {
      <span class="pl-c1">border</span>: <span class="pl-c1">none</span>;

      <span class="pl-c1">background-color</span>: <span class="pl-c1">transparent</span>;

      <span class="pl-k">&amp;</span><span class="pl-e">:before</span> {
        <span class="pl-c1">font-size</span>:<span class="pl-c1"> 4</span><span class="pl-k">rem</span>;
        <span class="pl-c1">color</span>: <span class="pl-c1">color</span>(<span class="pl-v">$colors</span>, primary);
        <span class="pl-c1">font-family</span>: Ionicons;
        <span class="pl-c1">content</span>: <span class="pl-s">"<span class="pl-c1">\f</span>2bf"</span>;
      }
    }

    <span class="pl-e">.button-inner</span> {
      <span class="pl-c1">display</span>: <span class="pl-c1">none</span>;
    }

    <span class="pl-e">.alert-sub-title</span>, <span class="pl-e">.alert-message</span> {
      <span class="pl-c1">text-align</span>: <span class="pl-c1">left</span>;
      <span class="pl-c1">font-size</span>:<span class="pl-c1"> 1.4</span><span class="pl-k">rem</span>;
      <span class="pl-c1">line-height</span>:<span class="pl-c1"> 2</span><span class="pl-k">rem</span>;
      <span class="pl-c1">text-indent</span>:<span class="pl-c1"> 2</span><span class="pl-k">em</span>;

      <span class="pl-c1">font-weight</span>: <span class="pl-c1">normal</span>;
      <span class="pl-c1">color</span>: <span class="pl-c1">color</span>(<span class="pl-v">$colors</span>, primary);
    }
  }

  <span class="pl-e">.alert-title</span> {
    <span class="pl-c1">font-size</span>:<span class="pl-c1"> 1.8</span><span class="pl-k">rem</span>;
    <span class="pl-c1">color</span>: <span class="pl-c1">color</span>(<span class="pl-v">$colors</span>, primary);
    <span class="pl-c1">text-align</span>: <span class="pl-c1">center</span>;
  }
}</pre></div>
<p>此处为 <code>AlertController</code> 控件自定义了一个 <code>dark-alert</code> class 。创建提示框实例时则使用：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">showAlert</span>(<span class="pl-smi">title</span>, <span class="pl-smi">message</span>, <span class="pl-smi">cssClass</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>dark-alert<span class="pl-pds">'</span></span>){
  <span class="pl-k">let</span> confirm <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">alertCtrl</span>.<span class="pl-en">create</span>({
    <span class="pl-smi">cssClass</span>,
    <span class="pl-smi">title</span>,
    <span class="pl-smi">message</span>,
    <span class="pl-c"><span class="pl-c">//</span> 其他选项……</span>
  });
  <span class="pl-smi">confirm</span>.<span class="pl-en">present</span>();
}</pre></div>
<p>有时我们则希望彻底覆盖 Ionic 预设的样式，这也需要观察页面上的元素样式，查看其所使用的选择器，<strong>在书写自定义样式的选择器时，需要保证能够将 Ionic 的预设值覆盖掉。具体可查阅 css 选择器优先级的资料，注意 id 、 class 、属性、标签等选择器要素的计算与覆盖规则</strong>。</p>
<h2>
<a id="51" class="anchor" href="#51" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sass 混入范例</h2>
<p>使用 Sass 可以一定程度上简化样式代码的书写，例如使用循环与混入。在高交所项目自定义图标的样式上就利用了这些特性。</p>
<div class="highlight highlight-source-sass"><pre><span class="pl-k">@mixin</span><span class="pl-c1"> gicon</span>(<span class="pl-v">$icon-name</span>){
  <span class="pl-e">.ion-ios-g</span>#{<span class="pl-v">$icon-name</span>}<span class="pl-e">::before</span> {
    <span class="pl-c1">content</span>:<span class="pl-s">""</span>;
    <span class="pl-c1">display</span>: <span class="pl-c1">block</span>;
    <span class="pl-c1">width</span>:<span class="pl-c1"> 2.4</span><span class="pl-k">rem</span>;
    <span class="pl-c1">height</span>:<span class="pl-c1"> 2.4</span><span class="pl-k">rem</span>;
    <span class="pl-c1">background</span>: url(../assets/images/icons/g-#{<span class="pl-v">$icon-name</span>}<span class="pl-e">.png</span>) <span class="pl-c1">center</span> <span class="pl-c1">center</span>/<span class="pl-c1">2.4</span><span class="pl-k">rem</span><span class="pl-c1"> 2.4</span><span class="pl-k">rem</span> <span class="pl-c1">no-repeat</span>;
  }
}

<span class="pl-v">$g-icons</span>: <span class="pl-s">'about'</span> <span class="pl-s">'transfer'</span> <span class="pl-s">'card'</span> <span class="pl-s">'doc'</span> <span class="pl-s">'hand'</span> <span class="pl-s">'help'</span> <span class="pl-s">'person'</span> <span class="pl-s">'trend'</span>
   <span class="pl-s">'clock'</span> <span class="pl-s">'phone'</span> <span class="pl-s">'wechat'</span> <span class="pl-s">'link'</span> <span class="pl-s">'rule'</span> <span class="pl-s">'agree'</span> <span class="pl-s">'amount'</span>
   <span class="pl-s">'price'</span> <span class="pl-s">'comment'</span> <span class="pl-s">'review'</span> <span class="pl-s">'news'</span> <span class="pl-s">'announce'</span>;
<span class="pl-k">@each</span> <span class="pl-v">$icon-name</span> <span class="pl-c1">in</span> <span class="pl-v">$g-icons</span>{
  <span class="pl-k">@include</span><span class="pl-c1"> gicon</span>(<span class="pl-v">$icon-name</span>);
}</pre></div>
<p>其中混入函数 <code>gicon</code> 的定义写在 <code>/src/app/_mixin.scss</code> 中。</p>
<p>此处使用列表（元组）列出了所有自定义图标的名称（ <code>$g-icons</code> ），然后使用 <code>@each</code> 循环逐个调用 <code>gicon</code> 函数。最终生成的 css 样式为：</p>
<div class="highlight highlight-source-css"><pre><span class="pl-e">.ion-ios-gabout</span><span class="pl-e">::before</span> {
  <span class="pl-c1"><span class="pl-c1">content</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
  <span class="pl-c1"><span class="pl-c1">display</span></span>: <span class="pl-c1">block</span>;
  <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">2.4<span class="pl-k">rem</span></span>;
  <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">2.4<span class="pl-k">rem</span></span>;
  <span class="pl-c1"><span class="pl-c1">background</span></span>: <span class="pl-c1">url</span>(<span class="pl-v">../assets/images/icons/g-about.png</span>) <span class="pl-c1">center</span> <span class="pl-c1">center</span>/<span class="pl-c1">2.4<span class="pl-k">rem</span></span> <span class="pl-c1">2.4<span class="pl-k">rem</span></span> <span class="pl-c1">no-repeat</span>;
}

<span class="pl-e">.ion-ios-gtransfer</span><span class="pl-e">::before</span> {
  <span class="pl-c1"><span class="pl-c1">content</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
  <span class="pl-c1"><span class="pl-c1">display</span></span>: <span class="pl-c1">block</span>;
  <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">2.4<span class="pl-k">rem</span></span>;
  <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">2.4<span class="pl-k">rem</span></span>;
  <span class="pl-c1"><span class="pl-c1">background</span></span>: <span class="pl-c1">url</span>(<span class="pl-v">../assets/images/icons/g-transfer.png</span>) <span class="pl-c1">center</span> <span class="pl-c1">center</span>/<span class="pl-c1">2.4<span class="pl-k">rem</span></span> <span class="pl-c1">2.4<span class="pl-k">rem</span></span> <span class="pl-c1">no-repeat</span>;
}

<span class="pl-e">.ion-ios-gcard</span><span class="pl-e">::before</span> {
  <span class="pl-c1"><span class="pl-c1">content</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>;
  <span class="pl-c1"><span class="pl-c1">display</span></span>: <span class="pl-c1">block</span>;
  <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">2.4<span class="pl-k">rem</span></span>;
  <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">2.4<span class="pl-k">rem</span></span>;
  <span class="pl-c1"><span class="pl-c1">background</span></span>: <span class="pl-c1">url</span>(<span class="pl-v">../assets/images/icons/g-card.png</span>) <span class="pl-c1">center</span> <span class="pl-c1">center</span>/<span class="pl-c1">2.4<span class="pl-k">rem</span></span> <span class="pl-c1">2.4<span class="pl-k">rem</span></span> <span class="pl-c1">no-repeat</span>;
}

<span class="pl-c"><span class="pl-c">/*</span> ……以下省略，不一一列出 <span class="pl-c">*/</span></span></pre></div>
<h2>
<a id="52" class="anchor" href="#52" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>统一样式</h2>
<p>Ionic 为 ios 、 Android 、 Windows Phone 三种平台都设计了不同风格的样式，布局、行为上都有所区别。但高交所 APP 项目希望尽量使用同一风格的界面，这样在修改 Sass 变量时，就需要将三种平台对应的变量值（ ios 、 md 、 wp ）都改为相同的值。</p>
<p>此外在图标方面，若需要控制 APP 使用同一风格的图标可以修改 <code>app.module.ts</code> 的 <code>imports</code> 部分：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">imports</span>: [
  <span class="pl-smi">IonicModule</span>.<span class="pl-en">forRoot</span>(<span class="pl-smi">GjsApp</span>,  {
    iconMode: <span class="pl-s"><span class="pl-pds">'</span>ios<span class="pl-pds">'</span></span>, <span class="pl-c"><span class="pl-c">//</span> ui 统一使用 ios platform 模式</span>
  }),
]</pre></div>
<p>在 <code>&lt;ion-icon&gt;</code> 的 html 代码中也可以指定图标的风格，例如可以为元素指定一个 <code>ios</code> 属性，强制使用 ios 版的图标：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">ion-icon</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>swap<span class="pl-pds">"</span></span> <span class="pl-e">ios</span> <span class="pl-e">color</span>=<span class="pl-s"><span class="pl-pds">"</span>#fff<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">ion-icon</span>&gt;</pre></div>
<h2>
<a id="53" class="anchor" href="#53" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>svg</h2>
<p>在 <code>/src/pages/stock-detail/stock-detail.html</code> 页面上使用 svg 来绘制弧形背景。由于界面会根据设备宽度等比缩放，因此 svg 元素也需要进行缩放，并保证绘制出来的图形不变形。</p>
<p>对应的 sass 样式为：</p>
<div class="highlight highlight-source-sass"><pre><span class="pl-e">.circle-svg</span> {
  <span class="pl-c1">width</span>:<span class="pl-c1">13.8</span><span class="pl-k">rem</span>;
  <span class="pl-c1">height</span>:<span class="pl-c1">13.8</span><span class="pl-k">rem</span>;
  <span class="pl-c1">margin</span>:<span class="pl-c1"> 0</span> <span class="pl-c1">auto</span>;

  path {
    <span class="pl-c1">stroke</span>: <span class="pl-c1">#EBEFF4</span>;
  }

  <span class="pl-k">&amp;</span><span class="pl-e">.rise</span> path {
    <span class="pl-c1">stroke</span>: <span class="pl-c1">#DD3838</span>;
  }

  <span class="pl-k">&amp;</span><span class="pl-e">.fall</span> path {
    <span class="pl-c1">stroke</span>: <span class="pl-c1">#0D7593</span>;
  }
}</pre></div>
<p>svg 元素的宽度与高度是使用 rem 来指定的，而为了保证图形自适应并且不变形， html 代码如下：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">svg</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>circle-svg<span class="pl-pds">"</span></span> [<span class="pl-e">ngClass</span>]=<span class="pl-s"><span class="pl-pds">"</span>buyCircleClass<span class="pl-pds">"</span></span> <span class="pl-e">viewBox</span>=<span class="pl-s"><span class="pl-pds">"</span>0,0,200,200<span class="pl-pds">"</span></span>&gt;
  &lt;<span class="pl-ent">path</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>svg-path<span class="pl-pds">"</span></span> <span class="pl-e">d</span>=<span class="pl-s"><span class="pl-pds">'</span>M 186 146 A 96 96 0 1 0 14 146<span class="pl-pds">'</span></span> <span class="pl-e">fill</span>=<span class="pl-s"><span class="pl-pds">'</span>none<span class="pl-pds">'</span></span> <span class="pl-e">stroke-width</span>=<span class="pl-s"><span class="pl-pds">'</span>8<span class="pl-pds">'</span></span> <span class="pl-e">stroke-linecap</span>=<span class="pl-s"><span class="pl-pds">'</span>round<span class="pl-pds">'</span></span>/&gt;
&lt;/<span class="pl-ent">svg</span>&gt;</pre></div>
<p>此处使用 <code>viewBox</code> 来控制绘制区域的大小， path 之中的参数数值是根据 <code>viewBox</code> 来计算的。 <code>.circle-svg</code> 的样式控制了此处 svg 元素的宽度与高度，而 <code>viewBox</code> 控制了绘制内容的相对大小。</p>
<p>此外，这里还使用了 <code>[ngClass]</code> 指令来调整样式、控制 svg 路径的颜色。 <code>buyCircleClass</code> 是一个 js 对象，可能的值有：</p>
<ul>
<li><code>{}</code></li>
<li><code>{rise: true}</code></li>
<li><code>{fall: true}</code></li>
</ul>
<p>这样，根据 <code>buyCircleClass</code> 的值不同，该 svg 元素的 class 就可能是以下三者之一：</p>
<ul>
<li><code>&lt;svg class="circle-svg"&gt;</code></li>
<li><code>&lt;svg class="circle-svg rise"&gt;</code></li>
<li><code>&lt;svg class="circle-svg fall"&gt;</code></li>
</ul>
<blockquote>
<p>此处代码绘制出来的弧线，右侧会有微小部分超出画布区域而被切除（放大查看能看出来），需要修正代码。</p>
</blockquote>
<h1>
<a id="54" class="anchor" href="#54" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxJS</h1>
<h2>
<a id="55" class="anchor" href="#55" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>监听全局属性值的变化</h2>
<p>在 Angular 的 html 模板页中，绑定过的内容（如 <code>&lt;img src="{{site.titleImg}}" class="main-img" /&gt;</code> ）能直接响应数据（类属性）的变化，实现显示内容的实时更新。而在 js 代码中， AngularJS 1.x 版本提供了 <code>watch()</code> 方法来监听属性值的变化。</p>
<p>但是 Angular 2+ 删除了 <code>watch()</code> 方法，现在监听类属性值的变化需要通过 Rxjs 来进行。</p>
<p>以 <code>/src/providers/login-service.ts</code> 为例：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">private</span> <span class="pl-smi">_status</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BehaviorSubject</span>&lt;<span class="pl-c1">boolean</span>&gt;(<span class="pl-c1">undefined</span>);
<span class="pl-smi">status$</span>: <span class="pl-smi">Observable</span><span class="pl-k">&lt;</span><span class="pl-smi">boolean</span><span class="pl-k">&gt;</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">_status</span>
      .<span class="pl-en">asObservable</span>()
      .<span class="pl-en">filter</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-k">typeof</span> <span class="pl-smi">value</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>boolean<span class="pl-pds">'</span></span>)
      .<span class="pl-en">distinctUntilChanged</span>();

<span class="pl-smi">public</span> <span class="pl-smi">get</span> <span class="pl-en">status</span>():<span class="pl-smi">boolean</span> {
  <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">_status</span>.<span class="pl-en">getValue</span>();
}</pre></div>
<p>这里首先将 <code>_status</code> 创建为一个私有属性，然后通过 <code>public get status()</code> 访问器方法返回 <code>_status</code> 对应的值。</p>
<blockquote>
<p><code>status</code> 访问器属性实际上在外部并没有被使用，因此可以删除。</p>
</blockquote>
<p>同时定义了一个 public 的可观察对象（ Observable ） <code>status$</code> （可观察对象的变量、属性名称使用 <code>$</code> 作为结尾，是 Rxjs 的约定）。</p>
<p>这样在其他页面就可以订阅这个可观察对象。例如在 <code>/src/app/app.component.ts</code> 中：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c1">this</span>.<span class="pl-smi">loginService</span>.<span class="pl-smi">status$</span>
  <span class="pl-c"><span class="pl-c">//</span> 订阅 status$ 对象，在登录状态变化时，更改 app 的根页面</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">status</span> <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>login status changed: <span class="pl-pds">'</span></span>, <span class="pl-smi">status</span>);
    <span class="pl-c"><span class="pl-c">//</span> 其他代码</span>
  )</pre></div>
<p>在登录状态变化时， APP 的根模块就可以监听到这个变化，从而将当前显示页面在登录页与主界面之间进行切换。</p>
<p>使用 Rxjs 的优点是：</p>
<ul>
<li>所发布的可观察对象可以被外部任意代码订阅，实现了异步处理，后续处理函数只有在值发生变化时才会被触发。</li>
<li>对比作用相似的 Promise 来说， Promise 的状态只能从挂起态向决议态或拒绝态转变，一旦发生了转变，状态就被固化了，这样无法响应到对应变量/属性值的多次改变。 Rxjs 就没有这个问题，处理函数可以被多次触发。</li>
</ul>
<p>对于前面创建的 <code>_status</code> 这个 BehaviorSubject 来说，获取它的值使用 <code>getValue()</code> 方法，而改变它的值则需要使用 <code>next()</code> 方法，例如 <code>this._status.next(true);</code> 。</p>
<p>另外需要注意一点，这里的 <code>status$</code> 是一个可观察对象，对于可观察对象可以使用任意多个 <code>subscribe()</code> 方法进行订阅。但是多个订阅者会导致目标可观察对象的数据流程流动多次，这样可能会造成额外的性能损耗。如果某个可观察对象可能被订阅多次，并且其过程比较消耗资源，就需要考虑使用主题（ Subject ）作为中介，或使用多播（ multicast ）。</p>
<h3>
<a id="56" class="anchor" href="#56" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>distinctUntilChanged</h3>
<p>在 RxJS 的数据流动时，一般会使用 <code>distinctUntilChanged()</code> 来保证数据只有在真正变化时才会向下传递。不过无参数的 <code>distinctUntilChanged()</code> 只会进行最基本的比较，如果数据是复杂类型的（对象及其各种子类型，例如数组等），则不会进行深比较。</p>
<p>在某些情况下我们可能需要给 <code>distinctUntilChanged()</code> 传递一个回调函数，以实现自定义的深比较。可参考 <code>/src/pages/quotations/quotations.ts</code> ：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">Observable</span>
  .<span class="pl-en">combineLatest</span>(
    <span class="pl-c1">this</span>.<span class="pl-smi">activeIndex</span>,
    <span class="pl-c1">this</span>.<span class="pl-smi">stockDataService</span>.<span class="pl-smi">sectorData$</span>,
  )
  .<span class="pl-en">distinctUntilChanged</span>(([<span class="pl-v">oldIndex</span>, <span class="pl-v">oldSectorData</span>], [<span class="pl-v">newIndex</span>, <span class="pl-v">newSectorData</span>]) <span class="pl-k">=&gt;</span> {
    <span class="pl-c"><span class="pl-c">//</span> distinctUntilChanged() 的比较是浅比较。</span>
    <span class="pl-c"><span class="pl-c">//</span> 此处自定义 distinctUntilChanged 的回调函数来实现深比较（有限深度），</span>
    <span class="pl-c"><span class="pl-c">//</span> 对于 stockCodeList ，需要逐个比较其元素。</span>
    <span class="pl-c"><span class="pl-c">//</span> 返回值为 true ，表示数据未变化；返回 false 表示已变化。</span>
    <span class="pl-k">if</span> (<span class="pl-smi">oldIndex</span> <span class="pl-k">!==</span> <span class="pl-smi">newIndex</span>) {
      <span class="pl-k">return</span> <span class="pl-c1">false</span>;
    } <span class="pl-k">else</span> <span class="pl-k">if</span> (<span class="pl-smi">oldSectorData</span> <span class="pl-k">===</span> <span class="pl-smi">newSectorData</span>) {
      <span class="pl-k">return</span> <span class="pl-c1">true</span>;
    } <span class="pl-k">else</span> {
      <span class="pl-k">const</span> sectorType <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">activeSectorType</span>;
      <span class="pl-k">const</span> oldStockList <span class="pl-k">=</span> <span class="pl-smi">oldSectorData</span>[<span class="pl-smi">sectorType</span>].<span class="pl-smi">stockCodeList</span>;
      <span class="pl-k">const</span> newStockList <span class="pl-k">=</span> <span class="pl-smi">newSectorData</span>[<span class="pl-smi">sectorType</span>].<span class="pl-smi">stockCodeList</span>;
      <span class="pl-k">if</span> (<span class="pl-smi">oldStockList</span> <span class="pl-k">===</span> <span class="pl-c1">null</span> <span class="pl-k">||</span> <span class="pl-smi">newStockList</span> <span class="pl-k">===</span> <span class="pl-c1">null</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">oldStockList</span> <span class="pl-k">===</span> <span class="pl-smi">newStockList</span>;
      }
      <span class="pl-k">return</span> <span class="pl-smi">oldStockList</span>.<span class="pl-c1">length</span> <span class="pl-k">===</span> <span class="pl-smi">newStockList</span>.<span class="pl-c1">length</span> <span class="pl-k">&amp;&amp;</span>
        <span class="pl-smi">oldStockList</span>.<span class="pl-en">every</span>((<span class="pl-v">stockCode</span>, <span class="pl-v">index</span>) <span class="pl-k">=&gt;</span> <span class="pl-smi">newStockList</span>[<span class="pl-smi">index</span>] <span class="pl-k">===</span> <span class="pl-smi">stockCode</span>);
    }
  })</pre></div>
<p>此处传递的数据是使用两个数据流合并出来的，并且第二个数据分量是一个数组，因此有必要使用自定义的比较函数作为 <code>distinctUntilChanged()</code> 的回调函数。</p>
<p><strong>但实际上，此处涉及到的数据层次还比较浅，层次深度进一步增加后就需要使用递归比较，代码逻辑会变得复杂。如果可能的话，建议使用 immutable.js 来解决这方面的需求。</strong></p>
<h2>
<a id="57" class="anchor" href="#57" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用 Observable 管理数据</h2>
<p>Angular 一般将整个 APP 所用的数据放置在全局服务的类中，通常做法是直接使用普通对象来存储数据。但也可以使用 Observable 来存储数据，优点之一是可以在数据上进行订阅，将数据的修改设置与相关的后续处理逻辑分离；之二是可以使用 Observable 的 <code>map()</code> （或 <code>select()</code> ）操作将数据分离，每个页面上只要获取与自身有关的部分即可。</p>
<p>可以参考实时数据的使用。首先是 <code>/src/providers/stock-data-service.ts</code> ：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">private</span> <span class="pl-smi">_stockRealtimeData</span>: <span class="pl-smi">BehaviorSubject</span><span class="pl-k">&lt;</span><span class="pl-smi">AnyObject</span><span class="pl-k">&gt;</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BehaviorSubject</span>({});

<span class="pl-smi">public</span> <span class="pl-smi">stockRealtimeData$</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">_stockRealtimeData</span>.<span class="pl-en">asObservable</span>();</pre></div>
<p>而在 <code>/src/pages/stock-detail/stock-detail.ts</code> 页面中：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c1">this</span>.<span class="pl-smi">_realtimeData$</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">stockDataService</span>.<span class="pl-smi">stockRealtimeData$</span>.<span class="pl-en">map</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">data</span>[<span class="pl-smi">stockCode</span>]);</pre></div>
<p>在使用 <code>next()</code> 方法为 Observable 对象赋值时，目前代码基本上都使用了不修改原有数据的方式，使用数组扩展运算符或对象扩展运算符，例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c1">this</span>.<span class="pl-smi">_stockRealtimeData</span>.<span class="pl-en">next</span>({
  <span class="pl-k">...</span><span class="pl-smi">this</span>.<span class="pl-smi">_stockRealtimeData</span>.<span class="pl-en">getValue</span>(),
  [<span class="pl-smi">code</span>]: <span class="pl-smi">resultArray</span>,
});</pre></div>
<p>这样做并不是强制要求的，但从函数式编程的角度考虑，也为了今后更好地管理数据，因此使用了这种方式。<strong>目前在 <code>stock-data-service.ts</code> 中，是将 <code>_stockBaseData</code> 、 <code>_stockRealtimeData</code> 、 <code>_stockKData</code> 作为分离的 Observable 对象，也可以考虑将它们合并成一个大对象。但是如果进行合并后依然保持使用扩展运算符的方式，相关的赋值操作就会变得很繁琐，因为层次变深了。这种情况下可以考虑引入 immutable.js 。</strong></p>
<h3>
<a id="58" class="anchor" href="#58" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>async 管道</h3>
<p>async 管道可用于处理 Promise 或 Observable 数据。对于 Observable 来说，页面模板中的 async 管道会自动对目标 Observable 对象进行订阅，并且会在页面被销毁时自动取消订阅，这样用户就不需要自己来实现这部分功能，简化了代码编写，并且也不必手动进行资源回收。</p>
<p>在 <code>/src/pages/stock-detail/stock-detail.ts</code> 页面中对 <code>_realtimeData$</code> 进行 <code>map()</code> 之后，在模板页上可以用 async 管道来使用这个异步数据：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">realtime-charts-component</span>
  [<span class="pl-e">echartsData</span>]=<span class="pl-s"><span class="pl-pds">"</span>_realtimeData$ | async<span class="pl-pds">"</span></span>
  [<span class="pl-e">baseData</span>]=<span class="pl-s"><span class="pl-pds">"</span>_baseData$ | async<span class="pl-pds">"</span></span>
&gt;</pre></div>
<h2>
<a id="59" class="anchor" href="#59" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxJS 的多播处理</h2>
<h3>
<a id="60" class="anchor" href="#60" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Subject</h3>
<p>首先讨论一下多个订阅的问题。前面提到过，在一个 Observable 对象上使用多个 <code>subscribe()</code> 进行订阅，将会导致数据流的流动过程重复多次。例如；</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">const</span> source$ <span class="pl-k">=</span> <span class="pl-smi">Observable</span>.<span class="pl-en">of</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>)
  .<span class="pl-en">do</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> {<span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">value</span>)})

<span class="pl-smi">source$</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>result 1: <span class="pl-pds">'</span></span>, <span class="pl-smi">value</span> <span class="pl-k">*</span> <span class="pl-c1">3</span>))

<span class="pl-smi">source$</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>result 2: <span class="pl-pds">'</span></span>, <span class="pl-smi">value</span> <span class="pl-k">+</span> <span class="pl-c1">5</span>))

<span class="pl-smi">source$</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>result 3: <span class="pl-pds">'</span></span>, <span class="pl-smi">value</span> <span class="pl-k">-</span> <span class="pl-c1">3</span>))</pre></div>
<p>输出结果为：</p>
<blockquote>
<pre>1
result 1:  3
2
result 1:  6
3
result 1:  9
1
result 2:  6
2
result 2:  7
3
result 2:  8
1
result 3:  -2
2
result 3:  -1
3
result 3:  0</pre>
</blockquote>
<p>可以看到数据源（ 1、2、3 ）流动了 3 次。</p>
<p>如果数据源是不太消耗资源的操作，这样可能对性能的影响不大。但如果数据源是 http 请求，则直接使用 Observable 进行多个订阅，则会导致 http 被请求多次，即使编程意图是同一时刻请求同一数据并进行多个不同的后续处理。而在使用 socket.io 的场合中（后面会提到），问题就会更严重，<strong>因为 socket.io 获取的数据是服务端推送过来的，客户端被动获取数据。此时若直接使用 Observable 进行多个订阅，就会导致只有第一个订阅者能够接收到数据，而其他订阅者都会空等待</strong>。</p>
<p>这种情况可以用 Subject 来解决，多个订阅者订阅 Subject 的实例，而 Subject 的实例再去订阅原有的 Observable 对象。例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">const</span> source$ <span class="pl-k">=</span> <span class="pl-smi">Observable</span>.<span class="pl-en">of</span>(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>,<span class="pl-c1">3</span>)
  .<span class="pl-en">do</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> {<span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">value</span>)})

<span class="pl-k">const</span> subject <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Subject</span>()

<span class="pl-smi">subject</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>result 1: <span class="pl-pds">'</span></span>, <span class="pl-smi">value</span> <span class="pl-k">*</span> <span class="pl-c1">3</span>))

<span class="pl-smi">subject</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>result 2: <span class="pl-pds">'</span></span>, <span class="pl-smi">value</span> <span class="pl-k">+</span> <span class="pl-c1">5</span>))

<span class="pl-smi">subject</span>
  .<span class="pl-en">subscribe</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>result 3: <span class="pl-pds">'</span></span>, <span class="pl-smi">value</span> <span class="pl-k">-</span> <span class="pl-c1">3</span>))

<span class="pl-smi">source$</span>.<span class="pl-en">subscribe</span>(<span class="pl-smi">subject</span>)</pre></div>
<blockquote>
<p>注意：此处的 <code>Observable.of(1,2,3)</code> 会在订阅者出现后立刻输出数据，因此需要先在 <code>subject</code> 上绑定订阅者，再用 <code>subject</code> 去订阅 <code>source$</code> 。但若数据源是异步的，则这个订阅顺序可以自由调整。</p>
<p>在 <code>Observable.of(1,2,3)</code> 之后添加 <code>.observeOn(Rx.Scheduler.async)</code> 调度操作，可以将其转换为异步方式。</p>
<p>或者使用 <code>ReplaySubject</code> 来代替 <code>Subject</code> ，让数据流可以被重现。</p>
</blockquote>
<p>这一次输出的结果为：</p>
<blockquote>
<pre>1
result 1:  3
result 2:  6
result 3:  -2
2
result 1:  6
result 2:  7
result 3:  -1
3
result 1:  9
result 2:  8
result 3:  0</pre>
</blockquote>
<p>可以明显看到，数据源的数据只流动了一次。</p>
<h3>
<a id="61" class="anchor" href="#61" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>multicast 与 RefCount 处理多播</h3>
<p>在 socket.io 的问题上，虽然使用 Subject 也是一种方法，但在高交所 APP 的实际代码中并没有使用 Subject ，因为我们还有更进一步的需求：</p>
<p>实时数据可能在多处被使用，包括股票的列表页、实时数据图表所在页面、账户当日盈亏计算等。对同一个股票的实时数据的订阅，希望所有订阅都共享同一个数据源。但同时我们还希望若所有订阅都消失时（例如切换到新闻公告页面，不显示任何股票的实时数据），上游的数据源能够自动取消订阅，即要求此时 socket.io 能够向服务器端发出 unsubscribe 请求。</p>
<p>这方面的需求可以通过 multicast 与 RefCount 来实现。代码参考 <code>/src/providers/stock-data-service.ts</code> （此处为代码片段，删除了一部分无关的）：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">subscibeRealtimeData</span>(
  <span class="pl-smi">code</span>: <span class="pl-smi">string</span>,
  <span class="pl-smi">eventName</span>: <span class="pl-smi">string</span>,
): <span class="pl-smi">Observable</span><span class="pl-k">&lt;</span><span class="pl-smi">any</span><span class="pl-k">&gt;</span> {
  <span class="pl-k">const</span> observableMap <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">_stockObservableMap</span>.<span class="pl-c1">get</span>(<span class="pl-smi">eventName</span>);
  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">observableMap</span>.<span class="pl-c1">has</span>(<span class="pl-smi">code</span>)){
    <span class="pl-k">let</span> source$<span class="pl-k">:</span> <span class="pl-en">Observable</span>&lt;<span class="pl-c1">any</span>&gt;;
    <span class="pl-smi">source$</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">socketioService</span>.<span class="pl-en">subscribeEquity</span>(<span class="pl-smi">code</span>, <span class="pl-smi">eventName</span>);

    <span class="pl-k">const</span> equity$ <span class="pl-k">=</span> <span class="pl-smi">source$</span>
      .<span class="pl-en">do</span>(<span class="pl-v">result</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-c"><span class="pl-c">//</span> 获取实时数据之后的处理……</span>

      });

    <span class="pl-k">const</span> subject <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Subject</span>();
    <span class="pl-k">const</span> refCounted <span class="pl-k">=</span> <span class="pl-smi">equity$</span>.<span class="pl-en">multicast</span>(<span class="pl-smi">subject</span>).<span class="pl-en">refCount</span>();
    <span class="pl-smi">observableMap</span>.<span class="pl-c1">set</span>(<span class="pl-smi">code</span>, { <span class="pl-smi">refCounted</span>, <span class="pl-smi">subject</span> });
  }

  <span class="pl-k">return</span> <span class="pl-smi">observableMap</span>.<span class="pl-c1">get</span>(<span class="pl-smi">code</span>).<span class="pl-smi">refCounted</span>;
}</pre></div>
<p>此处的代码逻辑大致为：</p>
<ol>
<li>在接收到订阅实时数据的请求时，先查看当前是否已存在匹配的 Observable （存储在当前类的 <code>_stockObservableMap</code> 属性中）。</li>
<li>若不存在匹配的值，则创建一个新的 Observable 。</li>
<li>将新的 Observable 多播（ <code>multicast</code> ）到一个 Subject 上。</li>
<li>对于前面产生的多播，返回其计数引用（ <code>refCount()</code> ）。</li>
<li>将新的 Subject 与 refCount 储存到 <code>_stockObservableMap</code> 属性中。</li>
<li>最后返回 <code>_stockObservableMap</code> 上对应的 refCount （之前已存在的，或是刚刚创建的）。</li>
</ol>
<p>对于 <code>subscibeRealtimeData()</code> 方法的调用方来说，会获得一个由 refCount 产生的 Observable ，对此 Observable 进行订阅即可。而在所有对于该 refCount Observable 的订阅都被取消之后，数据源的 Observable （即上面代码中的 <code>source$</code> ）的取消订阅操作就会被触发（可参考 <code>/src/providers/socketio-service.ts</code> 的 <code>subscribeEquity()</code> 方法 ）。</p>
<p>此处需要注意：作为 <code>multicast()</code> 参数的 Subject 并非必须使用变量保存，在某些场合下可以直接简写为：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">const</span> refCounted <span class="pl-k">=</span> <span class="pl-smi">equity$</span>.<span class="pl-en">multicast</span>(<span class="pl-k">new</span> <span class="pl-en">Subject</span>()).<span class="pl-en">refCount</span>();</pre></div>
<p>此处将 Subject 实例存储下来是因为有其他的需求：希望对于激活状态中的实时数据订阅，定时获取当天完整的实时数据，以便能够补齐可能遗漏的数据。参考以下代码：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">observableMap</span>.<span class="pl-c1">forEach</span>(({ <span class="pl-v">subject</span> }, <span class="pl-v">code</span><span class="pl-k">:</span> <span class="pl-c1">string</span>) <span class="pl-k">=&gt;</span> {
  <span class="pl-c"><span class="pl-c">//</span> 如果对应的 Subject 有订阅者，则 observers.length 属性值就不为 0 ，</span>
  <span class="pl-c"><span class="pl-c">//</span> 表示当前股票存在对于实时数据的订阅，需要每分钟刷新一次当天的完整分钟数据。</span>
  <span class="pl-c"><span class="pl-c">//</span> 无论是否在开盘时间段内，都执行此操作，可能会造成流量浪费，后期可考虑加以改进。</span>
  <span class="pl-k">if</span> (<span class="pl-smi">subject</span>.<span class="pl-smi">observers</span>.<span class="pl-c1">length</span>) {
    <span class="pl-c1">this</span>.<span class="pl-en">requestRealtimeStartData</span>(<span class="pl-smi">code</span>)
  }
});</pre></div>
<p>保留 Subject 的实例，是因为通过检查其 <code>observers.length</code> 属性值，就能知道目标 Subject 上有多少个激活的订阅者。</p>
<p>定时请求完整实时数据的代码今后可以考虑根据实际情况加以改进，参考后面“遗留问题”的部分。</p>
<h2>
<a id="62" class="anchor" href="#62" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>可撤销的 http 请求</h2>
<p>目前高交所的 APP 中， http 请求基本上都是转换为 Promise 来使用的。例外的是请求当天完整实时数据的操作：之前测试服务器返回的数据量太大，并且由于服务端带宽限制，请求时间也很长。在这种条件下，可能会堆积多个长时间未完成的 http 请求，在频繁切换页面时尤其如此。因此后来在此功能上放弃了 Promise 的方式，而是直接使用 Observable ，以便能利用其可撤销的特性。参见 <code>/src/providers/http-service.ts</code> ：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">getObservableWithToken</span>(<span class="pl-smi">url</span>, <span class="pl-smi">options</span>: <span class="pl-smi">RequestOptionsArgs</span> <span class="pl-k">=</span> {}, <span class="pl-smi">cancel$</span><span class="pl-k">?:</span> <span class="pl-smi">Observable</span><span class="pl-k">&lt;</span><span class="pl-smi">any</span><span class="pl-k">&gt;</span>): <span class="pl-smi">Observable</span><span class="pl-k">&lt;</span><span class="pl-smi">any</span><span class="pl-k">&gt;</span> {
  <span class="pl-k">const</span> token <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">appDataService</span>.<span class="pl-smi">token</span>
  <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">token</span>){
    <span class="pl-k">return</span> <span class="pl-smi">Observable</span>.<span class="pl-en">throw</span>(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>token missing!<span class="pl-pds">'</span></span>))
  }

  <span class="pl-k">const</span> headers <span class="pl-k">=</span> <span class="pl-smi">options</span>.<span class="pl-c1">headers</span> <span class="pl-k">||</span> <span class="pl-k">new</span> <span class="pl-en">Headers</span>()
  <span class="pl-smi">headers</span>.<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>X-AUTH-TOKEN<span class="pl-pds">'</span></span>, <span class="pl-smi">token</span>)

  <span class="pl-k">let</span> http$ <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">http</span>
    .<span class="pl-c1">get</span>(<span class="pl-smi">url</span>, {
      <span class="pl-k">...</span><span class="pl-smi">options</span>,
      <span class="pl-smi">headers</span>,
    })

  <span class="pl-k">if</span> (<span class="pl-smi">cancel$</span>) {
    <span class="pl-smi">http$</span> <span class="pl-k">=</span> <span class="pl-smi">http$</span>.<span class="pl-en">takeUntil</span>(<span class="pl-smi">cancel$</span>)
  }

  <span class="pl-k">return</span> <span class="pl-smi">http$</span>
    .<span class="pl-en">map</span>(<span class="pl-v">res</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">res</span>.<span class="pl-en">json</span>())
    .<span class="pl-en">switchMap</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> {
      <span class="pl-c"><span class="pl-c">//</span> 使用 switchMap 来包含 Observable.throw()</span>
      <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">data</span>){
        <span class="pl-k">return</span> <span class="pl-smi">Observable</span>.<span class="pl-en">throw</span>(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>data missing<span class="pl-pds">'</span></span>));
      }

      <span class="pl-k">const</span> err <span class="pl-k">=</span> <span class="pl-smi">data</span>.<span class="pl-smi">err</span> <span class="pl-k">||</span> <span class="pl-smi">data</span>.<span class="pl-smi">error</span>
      <span class="pl-k">if</span> (<span class="pl-smi">err</span>) {
        <span class="pl-k">return</span> <span class="pl-smi">Observable</span>.<span class="pl-en">throw</span>(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-smi">err</span>.<span class="pl-smi">message</span> <span class="pl-k">||</span> <span class="pl-smi">err</span>));
      }

      <span class="pl-c"><span class="pl-c">//</span> switchMap 的正常返回值需要使用 Observable.of()</span>
      <span class="pl-k">return</span> <span class="pl-smi">Observable</span>.<span class="pl-en">of</span>(<span class="pl-smi">data</span>);
    })
}</pre></div>
<p>此方法有一个可选参数 <code>cancel$</code> ，若其值不为空，则在进行 http 请求时，会附加一个 <code>takeUntil()</code> 操作。对于 <code>cancel$</code> 这个 Observable 来说，只要有数据输出，无论输出的数据是什么，就会触发 <code>takeUntil()</code> 的处理，将前面的 http 请求取消掉。</p>
<p>使用 <code>takeUntil()</code> 时需要注意，因为只要有数据输出就会触发取消操作，因此对于 <code>takeUntil()</code> 参数内的 Observable 来说，有必要使用 <code>filter()</code> 来保证只在满足预设条件时才有数据输出。</p>
<blockquote>
<p>类似的操作还有 <code>takeWhile()</code> ，作用相反。</p>
</blockquote>
<h2>
<a id="63" class="anchor" href="#63" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>socket.io 与 RxJS 的配合</h2>
<p>相关的代码集中在 <code>/src/providers/socketio-service.ts</code> 中。尤其是 <code>subscribeEquity()</code> 方法：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">private</span> <span class="pl-smi">eventSubscriberMap</span>: <span class="pl-c1">Map</span><span class="pl-k">&lt;</span><span class="pl-smi">string</span>, <span class="pl-c1">Map</span><span class="pl-k">&lt;</span><span class="pl-smi">Subscriber</span><span class="pl-k">&lt;</span><span class="pl-smi">any</span><span class="pl-k">&gt;</span>, <span class="pl-smi">string</span><span class="pl-k">&gt;&gt;</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Map</span>();

<span class="pl-smi">private</span> <span class="pl-en">onData</span>(<span class="pl-smi">eventName</span>, <span class="pl-smi">data</span>) {
  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">eventSubscriberMap</span>.<span class="pl-c1">has</span>(<span class="pl-smi">eventName</span>)){
    <span class="pl-c1">this</span>.<span class="pl-smi">eventSubscriberMap</span>.<span class="pl-c1">get</span>(<span class="pl-smi">eventName</span>).<span class="pl-c1">forEach</span>((<span class="pl-v">code</span>, <span class="pl-v">subscriber</span>) <span class="pl-k">=&gt;</span> {
      <span class="pl-k">if</span> (<span class="pl-smi">data</span>.<span class="pl-smi">ec</span> <span class="pl-k">===</span> <span class="pl-smi">code</span> <span class="pl-k">||</span> <span class="pl-smi">data</span>.<span class="pl-smi">n</span> <span class="pl-k">===</span> <span class="pl-smi">code</span>){
        <span class="pl-smi">subscriber</span>.<span class="pl-en">next</span>(<span class="pl-smi">data</span>);
      }
    });
  }
}

<span class="pl-en">subscribeEquity</span>(<span class="pl-smi">equityCodeWithSuffix</span>: <span class="pl-smi">string</span>, <span class="pl-smi">eventName</span>: <span class="pl-smi">string</span>): <span class="pl-smi">Observable</span><span class="pl-k">&lt;</span><span class="pl-smi">any</span><span class="pl-k">&gt;</span> {
  <span class="pl-k">const</span> equityCode <span class="pl-k">=</span><span class="pl-sr"> <span class="pl-pds">/</span><span class="pl-k">^</span>(<span class="pl-c1">[<span class="pl-k">^</span>-]</span><span class="pl-k">+</span>)<span class="pl-pds">/</span></span>.<span class="pl-c1">exec</span>(<span class="pl-smi">equityCodeWithSuffix</span>)[<span class="pl-c1">1</span>];

  <span class="pl-k">const</span> observable <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Observable</span>(<span class="pl-v">observer</span> <span class="pl-k">=&gt;</span> {
    <span class="pl-c"><span class="pl-c">//</span> 对于所有订阅都已取消的 refCount 重新进行订阅时，</span>
    <span class="pl-c"><span class="pl-c">//</span> 这个函数会被重新调用一次，并传入新的 observer 。</span>
    <span class="pl-c"><span class="pl-c">//</span> 因此需要将新的 observer 加到 Map 中，</span>
    <span class="pl-c"><span class="pl-c">//</span> 以便可以在 socketio 的 on 事件中使用正确的 observer(subscriber) 去派发数据。</span>
    <span class="pl-c1">this</span>.<span class="pl-en">socketReady</span>()
      .<span class="pl-en">then</span>(() <span class="pl-k">=&gt;</span> {
        <span class="pl-c1">this</span>.<span class="pl-en">addSubscriberToMap</span>(<span class="pl-smi">eventName</span>, <span class="pl-smi">equityCode</span>, <span class="pl-smi">observer</span>);

        <span class="pl-k">const</span> subscribeData <span class="pl-k">=</span> {
          channel: <span class="pl-smi">equityCodeWithSuffix</span>,
          from: <span class="pl-s"><span class="pl-pds">'</span>wzx<span class="pl-pds">'</span></span>,
          date: <span class="pl-k">new</span> <span class="pl-en">Date</span>(),
        };
        <span class="pl-c1">this</span>.<span class="pl-smi">_socketioSubscribeList</span>.<span class="pl-c1">push</span>(<span class="pl-smi">subscribeData</span>);
        <span class="pl-c1">this</span>.<span class="pl-smi">socket</span>.<span class="pl-en">emit</span>(<span class="pl-s"><span class="pl-pds">'</span>subscribe<span class="pl-pds">'</span></span>, <span class="pl-smi">subscribeData</span>);
      })
      .<span class="pl-en">catch</span>(<span class="pl-v">err</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>)
      });

    <span class="pl-c"><span class="pl-c">//</span> 在 multicast refCount 上的所有订阅都取消时，</span>
    <span class="pl-c"><span class="pl-c">//</span> 会调用此方法取消 observer 的订阅。</span>
    <span class="pl-k">return</span> () <span class="pl-k">=&gt;</span> {
      <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>socketio unsubscribe: <span class="pl-pds">'</span></span>, <span class="pl-smi">equityCodeWithSuffix</span>);
      <span class="pl-c1">this</span>.<span class="pl-en">removeSubscriberFromMap</span>(<span class="pl-smi">eventName</span>, <span class="pl-smi">observer</span>);

      <span class="pl-k">const</span> subscribeData <span class="pl-k">=</span> {
        channel: <span class="pl-smi">equityCodeWithSuffix</span>,
        from: <span class="pl-s"><span class="pl-pds">'</span>wzx<span class="pl-pds">'</span></span>,
        date: <span class="pl-k">new</span> <span class="pl-en">Date</span>(),
      };
      <span class="pl-c1">this</span>.<span class="pl-en">removeFromSocketioSubscribeList</span>(<span class="pl-smi">subscribeData</span>);
      <span class="pl-c1">this</span>.<span class="pl-smi">socket</span>.<span class="pl-en">emit</span>(<span class="pl-s"><span class="pl-pds">'</span>unsubscribe<span class="pl-pds">'</span></span>, <span class="pl-smi">subscribeData</span>);
    }
  });

  <span class="pl-k">return</span> <span class="pl-smi">observable</span>;
}</pre></div>
<p><code>eventSubscriberMap</code> 属性储存了已存在的订阅（ Subscriber ），以便在 socket.io 断线重连时可以重新发起对于 socket.io 的订阅；此外在注销登录或登录过期失效时，需要将这些订阅全部取消。</p>
<p>此代码中的 <code>socketReady()</code> 会返回一个 Promise ，在 socket.io 连接成功并且验证通过之后，才会触发后续的订阅操作。</p>
<p>关于订阅与取消订阅，需要注意的有：</p>
<ol>
<li>此处返回的 Observable ，使用了最基础的 <code>new Observable()</code> 构造函数的方式，以便可以自由定义订阅与取消订阅操作。</li>
<li>这个 Observable 作为返回值，会被外部代码使用 multicast 与 refCount 进行订阅（参阅前面<strong>多播</strong>部分的说明）。当 refCount 上所有订阅都被取消之后， <code>new Observable()</code> 内部回调函数的返回值（也就是 <code>return () =&gt; {</code> 以下的部分）就会被调用，执行自定义的取消订阅操作，此处是向 socket.io 发射（ emit ）出一个 unsubscribe 请求。同时还会将 eventSubscriberMap 中对应的 Subscriber （ observer ）移除掉，避免内存泄漏。</li>
<li>在取消订阅操作被调用之后，如果有新的订阅产生，则 <code>new Observable()</code> 内部回调函数会被重新调用一次，并且所产生的 observer 也是一个新的 Subscriber ，与之前产生的是不同实例。因此，不能直接复用 eventSubscriberMap 已有的 Subscriber ，之前取消订阅时需要有清理操作，而再次订阅时要将新的 observer 添加到 eventSubscriberMap 中。</li>
</ol>
<p><code>onData()</code> 方法在获得 socket.io 返回的数据时，使用笨拙的遍历数组的方式来判断需要向哪个 Subscriber 发送数据。因为整个 APP 使用的是同一个 socket.io 连接，在这个连接上可能会返回各个不同的股票的实时数据，因此这个遍历处理是必要的，但效率也比较低下。今后可以考虑加以改进。</p>
<h2>
<a id="64" class="anchor" href="#64" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxJS 的取消订阅</h2>
<p>对一个 Observable 进行订阅（ <code>subscribe()</code> ）之后，获得的返回值是一个 Subscriber ，调用它的 <code>unsubscribe()</code> 方法即可取消订阅。</p>
<p>因此对于取消订阅操作来说，最普通的做法是在订阅之后将获得的 Subscriber 保存下来，在需要取消订阅时使用它。</p>
<p>但是这样也会带来问题：用户需要自行储存订阅后获得的 Subscriber ，自行执行取消订阅操作，并且为了避免内存泄漏，需要在取消订阅之后自行从变量或对象属性中清理对应的 Subscriber 。</p>
<p>RxJS 推荐的一种实践则是不要自行管理 Subscriber 。如果在一个对象的方法中执行了订阅操作，只要不将返回值（ Subscriber ）存储起来，则在当前对象完成生命周期被销毁时，之前的订阅一般也会被自动销毁，触发取消订阅操作，无需手动管理。但这种方式需要注意不同对象之间是否有相互调用、导致对象实例不能被完全销毁的情况。</p>
<p>在 Ionic 中则存在另一种情况：有些类/对象的实例在整个 APP 的生命周期内几乎是永远不会被自动销毁的，例如 Tabs 的一级页面、全局服务等。在对象实例不会被自动销毁的情况下，就需要使用其他的机制来处理 Observable 的取消订阅问题。</p>
<p>对于一次性的 Observable 来说，可以使用 <code>first()</code> 操作来保证它的数据流只会流动一次。还有其他一些操作可以完成类似的需求。</p>
<p>此外，还可以使用前面提到过的 <code>takeUntil()</code> 来实现自动取消订阅的需求。</p>
<blockquote>
<p>在高交所 APP 中期的代码中，存在大量的 <code>unsubscribe()</code> 操作。而后期大部分 <code>unsubscribe()</code> 都已经被删除，仅保留了少数确实有特殊需求的。</p>
</blockquote>
<h3>
<a id="65" class="anchor" href="#65" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>离开页面时取消订阅</h3>
<p>以 <code>/src/pages/stock-detail/stock-detail.ts</code> 为例，此页面在订阅实时数据时，采用了以下的方式（省略了一些无关代码）：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">private</span> <span class="pl-smi">viewDidLeave</span>: <span class="pl-smi">BehaviorSubject</span><span class="pl-k">&lt;</span><span class="pl-smi">boolean</span><span class="pl-k">&gt;</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BehaviorSubject</span>(<span class="pl-c1">false</span>);
<span class="pl-smi">private</span> <span class="pl-smi">viewDidLeave$</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave</span>
          .<span class="pl-en">asObservable</span>()
          .<span class="pl-en">distinctUntilChanged</span>()
          .<span class="pl-en">filter</span>(<span class="pl-v">value</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">value</span> <span class="pl-k">===</span> <span class="pl-c1">true</span>);

<span class="pl-en">ionViewDidEnter</span>() {
  <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave</span>.<span class="pl-en">next</span>(<span class="pl-c1">false</span>);
  <span class="pl-c1">this</span>.<span class="pl-en">doSubscribe</span>();
}

<span class="pl-en">ionViewDidLeave</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave</span>.<span class="pl-en">next</span>(<span class="pl-c1">true</span>);
}

<span class="pl-en">doSubscribe</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">stockDataService</span>.<span class="pl-en">subscibeRealtimeData</span>(<span class="pl-smi">stockCode</span>, <span class="pl-c1">undefined</span>, <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave$</span>)
    .<span class="pl-en">takeUntil</span>(<span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave$</span>.<span class="pl-en">delay</span>(<span class="pl-c1">this</span>.<span class="pl-smi">appSettings</span>.<span class="pl-c1">UNSUBSCRIBE_INTERVAL</span>))
    <span class="pl-c"><span class="pl-c">//</span> 必须订阅，数据才会流动，即使订阅函数内部没有做任何操作。</span>
    .<span class="pl-en">subscribe</span>();
}</pre></div>
<p>此处定义了一个 <code>viewDidLeave</code> 属性，类型为 <code>BehaviorSubject&lt;boolean&gt;</code> 。在 <code>ionViewDidEnter()</code> 事件中，会将这个值设为 <code>false</code> ；而在 <code>ionViewDidLeave()</code> 实践中，则会将其设为 true 。</p>
<p>订阅实时数据时，使用 <code>.takeUntil(this.viewDidLeave$.delay(this.appSettings.UNSUBSCRIBE_INTERVAL))</code> 来保证在 <code>viewDidLeave$</code> 流有数据（即 <code>viewDidLeave</code> 值为 <code>true</code> ）时，实时数据就会被取消订阅。同时，为了避免切换页面时频繁对实时数据进行订阅/取消订阅，设置了一个 <code>UNSUBSCRIBE_INTERVAL</code> 值（一般为 5e3 ，即 5 秒），并且使用 <code>delay()</code> 操作来保证延时取消订阅。</p>
<blockquote>
<p>切换前后的页面可能使用了同一个股票的实时数据，例如从列表页进入股票详情页，或从股票详情页进入交易界面。在这种情况下，不希望立即触发 Observable 的 unsubscribe ，从而调用 socket.io 的 unsubscribe ；而是希望先触发新进入页面的 Observable 的 subscribe ，同时延时触发原有页面的 Observable 的 unsubscribe 。这样，在短暂的几秒内会同时存在两个 Observable 的 subscribe （新旧页面的 subscribe ），几秒之后原有页面的 unsubscribe 才会被触发，由于使用了 refCount ，此时数据源上还存在一个 subscribe （新页面的）， socket.io 的 unsubscribe 就不会被调用，避免了 socket.io 频繁进行 unsubscribe 与 subscribe 。</p>
</blockquote>
<p>在这种模式下，对于实时数据的取消订阅就不需要手动管理了，不需要使用变量或对象属性来存储 Subscriber 。</p>
<blockquote>
<p>延时取消订阅会带来一个问题：若频繁进出同一个页面，则同一时刻可能会存在多个对于同一股票实时数据的订阅，在一定时间（预设的 5 秒）后，才会逐个取消订阅。但目前来看，这个问题基本没有什么负面影响，因此暂时可以不作处理。</p>
</blockquote>
<h3>
<a id="66" class="anchor" href="#66" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>切换订阅目标</h3>
<p>在持仓页面（ <code>/src/pages/optional/optional.ts</code> ）与行情页面（ <code>/src/pages/quotations/quotations.ts</code> ），情况会更复杂一些。持仓的股票列表可能会实时发生变化（尤其是在刚进入 APP 时，获取个人持仓情况返回数据前后），行情页切换板块分类时所显示的股票列表也会发生变化。</p>
<p>在股票列表变化时，需要对变化前后的股票进行对比，新出现的股票需要为其进行实时数据的订阅，而从列表中被移除的股票则要取消订阅。目前的处理方式是使用一个 <code>lastRealtimeStockList</code> 与一个 <code>realtimeStockList</code> 属性来存储前后的股票代码列表，并且从 <code>realtimeStockList</code> 引出一个 Observable （ <code>/src/pages/quotations/quotations.ts</code> ）：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">private</span> <span class="pl-smi">lastRealtimeStockList</span>: <span class="pl-smi">string</span>[] <span class="pl-k">=</span> [];
<span class="pl-smi">private</span> <span class="pl-smi">realtimeStockList</span>: <span class="pl-smi">BehaviorSubject</span><span class="pl-k">&lt;</span><span class="pl-smi">string</span>[]<span class="pl-k">&gt;</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BehaviorSubject</span>([]);
<span class="pl-smi">private</span> <span class="pl-smi">realtimeStockList$</span> <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">realtimeStockList</span>
        .<span class="pl-en">asObservable</span>()
        .<span class="pl-en">distinctUntilChanged</span>();

<span class="pl-en">ionViewDidLeave</span>(){
    <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave</span>.<span class="pl-en">next</span>(<span class="pl-c1">true</span>);
    <span class="pl-c"><span class="pl-c">//</span> realtimeStockList 的设置要放在 viewDidLeave 的设置之后，</span>
    <span class="pl-c"><span class="pl-c">//</span> 以便先触发 takeUntil() 。</span>
    <span class="pl-c"><span class="pl-c">//</span> 此处将 realtimeStockList 设置为空数组，</span>
    <span class="pl-c"><span class="pl-c">//</span> 会立刻引发退订操作。</span>
    <span class="pl-c"><span class="pl-c">//</span> 可以考虑对此使用延时，但可能需要结合 ionViewWillLeave 的 takeUntil() ，</span>
    <span class="pl-c"><span class="pl-c">//</span> 避免反复切换页面时，订阅被延时的退订冲掉。</span>
    <span class="pl-c1">this</span>.<span class="pl-smi">realtimeStockList</span>.<span class="pl-en">next</span>([]);
}

<span class="pl-en">doSubscribe</span>() {
  <span class="pl-smi">Observable</span>
    .<span class="pl-en">combineLatest</span>(
      <span class="pl-c1">this</span>.<span class="pl-smi">activeIndex</span>,
      <span class="pl-c1">this</span>.<span class="pl-smi">stockDataService</span>.<span class="pl-smi">sectorData$</span>,
    )
    .<span class="pl-en">takeUntil</span>(<span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave$</span>)
    .<span class="pl-en">distinctUntilChanged</span>()
    .<span class="pl-en">subscribe</span>(([, <span class="pl-v">sectorData</span>]) <span class="pl-k">=&gt;</span> {
      <span class="pl-k">const</span> sectorType <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">activeSectorType</span>;
      <span class="pl-k">const</span> { stockCodeList } <span class="pl-k">=</span> <span class="pl-smi">sectorData</span>[<span class="pl-smi">sectorType</span>];
      <span class="pl-k">if</span> (<span class="pl-smi">stockCodeList</span>) {
        <span class="pl-c"><span class="pl-c">//</span> 其他订阅代码……</span>

        <span class="pl-smi">stockCodeList</span>.<span class="pl-c1">forEach</span>(<span class="pl-v">stockCode</span> <span class="pl-k">=&gt;</span> {
          <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">lastRealtimeStockList</span>.<span class="pl-c1">indexOf</span>(<span class="pl-smi">stockCode</span>) <span class="pl-k">!==</span> <span class="pl-k">-</span><span class="pl-c1">1</span>) {
            <span class="pl-k">return</span>;
          }

          <span class="pl-c1">this</span>.<span class="pl-smi">stockDataService</span>.<span class="pl-en">requestStockBaseData</span>(<span class="pl-smi">stockCode</span>)
            .<span class="pl-en">catch</span>(() <span class="pl-k">=&gt;</span> {});

          <span class="pl-c1">this</span>.<span class="pl-smi">stockDataService</span>
            .<span class="pl-en">subscibeRealtimeData</span>(
              <span class="pl-smi">stockCode</span>,
              <span class="pl-c1">undefined</span>,
              <span class="pl-smi">Observable</span>.<span class="pl-en">merge</span>(
                <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave$</span>,
                <span class="pl-c1">this</span>.<span class="pl-smi">realtimeStockList$</span>.<span class="pl-en">filter</span>(<span class="pl-v">arr</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">arr</span>.<span class="pl-c1">indexOf</span>(<span class="pl-smi">stockCode</span>) <span class="pl-k">===</span> <span class="pl-k">-</span><span class="pl-c1">1</span>),
              ),
            )
            .<span class="pl-en">takeUntil</span>(<span class="pl-smi">Observable</span>.<span class="pl-en">merge</span>(
              <span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave$</span>.<span class="pl-en">delay</span>(<span class="pl-c1">this</span>.<span class="pl-smi">appSettings</span>.<span class="pl-c1">UNSUBSCRIBE_INTERVAL</span>),
              <span class="pl-c1">this</span>.<span class="pl-smi">realtimeStockList$</span>.<span class="pl-en">filter</span>(<span class="pl-v">arr</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">arr</span>.<span class="pl-c1">indexOf</span>(<span class="pl-smi">stockCode</span>) <span class="pl-k">===</span> <span class="pl-k">-</span><span class="pl-c1">1</span>),
            ))
            .<span class="pl-en">subscribe</span>();
        })
      }
    })
}</pre></div>
<p>在股票列表发生变化时，遍历股票代码，判断代码是否存在于 <code>lastRealtimeStockList</code> 中，若不存在，则进行订阅，并且在 <code>realtimeStockList$</code> 变化、当前代码不再存在于代码列表中时，自动取消订阅。</p>
<p>为了处理页面切换时取消订阅的问题，在 <code>ionViewDidLeave()</code> 事件中执行了 <code>this.realtimeStockList.next([]);</code> 操作，避免从其他页面切换回来时无法自动进行重订阅（ <code>realtimeStockList</code> 若不清空， <code>doSubscribe()</code> 方法会误认为这些订阅已存在）。但是这样会带来另外一个问题：离开页面时取消订阅的操作是立刻被触发的，延时退订的效果没有了。</p>
<blockquote>
<p>可以考虑将清空操作从 <code>ionViewDidLeave()</code> 中移除，改为放到 <code>ionViewDidEnter()</code> 中，在调用 <code>doSubscribe()</code> 之前。但修改前需要考虑是否会带来其他问题。</p>
</blockquote>
<h2>
<a id="67" class="anchor" href="#67" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RxJS 合并可观察对象</h2>
<p>有时需要将多个 Observable 流合并为一个，以便进行统一处理，或者在多个前置条件都满足的情况下才触发后续的处理。 RxJS 中的合并操作有多种，目前高交所 APP 基本上只使用了 <code>combineLatest()</code> 。可参阅 <code>/src/pages/stock-detail/stock-detail.ts</code> ，此页面会动态计算可买可卖的股票数量以及金额，涉及到的数据有： 目标股票的可卖数量、股票的基本数据、买卖数量（全仓、 1/2 仓、 10 手等等）。</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">Observable</span>
  .<span class="pl-en">combineLatest</span>(
    <span class="pl-c1">this</span>.<span class="pl-smi">_saleableQuantity$</span>,
    <span class="pl-c1">this</span>.<span class="pl-smi">_baseData$</span>,
    <span class="pl-c1">this</span>.<span class="pl-smi">buySaleActiveIndex</span>,
  )
  <span class="pl-c"><span class="pl-c">//</span> 使用 takeUntil() 在离开当前视图时自动取消订阅。</span>
  .<span class="pl-en">takeUntil</span>(<span class="pl-c1">this</span>.<span class="pl-smi">viewDidLeave$</span>)
  .<span class="pl-en">subscribe</span>(([<span class="pl-v">saleableQuantity</span>, <span class="pl-v">baseData</span>, <span class="pl-v">index</span>]) <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">this</span>.<span class="pl-en">buySale</span>(<span class="pl-smi">index</span>, <span class="pl-smi">saleableQuantity</span>, <span class="pl-smi">baseData</span>);
  })</pre></div>
<p><code>combineLatest()</code> 用于合并多个数据流，在每个流都有数据流出时才会触发后续的处理；只要有一个数据流产生了新值，就会将多个流的最后一个值合并到一个数组内，向下传递。</p>
<p>合并数据方面类似的操作有 <code>concat()</code> 、 <code>zip()</code> 等，特性各不相同。此处选择 <code>combineLatest()</code> 是因为它正好满足我们的需求：</p>
<ul>
<li>需要前置数据都已产生时，才去调用计算过程；</li>
<li>只要前置数据有任何一者发生改变，都要重新计算；</li>
<li>在重新计算时，对于未发生改变的前置数据，只要取其最后一次有效值来参与计算，即可。</li>
</ul>
<h1>
<a id="68" class="anchor" href="#68" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>其他异步处理方式</h1>
<h2>
<a id="69" class="anchor" href="#69" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Promise</h2>
<p>在 Angular 中， Promise 主要用于处理一次性的异步操作，例如 <code>platform.ready()</code> 、 <code>storage.get()</code> 等等，有的 http 请求也使用将 Observable 转换为 Promise 的方式。</p>
<p>随着对 RxJS 技术掌握的深入，可以考虑将一部分 Promise 代码逐步转换为 Observable ，特别是 http 处理的部分，以便可以在必要时中断 http 请求。</p>
<p>**在使用 Promise 时，需要注意 Ionic 对 Promise 的 reject 是进行了全局捕捉的。**一旦用户的代码没有自行对 Promise 的 reject 进行处理，界面上就会显示全屏的错误提示信息，对用户来说并不友好。因此，必须对所有可能 reject 的 Promise （包括潜在的异常）进行 catch 处理，哪怕 catch 代码内部没有做任何事情也行，例如： <code>.catch(() =&gt; {})</code> 。</p>
<h2>
<a id="70" class="anchor" href="#70" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>async/await</h2>
<p>async/await 是 ES2017 的特性，是结合了 Promise 与 generator 的一项技术，被一部分人称为“ js 异步处理的最终解决方案”。但是在高交所 APP 中做了少数试验，并没有觉得带来特别大的便利。</p>
<p>async/await 的优点有：</p>
<ol>
<li>可以用同步代码的书写方式来写异步代码，更直观。</li>
<li>await 会自动对操作/返回值进行 Promise 包装，对于调用方来说是非常方便的。调用方可以不用了解所调用的功能是异步还是同步的，可以用统一方式进行处理。而对于被调用方来说，其内部实现可以在异步与同步方式之间进行切换，却不用担心向外暴露的调用接口。</li>
</ol>
<p>在实践中，感觉 async/await 更多是便利了调用方，例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">logout</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">menuCtrl</span>.<span class="pl-c1">close</span>();
  <span class="pl-c1">this</span>.<span class="pl-smi">loginService</span>.<span class="pl-en">doLogout</span>()
    .<span class="pl-en">then</span>(() <span class="pl-k">=&gt;</span> { <span class="pl-c1">this</span>.<span class="pl-smi">navCtrl</span>.<span class="pl-en">setRoot</span>(<span class="pl-smi">LoginPage</span>); });
}</pre></div>
<p>使用 async/await 可以改造为：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">async</span> <span class="pl-en">logout</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">menuCtrl</span>.<span class="pl-c1">close</span>();
  <span class="pl-k">await</span> <span class="pl-c1">this</span>.<span class="pl-smi">loginService</span>.<span class="pl-en">doLogout</span>();
  <span class="pl-c1">this</span>.<span class="pl-smi">navCtrl</span>.<span class="pl-en">setRoot</span>(<span class="pl-smi">LoginPage</span>);
}</pre></div>
<p>代码相对更清晰一点，代码量也稍微少了一些。</p>
<p>async/await 使用同步代码的异常处理方式，例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">async</span> <span class="pl-en">init</span>(){
  <span class="pl-k">const</span> appDataService <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">appDataService</span>;
  <span class="pl-k">try</span> {
    <span class="pl-k">await</span> <span class="pl-smi">appDataService</span>.<span class="pl-smi">dataReady</span>;

    <span class="pl-c"><span class="pl-c">//</span> 其他代码……</span>
  } <span class="pl-k">catch</span> (<span class="pl-smi">err</span>) {
     <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>.<span class="pl-smi">message</span>);
  }
}</pre></div>
<p>这样写似乎符合以往的编程习惯，但在多个异步操作并存的场合，却会带来困扰。例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-en">promise_1</span>()
  .<span class="pl-en">then</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> <span class="pl-en">promise_2</span>(<span class="pl-smi">data</span>))
  .<span class="pl-en">then</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> <span class="pl-en">promise_3</span>(<span class="pl-smi">data</span>))
  .<span class="pl-en">then</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> <span class="pl-en">promise_4</span>(<span class="pl-smi">data</span>))
  .<span class="pl-en">then</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> <span class="pl-en">promise_5</span>(<span class="pl-smi">data</span>))
  .<span class="pl-en">catch</span>(<span class="pl-v">err</span> <span class="pl-k">=&gt;</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>))</pre></div>
<p>使用 Promise 可以串联一系列操作，在最后使用一个 <code>catch()</code> 来输出错误信息。这些代码编写模式在某些场合下是十分便利的。但若修改为 async/await 就必须写为：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">let</span> data
<span class="pl-k">try</span> {
  <span class="pl-smi">data</span> <span class="pl-k">=</span> <span class="pl-k">await</span> <span class="pl-en">promise_1</span>()
} <span class="pl-k">catch</span> (<span class="pl-smi">err</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>)
}
<span class="pl-k">try</span> {
  <span class="pl-smi">data</span> <span class="pl-k">=</span> <span class="pl-k">await</span> <span class="pl-en">promise_2</span>(<span class="pl-smi">data</span>)
} <span class="pl-k">catch</span> (<span class="pl-smi">err</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>)
}
<span class="pl-k">try</span> {
  <span class="pl-smi">data</span> <span class="pl-k">=</span> <span class="pl-k">await</span> <span class="pl-en">promise_3</span>(<span class="pl-smi">data</span>)
} <span class="pl-k">catch</span> (<span class="pl-smi">err</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>)
}
<span class="pl-k">try</span> {
  <span class="pl-smi">data</span> <span class="pl-k">=</span> <span class="pl-k">await</span> <span class="pl-en">promise_4</span>(<span class="pl-smi">data</span>)
} <span class="pl-k">catch</span> (<span class="pl-smi">err</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>)
}
<span class="pl-k">try</span> {
  <span class="pl-k">await</span> <span class="pl-en">promise_5</span>(<span class="pl-smi">data</span>)
} <span class="pl-k">catch</span> (<span class="pl-smi">err</span>) {
  <span class="pl-k">return</span> <span class="pl-c1">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">err</span>)
}</pre></div>
<p>代码非常累赘，而且也有参数传递不直观的问题。原因是 async/await 的 try/catch 只能捕捉第一个 await 操作的异常，如果有多个 await ，就必须写多个 try/catch ，并且还要注意作用域问题。</p>
<p>async/await 目前看来另一个缺点是：代码简化基本只针对调用方（没有 try/catch 的情况下），而对于被调用方来说，异步代码原来该怎么写，引入 async/await 后依然要那样写。</p>
<p>对于 async/await 的优点，可能还需要进一步实践来挖掘。</p>
<p>可以考虑对一些方法进行封装。例如：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">function</span> asyncTimeout(<span class="pl-v">interval</span>) {
  <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>(<span class="pl-v">resolve</span> <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">setTimeout</span>(<span class="pl-smi">resolve</span>, <span class="pl-smi">interval</span>);
  })
}

<span class="pl-k">async</span> <span class="pl-k">function</span> todo(<span class="pl-v">interval</span>) {
  <span class="pl-k">await</span> <span class="pl-en">asyncTimeout</span>(<span class="pl-smi">interval</span>);
  <span class="pl-c"><span class="pl-c">//</span> do something</span>
  <span class="pl-k">return</span> <span class="pl-smi">result</span>;
}</pre></div>
<p>这种写法与无封装的写法相比：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">async</span> <span class="pl-k">function</span> todo(<span class="pl-v">interval</span>) {
  <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Promise</span>(<span class="pl-v">resolve</span> <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">setTimeout</span>(() <span class="pl-k">=&gt;</span> {
      <span class="pl-c"><span class="pl-c">//</span> do something</span>
      <span class="pl-en">resolve</span>(<span class="pl-smi">result</span>);
    }, <span class="pl-smi">interval</span>);
  })
}</pre></div>
<p>封装的代码量稍微多一些，但是结构更清晰，并且所封装出来的 <code>asyncTimeout()</code> 方法是一个可复用的公共方法。</p>
<h1>
<a id="71" class="anchor" href="#71" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ECharts</h1>
<h2>
<a id="72" class="anchor" href="#72" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>组件封装与抽象</h2>
<p>高交所 APP 引入了 ECharts 用于绘制各种图表，并对其功能进行了一定程度上的封装。需要注意的点有：</p>
<ol>
<li>使用了带有 <code>@Input()</code> 装饰器的 <code>echartsData</code> 与 <code>options</code> 属性，前者用于传入主要数据，后者用于传入一些自定义选项。</li>
<li>使用了 <code>ngOnChanges()</code> 事件，在输入数据变化时重新调用绘制方法。</li>
<li>在模板中只放置了一个 html 元素： <code>&lt;div class="echarts-placeholder" #echartsPlaceholder&gt;&lt;/div&gt;</code> ，在组件初始化时（ <code>ngOnInit()</code> 事件）以此元素创建 Echarts 实例。</li>
<li>元素上带有一个 <code>echarts-placeholder</code> class ，组件自身不定义该 class 的样式，而是将定义的职责上移到父组件或页面（利用 css 的后代选择器）。因为组件自身是不知道元素的宽度与高度定义为多少才合适的，容器组件或页面才知道这一点。</li>
<li>原则上， ECharts 实例元素的样式只需要定义宽度与高度即可，而且对于块级元素来说，基本上只需要定义高度，因为宽度一般是根据父元素自适应的。不过在实践过程中发现有些情况还是需要定义宽度，因为有的界面可能使用了弹性布局，在自动布局计算完成之前组件的 <code>ngOnInit()</code> 可能就被触发了。此外，将样式设置为 <code>width: 100%; height: 100%;</code> 有时候也会引发问题，同样涉及到 <code>ngOnInit()</code> 的触发顺序问题，在出现问题时，可以考虑使用精确的尺寸而不是百分比。</li>
<li>某些图表的大小可能会动态改变，例如股票详情页（ <code>/src/pages/stock-detail/stock-detail.html</code> ）的伪横屏模式，在查看实时走势图表时，右侧的“买五卖五档”是可以收起的，实时图的尺寸会随之发生变化。 ECharts 提供了一个 <code>resize()</code> 方法，在实例元素尺寸发生改变时可调用。而高交所 APP 的 ECharts 相关组件对此方法进行了进一步封装，会去计算容器的宽度，然后再用计算结果去调用 <code>resize()</code> 。</li>
<li>在绘制图表（计算并调用 ECharts 的 <code>setOption()</code> 方法）时，使用一个异步操作（ <code>setTimeout(() =&gt; {/*方法调用*/}, 0)</code> ）。因为如果使用同步方式去调用的话，在切换页面时可能会出现明显的卡顿。此外，为了优化性能，取消了绘制的动画（ <code>animation: false</code> ）。</li>
</ol>
<p>以上都是 ECharts 相关组件的公共特性，为了简化代码，将公共部分提取出来作为一个基类： <code>EchartsBaseComponent</code> （ <code>/src/components/echarts-base/echarts-base.ts</code> ），其他相关的组件都继承此基类。</p>
<p><code>EchartsBaseComponent</code> 还做了一些额外处理：</p>
<ul>
<li>在绘制之前，先判断前置条件是否满足（ <code>this.echartsData &amp;&amp; this.inputDataValid()</code> ），其中 <code>inputDataValid()</code> 方法在基类中只是单纯返回 <code>true</code> ，此方法可以被派生类重写，以便进行自定义判断。</li>
<li>基类的绘制方法（ <code>createCharts()</code> ）没有任何实际的逻辑代码，只会单纯抛出异常，此方法需要在派生类中重写。</li>
</ul>
<p>在派生类中，除了 <code>echartsData</code> 与 <code>options</code> 两个输入属性外，还可以自行定义更多的输入属性，并实现对应的 <code>inputDataValid()</code> 方法。</p>
<h2>
<a id="73" class="anchor" href="#73" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>回收资源</h2>
<p>这一点实际上也是 ECharts 相关组件的注意点之一，但因为比较重要，所以单独提取出来着重说明。</p>
<p>ECharts 是不会自动进行资源回收的。在高交所 APP 的早期版本，会发现页面切换时内存占用在不断增加，最后导致 APP 闪退。研究后发现是 ECharts 占用的资源没有被释放造成的，即使对应的 <code>&lt;div&gt;</code> 、 <code>&lt;canvas&gt;</code> 等 html 元素被销毁，资源仍然被占据。</p>
<p>ECharts 提供了一个 <code>dispose()</code> 来回收资源。在 <code>EchartsBaseComponent</code> 类的 <code>ngOnDestroy()</code> 方法中，对 <code>dispose()</code> 进行了调用。</p>
<p>但问题并没有这样简单解决。在一般页面中，随着页面实例被销毁， ECharts 相关组件也会被销毁，从而触发其 <code>ngOnDestroy()</code> 方法，执行 <code>dispose()</code> 回收资源。但 Ionic Tabs 的一级页面在整个 APP 的生命周期中几乎是一直存在、不会被销毁的（除非整个 Tabs 被销毁），这样就无法触发组件的 <code>ngOnDestroy()</code> 。</p>
<p>在高交所 APP 中，确实有一个 Tabs 一级页面包含了 ECharts 相关组件，就是行情页面（ <code>/src/pages/quotations/quotations.ts</code> ）。为了让这些组件在行情页面不被激活的情况下能够自动被销毁，采用了以下的解决方案：</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">realtime-charts-component</span>
  *<span class="pl-e">ngIf</span>=<span class="pl-s"><span class="pl-pds">"</span>_thisPageActive<span class="pl-pds">"</span></span>
  [<span class="pl-e">echartsData</span>]=<span class="pl-s"><span class="pl-pds">"</span>_realtimeData$ | async<span class="pl-pds">"</span></span>
  [<span class="pl-e">baseData</span>]=<span class="pl-s"><span class="pl-pds">"</span>_baseData$ | async<span class="pl-pds">"</span></span>
  (<span class="pl-e">tooltipEmitted</span>) = <span class="pl-s"><span class="pl-pds">"</span>showRealtimeQutationTooltip($event)<span class="pl-pds">"</span></span>
  [<span class="pl-e">options</span>]=<span class="pl-s"><span class="pl-pds">"</span>realtimeOptions<span class="pl-pds">"</span></span>&gt;
&lt;/<span class="pl-ent">realtime-charts-component</span>&gt;</pre></div>
<div class="highlight highlight-source-ts"><pre><span class="pl-smi">_thisPageActive</span>: <span class="pl-smi">boolean</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;

<span class="pl-en">ionViewDidEnter</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">_thisPageActive</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
}

<span class="pl-en">ionViewWillLeave</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">_thisPageActive</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;
}</pre></div>
<p>定义了一个 <code>_thisPageActive</code> 属性，并配合 <code>*ngIf</code> 指令来控制组件是否应当被渲染出来。在 <code>ionViewDidEnter()</code> 与 <code>ionViewWillLeave()</code> 事件处理函数中，切换 <code>_thisPageActive</code> 属性的状态。</p>
<p>此处需要注意一点：设置 <code>_thisPageActive</code> 为 <code>false</code> ，是在 <code>ionViewWillLeave()</code> 中，而不是在 <code>ionViewDidLeave()</code> 中。原因是一旦离开了当前页面（视图）， Ionic 就不会再重新渲染该视图，导致 <code>_thisPageActive</code> 的 <code>false</code> 不会触发 <code>*ngIf</code> ，对应组件也就不会被销毁。</p>
<p>这样处理之后，貌似解决了问题。但测试后发现了新问题：</p>
<p>当从行情页离开，前往其他的 Tabs 一级页面时，若目标页面之前未显示过，那么可以正常触发 ECharts 组件的销毁操作。但若目标页面之前显示过，那么销毁操作并不会被触发。原因可能是对于已显示过的页面来说，切换页面速度很快，基本没有什么延迟，导致 <code>ionViewWillLeave()</code> 里面所做的操作还没有来得及生效，就过渡到了 <code>ionViewDidLeave()</code> ，导致视图没有被重新渲染。</p>
<p>目前尚未找到最好的解决方法，暂时使用的是：</p>
<div class="highlight highlight-source-ts"><pre>@<span class="pl-en">ViewChildren</span>(<span class="pl-smi">RealTimeChartsComponent</span>) <span class="pl-smi">charts</span>;

<span class="pl-en">ionViewDidEnter</span>(){
  <span class="pl-c1">setTimeout</span>(() <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">this</span>.<span class="pl-smi">_thisPageActive</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;
  }, <span class="pl-c1">200</span>);
}

<span class="pl-en">ionViewWillLeave</span>(){
  <span class="pl-c1">this</span>.<span class="pl-smi">_thisPageActive</span> <span class="pl-k">=</span> <span class="pl-c1">false</span>;

  <span class="pl-c1">setTimeout</span>(() <span class="pl-k">=&gt;</span> {
    <span class="pl-c1">this</span>.<span class="pl-en">destoryCharts</span>()
  }, <span class="pl-c1">1e3</span>)
}

<span class="pl-en">destoryCharts</span>() {
  <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">_thisPageActive</span> <span class="pl-k">===</span> <span class="pl-c1">false</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-c1">this</span>.<span class="pl-smi">charts</span>) {
    <span class="pl-k">for</span> (<span class="pl-k">const</span> chart <span class="pl-k">of</span> <span class="pl-c1">this</span>.<span class="pl-smi">charts</span>.<span class="pl-en">toArray</span>()) {
      <span class="pl-k">const</span> chartElem <span class="pl-k">=</span> <span class="pl-smi">chart</span>.<span class="pl-smi">chartElem</span>.<span class="pl-smi">nativeElement</span> <span class="pl-k">as</span> <span class="pl-en">HTMLDivElement</span>;
      <span class="pl-k">const</span> childNodes <span class="pl-k">=</span> <span class="pl-smi">chartElem</span>.<span class="pl-c1">childNodes</span>;
      <span class="pl-k">if</span> (<span class="pl-smi">childNodes</span>) {
        [].<span class="pl-smi">forEach</span>.<span class="pl-c1">call</span>(<span class="pl-smi">childNodes</span>, <span class="pl-v">child</span> <span class="pl-k">=&gt;</span> {
          <span class="pl-smi">chartElem</span>.<span class="pl-c1">removeChild</span>(<span class="pl-smi">child</span>);
        });
      }
      <span class="pl-smi">chart</span>.<span class="pl-en">ngOnDestroy</span>();
    }
  }
}</pre></div>
<ol>
<li>
<p>首先用 <code>@ViewChildren()</code> 装饰器获得页面上所有 <code>RealTimeChartsComponent</code> 的实例。这种用法（传入类型而不是字符串）可以自动获取页面上对应类型组件的实例，避免使用 <code>#</code> 绑定模板字面量。但是也需要注意是否有其他类型的 ECharts 相关组件需要处理。</p>
</li>
<li>
<p><code>destoryCharts()</code> 方法中，获取对应组件的 node 节点，将其子元素移除，并且手动调用组件的 <code>ngOnDestroy()</code> 方法来回收资源。</p>
</li>
<li>
<p><code>ionViewDidEnter()</code> 方法中，没有立刻设置 <code>_thisPageActive</code> 的值，而是延时 200 毫秒才进行设置。这是因为 ECharts 相关组件是我们手动销毁的，并且也没有完全销毁，只去掉了其子元素并调用回收资源的方法，组件本身还是存在于页面上的，模板引擎也会认为其存在。这样，若在 <code>ionViewDidEnter()</code> 中立刻设置 <code>_thisPageActive = true</code> ，那么模板引擎会认为相关组件已存在，不需要重新渲染，从而在页面上留下空的组件，其中不包含图表的 <code>&lt;canvas&gt;</code> 元素。因此，开始不设置 <code>_thisPageActive = true</code> ，让模板引擎将组件从页面上移除，然后延时设置，模板引擎会重新将组件渲染出来。</p>
</li>
<li>
<p>在 <code>ionViewWillLeave()</code> 方法中，延时一秒调用 <code>destoryCharts()</code> 方法，手动进行资源回收。当然回收之前会先判断相关组件是否存在，如已被销毁就无须再回收了。</p>
</li>
<li>
<p>在整个流程中，会短暂出现图表内部元素不存在的情况，为了防止页面抖动，需要在图表内容不存在时仍然让其占据有效控件，因此不仅需要设置图表元素的 <code>echarts-placeholder</code> 样式，还需要设置容器的宽度与高度。</p>
</li>
</ol>
<h2>
<a id="74" class="anchor" href="#74" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>监测数据变化</h2>
<p>在 <code>RealTimeChartsComponent</code> 中，输入数据发生改变时会触发 <code>ngOnChanges(changes)</code> 事件，从而才能去调用重新绘制图表的方法。其中 <code>changes</code> 参数是 <code>SimpleChanges</code> 的一个实例，其中包含了改变前与改变后的数据，并且其键值会指示出哪些输入字段（属性）发生了改变。</p>
<p><strong>严格来说，应当在 <code>ngOnChanges()</code> 中判断哪些字段发生了改变，根据实际情况决定是否要重绘，而不是每次输入数据发生变化时都重绘。<strong>典型的问题就是实时行情的绘制上，当接收到实时数据时， <code>StockDataService</code> 中不仅 <code>_stockRealtimeData</code> 的值会发生变化， <code>_stockBaseData</code> 的值同样也会变化，而实时数据的图表同时使用了这两方面的数据，因此会导致在收到一次实时数据时图表被重绘两次。目前高交所 APP 没有对变化的字段进行严格检查，但以后可以考虑加以改进。例如</strong>实时图表使用 <code>_stockBaseData</code> 实际上只用了它的 <code>yesterdayPrice</code> 属性的值，只要这个值不变化，实时图表无须在 <code>_stockBaseData</code> 变化时进行重绘</strong>。</p>
<p>在数据变化监测上的另外一个问题，就是数据中心（全局服务）的数据以什么方式发生变化。对于普通的 Angular 组件来说，所使用的数据源可以是一个普通对象，在数据发生变化时，直接在数据源对象的属性上进行修改即可。然而这种方式在 ECharts 相关组件上是行不通的。</p>
<p><strong>原因是 Angular 的数据变化监测是通过 Observable 进行的。直接修改数据对象的属性，对于使用该对象的组件来说，它并不会监测到数据的变化，因为该对象的地址（引用）并没有改变，改变的只是对象的成员属性。那么， Angular 是如何知道对象属性的变化呢？它是通过模板/子模板上绑定数据的变化感知到的，模板/子模板能够检测到对象属性值的变化，然后通过 Observable 的层次机制将“数据已改变”的消息向上传递到父组件，这样父组件在当前所用的数据对象的引用没有变化的情况下，也能知道数据已改变。</strong></p>
<p><strong>对于 ECharts 相关组件来说，传入的数据并没有直接被用在模板上，而是使用了 ECharts 的 <code>setOption()</code> 方法来绘制对应的 <code>&lt;div&gt;</code> 以及 <code>&lt;canvas&gt;</code> 元素，这些元素与 Angular 引擎的关联是断裂的。因此，在数据的成员属性改变时，没有子模板向上通知，上层模板也不会知道数据已改变，从而不会重绘 ECharts 图表。</strong></p>
<p>这一点在实时行情图表上有所体现，一个股票的实时行情数据实际上是一个数组，如果直接在这个数组上执行 <code>push()</code> 推入数据等操作，并不会引发组件的 <code>ngOnChanges()</code> ，图表也就不会被实时重绘。虽然实时图表组件还有一个输入属性 <code>baseData</code> 对应于 <code>_stockBaseData</code> ，这个属性的变化也会引发重绘，但考虑到特殊情况：收盘之后 <code>_stockBaseData</code> 是不会再变化的，这样即使接收到新的 <code>_stockRealtimeData</code> ，图表也不会被重绘（可能情况：之前曾经获得一部分实时数据，离开一段时间后再回来，在收盘后重新请求数据并获得当天完整的实时数据）。</p>
<p>因此，在目前的代码中，并没有直接使用 <code>push()</code> 等方法在原有的实时数据上进行操作，而是使用不带参数的 <code>concat()</code> 方法获得原数组的一个副本，在副本上操作，最后再将副本 set 回去。</p>
<blockquote>
<p>创建数组的副本也可以使用 ES6 的数组扩展运算符： <code>const newArray = [...oldArray]</code> ，但实际测试后发现，效率要比直接使用 <code>concat()</code> 方法（ <code>const newArray = oldArray.concat()</code> ）差很多。</p>
</blockquote>
<h2>
<a id="75" class="anchor" href="#75" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>自定义 tooltip</h2>
<p>tooltip 指的是在 ECharts 图表上点击时出现的浮动提示框，提示框的样式与内容都可以自行指定。</p>
<p>tooltip 在 PC 端 是一项很有用的特性，但在手机端却表现不佳，因为手机的显示空间有限，一般很难能够提供合适的显示位置。因此在高交所的 APP 中，原则上应当将所有图表的 tooltip 都屏蔽掉，在确实需要点击/触摸事件的图表上，自定义 tooltip 相关事件。参考 <code>/src/components/realtime-charts/realtime-charts.ts</code> ：</p>
<div class="highlight highlight-source-ts"><pre>@<span class="pl-en">Output</span>() <span class="pl-smi">tooltipEmitted</span>: <span class="pl-smi">any</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">EventEmitter</span>();

<span class="pl-k">const</span> options <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-c1">options</span> <span class="pl-k">||</span> {};
<span class="pl-k">const</span> { customTooltip <span class="pl-k">=</span> <span class="pl-c1">false</span> } <span class="pl-k">=</span> <span class="pl-smi">options</span>;

<span class="pl-k">const</span> option <span class="pl-k">=</span> {
    tooltip: {
        <span class="pl-c"><span class="pl-c">//</span> 其他选项……</span>
        formatter: <span class="pl-smi">customTooltip</span> <span class="pl-k">?</span> (<span class="pl-v">params</span>) <span class="pl-k">=&gt;</span> {
            <span class="pl-k">const</span> dataIndex <span class="pl-k">=</span> <span class="pl-smi">params</span>[<span class="pl-c1">0</span>].<span class="pl-smi">dataIndex</span>;
            <span class="pl-k">if</span> (<span class="pl-c1">this</span>.<span class="pl-smi">lastTooltipDataIndex</span> <span class="pl-k">!==</span> <span class="pl-smi">dataIndex</span>){
                <span class="pl-c1">this</span>.<span class="pl-smi">lastTooltipDataIndex</span> <span class="pl-k">=</span> <span class="pl-smi">dataIndex</span>;
                <span class="pl-c1">this</span>.<span class="pl-smi">tooltipEmitted</span>.<span class="pl-en">emit</span>(<span class="pl-smi">params</span>);
            }
        } <span class="pl-k">:</span> 
        (<span class="pl-v">params</span>) <span class="pl-k">=&gt;</span> {
            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">`</span>${<span class="pl-smi">params</span>[<span class="pl-c1">0</span>].<span class="pl-c1">name</span>} &lt;br/&gt;</span>
<span class="pl-s">                价格:  ${<span class="pl-smi">params</span>[<span class="pl-c1">0</span>].<span class="pl-c1">data</span>} &lt;br/&gt;</span>
<span class="pl-s">                均价:  ${<span class="pl-smi">params</span>[<span class="pl-c1">1</span>].<span class="pl-c1">data</span>} &lt;br/&gt;<span class="pl-pds">`</span></span>
        },</pre></div>
<p>在输入的 <code>options</code> 属性对象上，有一个 <code>customTooltip</code> 属性控制是否要自定义 tooltip 。若是，在 tooltip 的 <code>formatter()</code> 方法中，不返回任何值， tooltip 也就不会显示；同时将相关数据作为参数去发射 <code>tooltipEmitted</code> 事件。</p>
<p>在上层组件中，会对 <code>customTooltip</code> 事件进行处理。例如在股票详情页，当在实时图表上进行点击时，会将点击目标的相关数据（价格、涨跌、成交量等）显示在界面上相应的位置，作为临时数据替代最新的数据，并且设置定时器，几秒后恢复最新数据的显示。</p>
<h2>
<a id="76" class="anchor" href="#76" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ngx-echarts</h2>
<p><code>ngx-echarts</code> 是为 Angular 封装了 ECharts 功能的插件，相关链接地址： <a href="https://www.npmjs.com/package/ngx-echarts">npm</a> 、 <a href="https://github.com/xieziyu/ngx-echarts">github</a> 。</p>
<p>查看其代码，可以看到是使用属性指令的形式对 ECharts 进行了封装，对各种生命周期事件、数据改变的监测都有处理。但其存在的问题是：</p>
<ol>
<li>
<p>对 ECharts 所用的数据处理没有进行封装。 ECharts 图表有几种主要类型，每一种都有比较规格化的数据处理、转换方式，处理后的数据作为 <code>setOption()</code> 的参数，相关的处理代码是需要提取的。</p>
</li>
<li>
<p>在指令中没有将 ECharts 代码库作为依赖引入，而是直接声明为 <code>declare var echarts: any;</code> 。在项目中使用时，需要自行处理库的引入问题，较为繁琐（不能简单地在 <code>app.module.ts</code> 中使用 <code>import</code> 来解决 ），不够友好。</p>
</li>
</ol>
<p>因此高交所 APP 并没有使用 <code>ngx-echarts</code> 插件。不过该插件的代码编写可以给我们提供一些参考，例如目前代码每次数据变更时都重新创建一个 <code>option</code> 对象，使用 <code>setOption()</code> 进行重绘，可以考虑参考 <code>ngx-echarts</code> ，在已存在的 <code>option</code> 对象上进行修改。</p>
<h1>
<a id="77" class="anchor" href="#77" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>杂项</h1>
<h2>
<a id="78" class="anchor" href="#78" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>资源文件的使用</h2>
<p><code>/src/assets/</code> 文件夹下的文件，在使用时需要注意路径问题，以 <code>/src/assets/images/bg_1.jpg</code> 为例：</p>
<ol>
<li>在 html 模板页中使用时，直接使用 <code>assets/</code> 为路径起始部分，例如： <code>&lt;img src="assets/images/bg_1.jpg" /&gt;</code> 。</li>
<li>在样式（ Sass 、 css ）中使用时，以 <code>../assets/</code> 为路径起始部分，例如： <code>background-image: url(../assets/images/bg_1.jpg);</code> 。</li>
</ol>
<p>这样才能保证构建出来的 APP 正常显示资源文件夹下的文件。</p>
<h2>
<a id="79" class="anchor" href="#79" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PromisesPlugin 依赖安装失败</h2>
<p>有若干 cordova-plugin 需要用到此依赖包，有可能在 <code>cordova platform add &lt;android|ios&gt;</code> 时报错。</p>
<p>先将此包下载到本地并解压 <code>https://github.com/vstirbu/PromisesPlugin</code> 。</p>
<p>然后在项目中查找 <code>PromisesPlugin</code> （ <code>&lt;dependency&gt;</code> 元素， id 为 <code>es6-promise-plugin</code> ），将其修改为本地文件夹的路径（可使用绝对路径），然后再执行 <code>platform add</code> 指令（之前已经执行过此指令但报告失败的，需要先做移除 <code>platform remove</code> ）。</p>
<p><code>platform add</code> 成功执行完毕后，需要修改项目的 <code>package.json</code> ，将 <code>es6-promise-plugin</code> 项的值恢复为正常的 <code>git+https://github.com/vstirbu/PromisesPlugin.git</code> ，以避免本地的路径被提交到代码仓库内，导致在其他电脑上安装依赖时报错。</p>
<h2>
<a id="80" class="anchor" href="#80" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>全局消息提示</h2>
<p>Ionic2 的消息提示（警告框）使用 <code>AlertController</code> 组件实现。如果在每个需要弹出消息提示的页面上都使用 <code>AlertController</code> 的相关代码，会比较累赘。</p>
<p>因此，可以将消息提示做成全局服务。参见 <code>/src/providers/alert-service.ts</code> 文件的内容：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { <span class="pl-smi">Injectable</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/core<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> { <span class="pl-smi">AlertController</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>ionic-angular<span class="pl-pds">'</span></span>;

@<span class="pl-en">Injectable</span>()
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">AlertService</span> {

  showAlert(<span class="pl-v">title</span>, <span class="pl-v">message</span>, <span class="pl-v">cssClass</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>dark-alert<span class="pl-pds">'</span></span>){
    <span class="pl-k">let</span> confirm <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">alertCtrl</span>.<span class="pl-en">create</span>({
      <span class="pl-smi">cssClass</span>,
      <span class="pl-smi">title</span>,
      message: <span class="pl-smi">message</span>,
      enableBackdropDismiss: <span class="pl-c1">false</span>,
      buttons: [
        {
          text: <span class="pl-s"><span class="pl-pds">"</span>OK<span class="pl-pds">"</span></span>,
        }
      ]
    });
    <span class="pl-smi">confirm</span>.<span class="pl-en">present</span>();
  }

  <span class="pl-k">constructor</span>(
    <span class="pl-k">public</span> <span class="pl-v">alertCtrl</span><span class="pl-k">:</span> <span class="pl-en">AlertController</span>,
  ){

  }
}</pre></div>
<p>这样在每个需要显示消息提示的页面上调用 <code>alertService.showAlert()</code> 方法即可。</p>
<p>此处默认对消息提示应用样式 <code>dark-alert</code> ，当然也可以传入其他样式的名称。</p>
<h2>
<a id="81" class="anchor" href="#81" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RESTful 接口与 token</h2>
<p>在高交所的 APP 中，为了数据安全，要求进行 http 请求时都要提交 token （在登录成功之后获得的令牌）。</p>
<p>如果使用 post 方式，则 token 可以放置在表单数据中一并提交。但我们使用 RESTful 接口，根据请求类型会使用 get 、 post 、 put 、 delete 等不同方式。而在 get 方式中，是不应当将 token 直接放在表单数据中的，因为 get 方式所提交的数据会被拼接到请求的 url 中，几乎没有安全性可言，很容易被盗取信息。</p>
<p>因此，为了适应 RESTful 接口， token 一律放在请求头部 Request Header 中，无论哪种请求方式。相关的代码封装如下：</p>
<div class="highlight highlight-source-ts"><pre><span class="pl-c"><span class="pl-c">//</span> /src/providers/http-service.ts</span>
<span class="pl-k">import</span> { <span class="pl-smi">Injectable</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/core<span class="pl-pds">'</span></span>;
<span class="pl-k">import</span> { <span class="pl-smi">Http</span>, <span class="pl-smi">Headers</span>, <span class="pl-smi">RequestOptionsArgs</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>@angular/http<span class="pl-pds">'</span></span>;

<span class="pl-k">import</span> { <span class="pl-smi">AppDataService</span> } <span class="pl-k">from</span> <span class="pl-s"><span class="pl-pds">'</span>./app-data-service<span class="pl-pds">'</span></span>;

@<span class="pl-en">Injectable</span>()
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">HttpService</span> {

  <span class="pl-k">constructor</span>(
    <span class="pl-k">public</span> <span class="pl-v">http</span><span class="pl-k">:</span> <span class="pl-en">Http</span>,
    <span class="pl-k">public</span> <span class="pl-v">appDataService</span><span class="pl-k">:</span> <span class="pl-en">AppDataService</span>,
  ){

  }

  getWithToken(<span class="pl-v">url</span>, <span class="pl-v">options</span><span class="pl-k">:</span> <span class="pl-en">RequestOptionsArgs</span> <span class="pl-k">=</span> {})<span class="pl-k">:</span> <span class="pl-en">Promise</span>&lt;<span class="pl-c1">any</span>&gt; {
    <span class="pl-k">const</span> token <span class="pl-k">=</span> <span class="pl-c1">this</span>.<span class="pl-smi">appDataService</span>.<span class="pl-smi">token</span>;
    <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">token</span>){
      <span class="pl-k">return</span> <span class="pl-c1">Promise</span>.<span class="pl-en">reject</span>(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>token missing!<span class="pl-pds">'</span></span>));
    }
    <span class="pl-k">const</span> headers <span class="pl-k">=</span> <span class="pl-smi">options</span>.<span class="pl-c1">headers</span> <span class="pl-k">||</span> <span class="pl-k">new</span> <span class="pl-en">Headers</span>();
    <span class="pl-smi">headers</span>.<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>X-AUTH-TOKEN<span class="pl-pds">'</span></span>, <span class="pl-smi">token</span>);

    <span class="pl-k">return</span> <span class="pl-c1">this</span>.<span class="pl-smi">http</span>
      .<span class="pl-c1">get</span>(<span class="pl-smi">url</span>, {
        <span class="pl-k">...</span><span class="pl-smi">options</span>,
        <span class="pl-smi">headers</span>,
      })
      .<span class="pl-en">map</span>(<span class="pl-v">res</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">res</span>.<span class="pl-en">json</span>())
      .<span class="pl-en">toPromise</span>()
      .<span class="pl-en">then</span>(<span class="pl-v">data</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">data</span>){
          <span class="pl-k">return</span> <span class="pl-c1">Promise</span>.<span class="pl-en">reject</span>(<span class="pl-k">new</span> <span class="pl-en">Error</span>(<span class="pl-s"><span class="pl-pds">'</span>data missing<span class="pl-pds">'</span></span>));
        }

        <span class="pl-c"><span class="pl-c">//</span> 对于返回数据的其他验证……</span>

        <span class="pl-k">return</span> <span class="pl-smi">data</span>;
      });
  }

}</pre></div>
<p>将 token 放置在请求头部的 <code>X-AUTH-TOKEN</code> 字段内。注意这是额外的头部字段，需要服务端配合，服务端若不支持就会报错。观察数据请求的过程，可以看到浏览器会先发送一个 <code>options</code> 请求，查询服务端是否支持额外的请求头部字段，在获得肯定答复之后，才会发送实际的 <code>get</code> 或其他类型请求。</p>
<h2>
<a id="82" class="anchor" href="#82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>日期时间处理</h2>
<p>高交所 APP 原先对于日期与时间的处理是使用 js 原生的 Date 对象及其方法。但后来发现了问题：在某台 Android 手机上，获取时间时得到的是当地时间（北京时间）；但设置 Date 对象的时间时，例如设置小时的数字，设置参数却会被当做 utc 时间来使用，与北京时间有 8 小时的时差，这样就带来了很严重的问题。</p>
<p>为了解决此问题，引入了一个 <code>moment</code> 库，在获取时间对象时使用 <code>moment.utc()</code> ，即统一采用 utc 时间来处理。相对应的，程序内股市的交易时间设置也进行了调整，例如开盘时间定为 utc 时间 1:30 （对应北京时间 9:30 ）。</p>
<p><code>moment</code> 库不仅可以对 utc 时间进行统一处理，还可以：</p>
<ol>
<li>对时间对象与字符串进行相互转换，支持各种各样的格式，并且能够检测字符串是否对应于一个有效的时间。</li>
<li>按照时间单位（日、分钟等）进行增减。</li>
<li>按照时间的单位，产生对应时间段的起始时间与结束时间，例如 <code>dateMoment.endOf('week')</code> 。</li>
<li>按照时间单位判断两个时间的间隔，使用 <code>diff()</code> 方法。不过前期测试时这个方法总是不能返回预期结果，似乎统一使用 utc 时间可以解决此问题，但后来没有继续进行测试。</li>
</ol>
<h1>
<a id="83" class="anchor" href="#83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>遗留问题</h1>
<h2>
<a id="84" class="anchor" href="#84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>交易日问题</h2>
<p>在获取股票实时数据时，目前对于返回数据会进行一个过滤操作，只要不是当前有效交易日的数据就丢弃。这样做是为了防止服务端返回数据中包含多日数据，相互重叠造成图表绘制出问题。</p>
<p>但是这就涉及到一个问题：如何判断<strong>当前有效交易日</strong>？按照简单的逻辑来说，目前代码只将星期一 ～ 星期五当做有效交易日，并设置早上 9 点（ utc 时间 1 点）作为交易日的切换时间。也就是说，在 9 点之前，<strong>当前有效交易日</strong>实际上指的是上一个有效交易日，而 9 点之后一般指的是当天。例如：</p>
<ul>
<li>星期一 10 点时，<strong>当前有效交易日</strong>就是当日；</li>
<li>星期六全天，<strong>当前有效交易日</strong>指的是周五；</li>
<li>星期二早上 8 点，<strong>当前有效交易日</strong>指的是周一；</li>
<li>星期一早上 8 点，<strong>当前有效交易日</strong>指的是上周五。</li>
</ul>
<p>这样做符合一般的股票行情软件的惯例，即在交易日开盘之前（一般还会有个提前量，例如半小时）看到的实时图应当是前一个交易日的实时图；而当天不是交易日的时候，看到的实时图也应该是前一个交易日的。</p>
<p><strong>但目前的做法有一个最大的缺点，就是只考虑了周末不是交易日，而没有考虑假日的问题。这样会造成误判。</strong></p>
<p>解决此问题有两种方案，都需要服务端配合：</p>
<ol>
<li>服务端返回的实时数据就是有效的数据，已经针对<strong>当前有效交易日</strong>进行了过滤，这样客户端可以直接使用服务端返回的数据，客户端过滤操作也可以取消了。</li>
<li>服务端提供 API ，用于查询今天是不是交易日、上一个有效交易日是哪一天等等，客户端根据这些查询结果来对实时数据进行过滤处理。</li>
</ol>
<h2>
<a id="85" class="anchor" href="#85" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>数值与精度</h2>
<p>高交所服务端原有 API 返回的数据都是使用字符串形式，数值也用字符串表示。我们的服务端目前是对高交所服务端 API 的数据进行转发，或按照其格式进行模拟，因此返回数据基本上也是字符串形式。这样在客户端使用数据时，就需要注意类型转换问题，一些数据需要使用 <code>parseFloat()</code> 转换为数值，以保证程序功能正常。此外，向服务端提交请求时，需要注意有些参数必须由数字转换为字符串再提交。</p>
<p>客户端将字符串转为数字，实际上是有潜在风险的，涉及到数字表示精度的问题。 A 股的惯例是股价、涨跌值等数值的精度为小数点后两位，而目前高交所 APP 中也采用了这一原则。平时传输、计算所用的数字是最多带两位小数的，而需要转换为字符串时（例如在页面上使用 <code>number</code> 管道来进行规格化显示）再转换为保证有两位小数的字符串，例如 13.7 转换为 <code>13.70</code> 。这样做有假设前提，但在高交所的实际应用中这个前提有可能不成立，例如一个股票价格很低，单价小于 1 元，则它的有效数字可能是带 3 位小数的，例如 0.239 。在这种情况下，不但界面上显示会有问题，在提交买卖申请时，实际申请价格也可能不是用户所指定的价格。</p>
<p><strong>因此，在数值精度问题上，必须与高交所进行沟通，了解数值的小数位数是否一定可以限制在两位之内。如果不是，那么程序中许多相关逻辑都必须修改，数据储存与传输都必须使用字符串方式，以保留原有数据的精度；而在需要数值运算时，再将字符串转换为数字参与运算，并且要注意 js 的数值表示精度问题。</strong></p>
<p>此外还有一个问题，就是关于无效数据的表示。目前在许多方面是使用数字 <code>0</code> 来表示无效数据的，例如成交量、成交价、股票价格等。但是这种表示方法有明显的问题：在股票的涨跌值、涨跌额上，数值 <code>0</code> 无法有效表示“涨跌值为 0 ”与“股票停牌没有涨跌数据、或服务端暂时未返回数据”这两类完全不同的情况。</p>
<p>因此可以考虑将无效数据表示为 <code>undefined</code> 或 <code>null</code> ，与 <code>0</code> 进行区分。</p>
<h2>
<a id="86" class="anchor" href="#86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>补全实时数据的处理</h2>
<p>实时数据实际上分为两部分：一部分是实时产生的最新交易、报价等数据；另一部分则是实时起始数据，也就是从当天开盘到当前时间的所有实时数据的汇总（代码中称为 <code>realtimeStartData</code> ），一般是数组，每个元素都代表一分钟的实时数据的汇总。</p>
<p><code>realtimeStartData</code> 主要有两个用途：</p>
<ol>
<li>如果用户查看实时行情图时，已经开盘，则需要补全之前的实时数据。若用户离开界面一段时间，则再返回时可能缺失了一段时间的数据，也需要补全。</li>
<li>订阅实时数据（前者）时，有可能会丢失数据。例如服务端每 5 秒返回一次数据，而前一次返回数据的时间是 <code>13:45:57</code> ，则下一次返回数据时间就是 <code>13:46:02</code> 。在这个过程中， <code>13:45:57.001</code> 到 <code>13:45:59.999</code> 的数据可能就丢失了，包括最后价格、成交量等。如果服务端可以妥善解决此问题，即保证每分钟最后的汇总数据都能正确发送到客户端，则客户端不需要做额外处理；否则，客户端就有必要定期重新请求 <code>realtimeStartData</code> ，以补齐可能遗漏的数据。</li>
</ol>
<p>对于第二点来说，是否有必要进行处理，是与服务器端功能紧密相关的。而<strong>目前高交所 APP 使用的是每 3 分钟去请求数据的方式，可以考虑更改请求频率。此外，在收盘之后这个定时请求也不会被取消，这一点若有可能需要加以改进。</strong></p>
<p><strong>同样非常重要的是， <code>realtimeStartData</code> 请求时，每次都是获得当天完整的实时数据，不管其中是否有一部分已经获得过，这样会带来更大的流量损耗。应当考虑对功能进行改进，特别是服务端的 API ，最好能够按时间段获取当天实时数据的一部分。</strong></p>
<h2>
<a id="87" class="anchor" href="#87" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>K 线图的追加数据</h2>
<ol>
<li>
<p>目前请求 K 线图数据时（暂时只考虑以“日”为单位的数据），在获得数据后就会将其存储下来，由此生成对应的 K 线图表，此后不会实时变化。</p>
<p>但实际上一般行情软件的 K 线图是会变化的，只要目前还在交易时间段内。也就是说， K 线图的最后一个段应当是包含当前交易日的，而且其数值、图形会根据交易价格的变化实时变化。这一点若有需求，应当对程序功能进行改进。</p>
</li>
<li>
<p>广义上的 K 线图还应当包含以“分钟”为单位的图，例如 15 分钟线、 2 小时线等等。目前高交所 APP 的代码并没有为处理这种数据预留功能。</p>
</li>
<li>
<p>请求 K 线图数据时，虽然有“起始时间”、“结束时间”，但目前程序并没有对起始时间参数进行动态调整，始终使用默认值 <code>20161201</code> ，也需要改进。</p>
</li>
<li>
<p>高交所 API 只会返回以“日”为单位的数据，并不会返回“周”与“月”的。这就导致客户端不能直接获取“周 K 线”、“月 K 线”的数据，只能在获取“日数据”后自行计算汇总。这样带来额外的计算量倒是小事，大量的数据传输才是大问题，例如为了获取 30 个月的数据，差不多需要去请求 600 多日的数据。</p>
<p>高交所的 API 虽然没有提供相应的数据，但在我们自己的服务端是可以进行这种计算汇总的，并且可以将汇总结果保存在数据库内，以便今后快速调用。</p>
</li>
</ol>
<h2>
<a id="88" class="anchor" href="#88" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>股票列表数据合并请求</h2>
<p>目前股票数据是单独请求的，并且每个股票不止发出一个请求：</p>
<ol>
<li>股票的基本资料，包括股票名称、代码、交易数量单位、最新价、昨日收盘价、当日成交量、成交额等。</li>
<li>通过 socket.io 请求股票的实时数据，实时变化的最新价格、买五卖五档等，定时获取（由服务器端推送）。</li>
<li>用于补齐的股票实时起始数据（ <code>realtimeStartData</code> ）。</li>
</ol>
<p>这样就会造成一个问题：在列表页中，开始时会同时请求多个股票的数据，每个股票至少调用两个 API （ socket.io 订阅除外）；而浏览器的并发请求数是有限制的，服务端转发高交所 API 的数据也会有延迟。这样数据的加载会逐渐完成，在列表页初始化时可以看到明显的数据逐条显示过程，用户体验并不好。</p>
<p>解决此问题，一是有必要将股票名称储存在 Storage 中，以便在列表显示时预先占位。此外更重要的是我们的服务端应该提供合并请求的 API ，可以一次请求多个股票的基本资料，一次性返回数据，可以立刻将完整列表渲染出来。而实时起始数据分开请求不是太大的问题。</p>
<h2>
<a id="89" class="anchor" href="#89" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ECharts 的 tooltip</h2>
<p>目前对于 tooltip 的解决方案有一个问题，就是点击图标之后出现的辅助线（横线、竖线或十字线），并不会在几秒后自动消失，并且暂时也没有找到让其消失的方法。</p>
<p>这个问题可能有标准的解决方案，需要查阅文档。但也有另一种处理方案，即完全屏蔽 tooltip 的功能，然后通过处理 ECharts 的 <code>click</code> 、 <code>mouseover</code> 等事件来实现数据与消息的传递。但是这依赖于一个功能，即能够根据点击位置找到对应的数据项。</p>
<p>在上层组件对于 tooltip 的处理中，基本都使用了 <code>StockDataService</code> 的 <code>getStockRealtimeData()</code> 方法或 <code>getStockBaseData()</code> 来获取数据中心的数据。但这种方法是不太规范的，因为相应的数据原本是 Observable ，应当用 Observable 数据流的方式来解决。可以考虑使用 <code>combineLatest()</code> 操作，并对自定义的点击事件进行检测过滤。</p>
<h2>
<a id="90" class="anchor" href="#90" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ECharts 在 iphone 上 cpu 占用率过高</h2>
<p>在 iphone 真机上发现：凡是有 ECharts 图表的页面， cpu 占用都会比较高。单个图表就会占用 25% ～ 30+% 的 cpu 。即使图表是相对静态的，例如对于实时行情图来说，目前大约 5 秒才会获取一次新数据，在此期间图表内容应当是静止不变的，但在这种情况下 cpu 占用仍然居高不下。</p>
<p>连接 macbook 调试后发现，有大量嵌套的 <code>llint_entry</code> 操作占用了 cpu ，但 Google 搜索也没有找到合适的答案，目前只能作为一个遗留问题，有待今后解决。</p>
<p>目前需要注意的是，要尽量保持一个页面上显示的图表数量尽量少，凡是可切换的、暂时看不见的图表，都要配合 <code>*ngIf</code> 指令等手段将其实例销毁。</p>
</article></body></html>